import{r as y,j as e}from"./react-BhzSerM2.js";import{G as je,H as Ne,l as we,N as ke,a6 as ee,a8 as _e,a9 as Te,a0 as se,aa as Ce,Z as Se,ab as Ie,L as q,B as Fe,e as v}from"./vendor-DxGhd0kb.js";import{A as Ee}from"./AppShell-CbiYKKs1.js";import{C as I,b as F,c as E,d as O,a as A}from"./Card-BkWrHWVN.js";import{B as ae}from"./Badge-7KrgCsFM.js";import{B as x}from"./app-NZCbGewm.js";import{T as c}from"./TextInput-DRXLElIV.js";import{I as l}from"./InputLabel-qVeuR0hO.js";import{I as G}from"./InputError-6mWSc7R2.js";import{u as Oe}from"./useToast-m6H8bvjE.js";import{C as h}from"./Checkbox-CpJnf9Gf.js";import Ae from"./FlowBuilder-DbgiXmig.js";import"./Topbar-a6Jf_b6K.js";import"./GlobalFlashHandler-xHP6pVTU.js";import"./BrandingWrapper-DK418oSm.js";import"./Alert-CGcVTa3U.js";import"./CookieConsentBanner-BZbYMIzh.js";/* empty css            */const J={name:"",enabled:!0,priority:100,triggerType:"inbound_message",triggerConnections:[],firstMessageOnly:!1,skipIfAssigned:!1,keywords:"",matchType:"any",caseSensitive:!1,wholeWord:!1,buttonId:""},W={type:"action",sortOrder:"",isStart:!1,conditionType:"text_contains",conditionValue:"",conditionCaseSensitive:!1,regexPattern:"",timeWindowTimezone:"UTC",timeWindowStart:"09:00",timeWindowEnd:"17:00",timeWindowDays:[1,2,3,4,5],conditionConnectionIds:[],conditionStatus:"open",conditionTagId:"",conditionTagName:"",actionType:"send_text",actionMessage:"",actionTemplateId:"",actionTemplateVariables:"{}",actionAgentId:"",actionTagId:"",actionTagName:"",actionStatus:"open",actionPriority:"normal",delaySeconds:60,webhookUrl:"",webhookMethod:"POST",webhookTimeout:10};function Ye({account:We,bot:g,connections:w,templates:te,tags:R,agents:re}){const{toast:n}=Oe(),{data:b,setData:f,patch:oe,processing:K,errors:D}=je({name:g.name,description:g.description||"",status:g.status,applies_to:g.applies_to}),[T,M]=y.useState(!1),[C,P]=y.useState(null),[o,u]=y.useState({...J}),[de,B]=y.useState(!1),[z,U]=y.useState(null),[S,V]=y.useState(null),[a,d]=y.useState({...W}),[ne,Z]=y.useState(!1),[j,$]=y.useState(null),[m,N]=y.useState({id:null,fromNodeId:"",toNodeId:"",label:"next",sortOrder:""}),k=y.useMemo(()=>new Map(g.flows.map(s=>[s.id,s])),[g.flows]),le=(s,t)=>{if(!k.get(s))return;const p=t.edges.map((i,_)=>({from_node_id:i.from_node_id,to_node_id:i.to_node_id,label:i.label??"next",sort_order:i.sort_order??_+1}));v.patch(route("app.chatbots.flows.update",{flow:s}),{nodes:t.nodes.map((i,_)=>({id:i.id,type:i.type,config:i.config,sort_order:i.sort_order??_+1,pos_x:i.pos_x??null,pos_y:i.pos_y??null})),edges:p},{preserveScroll:!0,onSuccess:()=>n.success("Graph saved"),onError:()=>n.error("Failed to save graph")})},ie=s=>{s.preventDefault(),oe(route("app.chatbots.update",{bot:g.id}),{onSuccess:()=>{n.success("Bot updated successfully")},onError:()=>{n.error("Failed to update bot")}})},ce=s=>{const r={active:{variant:"success",label:"Active"},paused:{variant:"warning",label:"Paused"},draft:{variant:"default",label:"Draft"}}[s]||{variant:"default",label:s};return e.jsx(ae,{variant:r.variant,className:"px-3 py-1",children:r.label})},me=s=>{const t=b.applies_to.connection_ids||[];t.includes(s)?f("applies_to",{...b.applies_to,connection_ids:t.filter(r=>r!==s)}):f("applies_to",{...b.applies_to,connection_ids:[...t,s]})},H=()=>{u({...J}),P(null),M(!1)},ue=s=>{const t=s.trigger||{},r=t.type||"inbound_message";P(s.id),M(!0),u({name:s.name,enabled:s.enabled,priority:s.priority,triggerType:r,triggerConnections:t.connection_ids||[],firstMessageOnly:!!t.first_message_only,skipIfAssigned:!!t.skip_if_assigned,keywords:Array.isArray(t.keywords)?t.keywords.join(", "):"",matchType:t.match_type||"any",caseSensitive:!!t.case_sensitive,wholeWord:!!t.whole_word,buttonId:t.button_id||""})},ge=()=>o.triggerType==="keyword"?{type:"keyword",keywords:o.keywords.split(",").map(t=>t.trim()).filter(t=>t.length>0),match_type:o.matchType,case_sensitive:o.caseSensitive,whole_word:o.wholeWord}:o.triggerType==="button_reply"?{type:"button_reply",button_id:o.buttonId}:{type:"inbound_message",connection_ids:o.triggerConnections,first_message_only:o.firstMessageOnly,skip_if_assigned:o.skipIfAssigned},pe=s=>{s.preventDefault();const t={name:o.name,enabled:o.enabled,priority:o.priority,trigger:ge()};C?v.patch(route("app.chatbots.flows.update",{flow:C}),t,{preserveScroll:!0,onSuccess:()=>{n.success("Flow updated successfully"),H()},onError:()=>{n.error("Failed to update flow")}}):v.post(route("app.chatbots.flows.store",{bot:g.id}),t,{preserveScroll:!0,onSuccess:()=>{n.success("Flow created successfully"),H()},onError:()=>{n.error("Failed to create flow")}})},xe=s=>{confirm("Delete this flow?")&&v.delete(route("app.chatbots.flows.destroy",{flow:s}),{preserveScroll:!0,onSuccess:()=>n.success("Flow deleted"),onError:()=>n.error("Failed to delete flow")})},Q=s=>{U(s),V(null),d({...W}),B(!0)},he=(s,t)=>{const r=t.config||{};U(s),V(t.id),B(!0),d({...W,type:t.type||"action",sortOrder:t.sort_order,isStart:r.is_start??!1,conditionType:r.type||"text_contains",conditionValue:r.value||"",conditionCaseSensitive:!!r.case_sensitive,regexPattern:r.pattern||"",timeWindowTimezone:r.timezone||"UTC",timeWindowStart:r.start_time||"09:00",timeWindowEnd:r.end_time||"17:00",timeWindowDays:r.days||[1,2,3,4,5],conditionConnectionIds:r.connection_ids||[],conditionStatus:r.status||"open",conditionTagId:r.tag_ids?.[0]||"",conditionTagName:r.tags?.[0]||r.tag_names?.[0]||"",actionType:r.action_type||"send_text",actionMessage:r.message||"",actionTemplateId:r.template_id||"",actionTemplateVariables:r.variables?JSON.stringify(r.variables,null,2):"{}",actionAgentId:r.agent_id||"",actionTagId:r.tag_id||"",actionTagName:r.tag||r.tag_name||"",actionStatus:r.status||"open",actionPriority:r.priority||"normal",delaySeconds:r.seconds||60,webhookUrl:r.url||"",webhookMethod:(r.method||"POST").toUpperCase(),webhookTimeout:r.timeout||10})},L=()=>{B(!1),U(null),V(null),d({...W})},ye=()=>{if(a.type==="condition"){const t={type:a.conditionType};return["text_contains","text_equals","text_starts_with"].includes(a.conditionType)&&(t.value=a.conditionValue,t.case_sensitive=a.conditionCaseSensitive),a.conditionType==="regex_match"&&(t.pattern=a.regexPattern),a.conditionType==="time_window"&&(t.timezone=a.timeWindowTimezone,t.start_time=a.timeWindowStart,t.end_time=a.timeWindowEnd,t.days=a.timeWindowDays),a.conditionType==="connection_is"&&(t.connection_ids=a.conditionConnectionIds),a.conditionType==="conversation_status"&&(t.status=a.conditionStatus),a.conditionType==="tags_contains"&&(a.conditionTagId?t.tag_ids=[a.conditionTagId]:a.conditionTagName&&(t.tag_names=[a.conditionTagName])),a.isStart&&(t.is_start=!0),t}if(a.type==="delay"){const t={seconds:Number(a.delaySeconds)||1};return a.isStart&&(t.is_start=!0),t}if(a.type==="webhook"){const t={url:a.webhookUrl,method:a.webhookMethod,timeout:Number(a.webhookTimeout)||10};return a.isStart&&(t.is_start=!0),t}const s={action_type:a.actionType};if(a.actionType==="send_text"&&(s.message=a.actionMessage),a.actionType==="send_template"&&(s.template_id=a.actionTemplateId,a.actionTemplateVariables))try{s.variables=JSON.parse(a.actionTemplateVariables)}catch(t){throw n.error("Template variables must be valid JSON"),t}return a.actionType==="assign_agent"&&(s.agent_id=a.actionAgentId),a.actionType==="add_tag"&&(a.actionTagId&&(s.tag_id=a.actionTagId),a.actionTagName&&(s.tag=a.actionTagName)),a.actionType==="set_status"&&(s.status=a.actionStatus),a.actionType==="set_priority"&&(s.priority=a.actionPriority),a.isStart&&(s.is_start=!0),s},be=s=>{if(s.preventDefault(),!z)return;let t;try{t=ye()}catch{return}const r={type:a.type,config:t,sort_order:a.sortOrder===""?void 0:a.sortOrder};S?v.patch(route("app.chatbots.nodes.update",{node:S}),r,{preserveScroll:!0,onSuccess:()=>{n.success("Node updated successfully"),L()},onError:()=>n.error("Failed to update node")}):v.post(route("app.chatbots.nodes.store",{flow:z}),r,{preserveScroll:!0,onSuccess:()=>{n.success("Node added successfully"),L()},onError:()=>n.error("Failed to add node")})},ve=s=>{confirm("Delete this node?")&&v.delete(route("app.chatbots.nodes.destroy",{node:s}),{preserveScroll:!0,onSuccess:()=>n.success("Node deleted"),onError:()=>n.error("Failed to delete node")})},X=(s,t)=>{const p=k.get(s)?.nodes||[];$(s),Z(!0),N({id:t?.id??null,fromNodeId:t?.from_node_id??p[0]?.id??"",toNodeId:t?.to_node_id??p[1]?.id??"",label:t?.label??"next",sortOrder:t?.sort_order??""})},Y=()=>{Z(!1),$(null),N({id:null,fromNodeId:"",toNodeId:"",label:"next",sortOrder:""})},fe=()=>{if(!j)return;const s=k.get(j);if(!s)return;const t=[...s.edges||[]],r=t.findIndex(i=>i.id===m.id),p={id:m.id??Date.now(),from_node_id:m.fromNodeId,to_node_id:m.toNodeId,label:m.label||"next",sort_order:m.sortOrder===""?void 0:m.sortOrder};r>=0?t[r]=p:t.push(p),v.patch(route("app.chatbots.flows.update",{flow:j}),{edges:t.map((i,_)=>({from_node_id:i.from_node_id,to_node_id:i.to_node_id,label:i.label,sort_order:i.sort_order??_+1}))},{preserveScroll:!0,onSuccess:()=>{n.success("Edge saved"),Y()},onError:()=>n.error("Failed to save edge")})};return e.jsxs(Ee,{children:[e.jsx(Ne,{title:`${g.name} - Chatbot`}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs(we,{href:route("app.chatbots.index",{}),className:"inline-flex items-center gap-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors mb-4",children:[e.jsx(ke,{className:"h-4 w-4"}),"Back to Chatbots"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent flex items-center gap-3 mb-2",children:[e.jsx(ee,{className:"h-8 w-8 text-purple-600 dark:text-purple-400"}),g.name]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:g.description||"No description"})]}),ce(g.status)]})]}),e.jsx("form",{onSubmit:ie,className:"space-y-6",children:e.jsxs(I,{className:"border-0 shadow-lg",children:[e.jsx(F,{className:"bg-gradient-to-r from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-500 rounded-xl",children:e.jsx(ee,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx(E,{className:"text-xl font-bold",children:"Bot Settings"}),e.jsx(O,{children:"Update your chatbot configuration"})]})]})}),e.jsxs(A,{className:"p-6 space-y-5",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"name",value:"Bot Name",className:"text-sm font-semibold mb-2"}),e.jsx(c,{id:"name",type:"text",value:b.name,onChange:s=>f("name",s.target.value),className:"mt-1 rounded-xl",required:!0}),e.jsx(G,{message:D.name,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"description",value:"Description",className:"text-sm font-semibold mb-2"}),e.jsx("textarea",{id:"description",value:b.description,onChange:s=>f("description",s.target.value),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",rows:3,placeholder:"Describe what this bot does..."}),e.jsx(G,{message:D.description,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"status",value:"Status",className:"text-sm font-semibold mb-2"}),e.jsxs("select",{id:"status",value:b.status,onChange:s=>f("status",s.target.value),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"paused",children:"Paused"})]}),e.jsx(G,{message:D.status,className:"mt-2"})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(l,{value:"Applies To",className:"text-sm font-semibold mb-3"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-4 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-xl border border-gray-200 dark:border-gray-700",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx(h,{checked:b.applies_to.all_connections,onChange:s=>f("applies_to",{...b.applies_to,all_connections:s.target.checked})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"All connections"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:"Apply this bot to all WhatsApp connections"})]})]})}),!b.applies_to.all_connections&&e.jsx("div",{className:"space-y-2",children:w.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 p-4 bg-gray-50 dark:bg-gray-800 rounded-xl",children:"No connections available"}):w.map(s=>e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-xl border border-gray-200 dark:border-gray-700 hover:border-purple-300 dark:hover:border-purple-700 cursor-pointer transition-colors",children:[e.jsx(h,{checked:b.applies_to.connection_ids?.includes(s.id),onChange:()=>me(s.id)}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:s.name})]},s.id))})]})]}),e.jsx("div",{className:"flex items-center justify-end gap-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx(x,{type:"submit",disabled:K,className:"bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 shadow-lg shadow-purple-500/50 rounded-xl",children:K?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Save Changes"]})})})]})]})}),e.jsxs(I,{className:"border-0 shadow-lg",children:[e.jsx(F,{className:"bg-gradient-to-r from-gray-50 to-white dark:from-gray-800 dark:to-gray-900",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl",children:e.jsx(Te,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx(E,{className:"text-xl font-bold",children:"Flows"}),e.jsx(O,{children:"Define when and how the bot responds"})]})]}),e.jsxs(x,{variant:"secondary",size:"sm",className:"rounded-xl",onClick:()=>{M(!T),T||(P(null),u({...J}))},children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),T?"Close":"Add Flow"]})]})}),e.jsxs(A,{className:"p-6 space-y-6",children:[T&&e.jsxs("form",{onSubmit:pe,className:"space-y-4 rounded-xl border border-gray-200 dark:border-gray-700 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-gray-700 dark:text-gray-300",children:[e.jsx(Ce,{className:"h-4 w-4"}),C?"Edit Flow":"Create Flow"]}),e.jsxs("div",{children:[e.jsx(l,{value:"Flow Name",className:"text-sm font-semibold mb-2"}),e.jsx(c,{value:o.name,onChange:s=>u({...o,name:s.target.value}),className:"mt-1 rounded-xl",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{value:"Priority",className:"text-sm font-semibold mb-2"}),e.jsx(c,{type:"number",value:o.priority,onChange:s=>u({...o,priority:Number(s.target.value)}),className:"mt-1 rounded-xl"})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-7",children:[e.jsx(h,{checked:o.enabled,onChange:s=>u({...o,enabled:s.target.checked})}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Enabled"})]})]}),e.jsxs("div",{children:[e.jsx(l,{value:"Trigger Type",className:"text-sm font-semibold mb-2"}),e.jsxs("select",{value:o.triggerType,onChange:s=>u({...o,triggerType:s.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"inbound_message",children:"Inbound message"}),e.jsx("option",{value:"keyword",children:"Keyword match"}),e.jsx("option",{value:"button_reply",children:"Button reply"})]})]}),o.triggerType==="inbound_message"&&e.jsxs("div",{className:"space-y-3 rounded-xl border border-gray-200 dark:border-gray-700 p-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{checked:o.firstMessageOnly,onChange:s=>u({...o,firstMessageOnly:s.target.checked})}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Only first inbound message"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{checked:o.skipIfAssigned,onChange:s=>u({...o,skipIfAssigned:s.target.checked})}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Skip if already assigned"})]}),e.jsxs("div",{children:[e.jsx(l,{value:"Connections (optional)",className:"text-sm font-semibold mb-2"}),e.jsxs("div",{className:"space-y-2",children:[w.length===0&&e.jsx("p",{className:"text-xs text-gray-500",children:"No connections available"}),w.map(s=>e.jsxs("label",{className:"flex items-center gap-3 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx(h,{checked:o.triggerConnections.includes(s.id),onChange:t=>{const r=o.triggerConnections.includes(s.id)?o.triggerConnections.filter(p=>p!==s.id):[...o.triggerConnections,s.id];u({...o,triggerConnections:r})}}),s.name]},s.id))]})]})]}),o.triggerType==="keyword"&&e.jsxs("div",{className:"space-y-3 rounded-xl border border-gray-200 dark:border-gray-700 p-3",children:[e.jsxs("div",{children:[e.jsx(l,{value:"Keywords (comma separated)",className:"text-sm font-semibold mb-2"}),e.jsx(c,{value:o.keywords,onChange:s=>u({...o,keywords:s.target.value}),className:"mt-1 rounded-xl",placeholder:"pricing, demo, help"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{value:"Match Type",className:"text-sm font-semibold mb-2"}),e.jsxs("select",{value:o.matchType,onChange:s=>u({...o,matchType:s.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"any",children:"Any keyword"}),e.jsx("option",{value:"all",children:"All keywords"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-7",children:[e.jsx(h,{checked:o.caseSensitive,onChange:s=>u({...o,caseSensitive:s.target.checked})}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Case sensitive"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{checked:o.wholeWord,onChange:s=>u({...o,wholeWord:s.target.checked})}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Whole word match"})]})]})]}),o.triggerType==="button_reply"&&e.jsxs("div",{className:"space-y-3 rounded-xl border border-gray-200 dark:border-gray-700 p-3",children:[e.jsx(l,{value:"Button Reply ID",className:"text-sm font-semibold mb-2"}),e.jsx(c,{value:o.buttonId,onChange:s=>u({...o,buttonId:s.target.value}),className:"mt-1 rounded-xl",placeholder:"button_1"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{type:"submit",className:"rounded-xl",children:C?"Update Flow":"Create Flow"}),e.jsx(x,{type:"button",variant:"secondary",className:"rounded-xl",onClick:H,children:"Cancel"})]})]}),g.flows.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-900 mb-4",children:e.jsx(Se,{className:"h-8 w-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"No flows yet"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:"Add a flow to define when and how the bot responds to messages."})]}):e.jsx("div",{className:"space-y-6",children:g.flows.map(s=>e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-700 p-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:s.name}),e.jsx(ae,{variant:s.enabled?"success":"default",className:"px-2 py-1 text-xs",children:s.enabled?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Trigger: ",s.trigger?.type||"inbound_message"," â€¢ Priority: ",s.priority]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(x,{variant:"secondary",size:"sm",className:"rounded-xl",onClick:()=>ue(s),children:[e.jsx(Ie,{className:"h-4 w-4 mr-1"}),"Edit"]}),e.jsxs(x,{variant:"secondary",size:"sm",className:"rounded-xl",onClick:()=>Q(s.id),children:[e.jsx(se,{className:"h-4 w-4 mr-1"}),"Add Node"]}),e.jsxs(x,{variant:"secondary",size:"sm",className:"rounded-xl",onClick:()=>X(s.id),children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),"Add Edge"]}),e.jsxs(x,{variant:"danger",size:"sm",className:"rounded-xl",onClick:()=>xe(s.id),children:[e.jsx(Fe,{className:"h-4 w-4 mr-1"}),"Delete"]})]})]}),e.jsx("div",{className:"mt-4 space-y-2",children:e.jsx(Ae,{flow:s,onEditNode:t=>he(s.id,t),onAddNode:()=>Q(s.id),onDeleteNode:t=>ve(t),onSelectEdge:t=>X(s.id,t),onSaveGraph:t=>le(s.id,t)})})]},s.id))})]})]}),de&&z&&e.jsxs(I,{className:"border-0 shadow-lg",children:[e.jsx(F,{className:"bg-gradient-to-r from-gray-50 to-white dark:from-gray-800 dark:to-gray-900",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl",children:e.jsx(q,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx(E,{className:"text-xl font-bold",children:S?"Edit Node":"Add Node"}),e.jsx(O,{children:"Configure bot behavior step"})]})]})}),e.jsx(A,{className:"p-6",children:e.jsxs("form",{onSubmit:be,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{value:"Node Type",className:"text-sm font-semibold mb-2"}),e.jsxs("select",{value:a.type,onChange:s=>d({...a,type:s.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"action",children:"Action"}),e.jsx("option",{value:"condition",children:"Condition"}),e.jsx("option",{value:"delay",children:"Delay"}),e.jsx("option",{value:"webhook",children:"Webhook"})]})]}),e.jsxs("div",{children:[e.jsx(l,{value:"Sort Order",className:"text-sm font-semibold mb-2"}),e.jsx(c,{type:"number",value:a.sortOrder,onChange:s=>d({...a,sortOrder:s.target.value===""?"":Number(s.target.value)}),className:"mt-1 rounded-xl"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx(h,{checked:a.isStart,onChange:s=>d({...a,isStart:s.target.checked})}),"Mark as start node"]}),a.type==="condition"&&e.jsxs("div",{className:"space-y-4 rounded-xl border border-gray-200 dark:border-gray-700 p-4",children:[e.jsx(l,{value:"Condition Type",className:"text-sm font-semibold mb-2"}),e.jsxs("select",{value:a.conditionType,onChange:s=>d({...a,conditionType:s.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"text_contains",children:"Text contains"}),e.jsx("option",{value:"text_equals",children:"Text equals"}),e.jsx("option",{value:"text_starts_with",children:"Text starts with"}),e.jsx("option",{value:"regex_match",children:"Regex match"}),e.jsx("option",{value:"time_window",children:"Time window"}),e.jsx("option",{value:"connection_is",children:"Connection is"}),e.jsx("option",{value:"conversation_status",children:"Conversation status"}),e.jsx("option",{value:"tags_contains",children:"Contact has tag"})]}),["text_contains","text_equals","text_starts_with"].includes(a.conditionType)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{value:a.conditionValue,onChange:s=>d({...a,conditionValue:s.target.value}),className:"mt-1 rounded-xl",placeholder:"Enter value"}),e.jsxs("label",{className:"flex items-center gap-3 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx(h,{checked:a.conditionCaseSensitive,onChange:s=>d({...a,conditionCaseSensitive:s.target.checked})}),"Case sensitive"]})]}),a.conditionType==="regex_match"&&e.jsx(c,{value:a.regexPattern,onChange:s=>d({...a,regexPattern:s.target.value}),className:"mt-1 rounded-xl",placeholder:"/pattern/"}),a.conditionType==="time_window"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(c,{value:a.timeWindowTimezone,onChange:s=>d({...a,timeWindowTimezone:s.target.value}),className:"mt-1 rounded-xl",placeholder:"Timezone (e.g. UTC)"}),e.jsx(c,{value:a.timeWindowStart,onChange:s=>d({...a,timeWindowStart:s.target.value}),className:"mt-1 rounded-xl",placeholder:"Start (HH:MM)"}),e.jsx(c,{value:a.timeWindowEnd,onChange:s=>d({...a,timeWindowEnd:s.target.value}),className:"mt-1 rounded-xl",placeholder:"End (HH:MM)"})]}),e.jsx("div",{className:"flex flex-wrap gap-3 text-sm text-gray-700 dark:text-gray-300",children:[{label:"Sun",value:0},{label:"Mon",value:1},{label:"Tue",value:2},{label:"Wed",value:3},{label:"Thu",value:4},{label:"Fri",value:5},{label:"Sat",value:6}].map(s=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx(h,{checked:a.timeWindowDays.includes(s.value),onChange:()=>{const t=a.timeWindowDays.includes(s.value)?a.timeWindowDays.filter(r=>r!==s.value):[...a.timeWindowDays,s.value];d({...a,timeWindowDays:t})}}),s.label]},s.value))})]}),a.conditionType==="connection_is"&&e.jsx("div",{className:"space-y-2",children:w.map(s=>e.jsxs("label",{className:"flex items-center gap-3 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx(h,{checked:a.conditionConnectionIds.includes(s.id),onChange:t=>{const r=a.conditionConnectionIds.includes(s.id)?a.conditionConnectionIds.filter(p=>p!==s.id):[...a.conditionConnectionIds,s.id];d({...a,conditionConnectionIds:r})}}),s.name]},s.id))}),a.conditionType==="conversation_status"&&e.jsxs("select",{value:a.conditionStatus,onChange:s=>d({...a,conditionStatus:s.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"closed",children:"Closed"})]}),a.conditionType==="tags_contains"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("select",{value:a.conditionTagId,onChange:s=>d({...a,conditionTagId:s.target.value?Number(s.target.value):""}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"",children:"Select tag"}),R.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx(c,{value:a.conditionTagName,onChange:s=>d({...a,conditionTagName:s.target.value}),className:"mt-1 rounded-xl",placeholder:"Or type tag name"})]})]}),a.type==="action"&&e.jsxs("div",{className:"space-y-4 rounded-xl border border-gray-200 dark:border-gray-700 p-4",children:[e.jsx(l,{value:"Action Type",className:"text-sm font-semibold mb-2"}),e.jsxs("select",{value:a.actionType,onChange:s=>d({...a,actionType:s.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"send_text",children:"Send text"}),e.jsx("option",{value:"send_template",children:"Send template"}),e.jsx("option",{value:"assign_agent",children:"Assign agent"}),e.jsx("option",{value:"add_tag",children:"Add tag"}),e.jsx("option",{value:"set_status",children:"Set status"}),e.jsx("option",{value:"set_priority",children:"Set priority"})]}),a.actionType==="send_text"&&e.jsx("textarea",{value:a.actionMessage,onChange:s=>d({...a,actionMessage:s.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",rows:3,placeholder:"Message text"}),a.actionType==="send_template"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("select",{value:a.actionTemplateId,onChange:s=>d({...a,actionTemplateId:s.target.value?Number(s.target.value):""}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"",children:"Select template"}),te.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.language,")"]},s.id))]}),e.jsx("textarea",{value:a.actionTemplateVariables,onChange:s=>d({...a,actionTemplateVariables:s.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",rows:3,placeholder:'{"1": "value"}'})]}),a.actionType==="assign_agent"&&e.jsxs("select",{value:a.actionAgentId,onChange:s=>d({...a,actionAgentId:s.target.value?Number(s.target.value):""}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"",children:"Select agent"}),re.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.role,")"]},s.id))]}),a.actionType==="add_tag"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("select",{value:a.actionTagId,onChange:s=>d({...a,actionTagId:s.target.value?Number(s.target.value):""}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"",children:"Select tag"}),R.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx(c,{value:a.actionTagName,onChange:s=>d({...a,actionTagName:s.target.value}),className:"mt-1 rounded-xl",placeholder:"Or type tag name"})]}),a.actionType==="set_status"&&e.jsxs("select",{value:a.actionStatus,onChange:s=>d({...a,actionStatus:s.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"closed",children:"Closed"})]}),a.actionType==="set_priority"&&e.jsxs("select",{value:a.actionPriority,onChange:s=>d({...a,actionPriority:s.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),a.type==="delay"&&e.jsx(c,{type:"number",value:a.delaySeconds,onChange:s=>d({...a,delaySeconds:Number(s.target.value)}),className:"mt-1 rounded-xl",placeholder:"Delay seconds"}),a.type==="webhook"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{value:a.webhookUrl,onChange:s=>d({...a,webhookUrl:s.target.value}),className:"mt-1 rounded-xl",placeholder:"https://example.com/hook"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("select",{value:a.webhookMethod,onChange:s=>d({...a,webhookMethod:s.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"POST",children:"POST"}),e.jsx("option",{value:"GET",children:"GET"})]}),e.jsx(c,{type:"number",value:a.webhookTimeout,onChange:s=>d({...a,webhookTimeout:Number(s.target.value)}),className:"mt-1 rounded-xl",placeholder:"Timeout (seconds)"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{type:"submit",className:"rounded-xl",children:S?"Update Node":"Add Node"}),e.jsx(x,{type:"button",variant:"secondary",className:"rounded-xl",onClick:L,children:"Cancel"})]})]})})]}),ne&&j&&e.jsxs(I,{className:"border-0 shadow-lg",children:[e.jsx(F,{className:"bg-gradient-to-r from-gray-50 to-white dark:from-gray-800 dark:to-gray-900",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl",children:e.jsx(q,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx(E,{className:"text-xl font-bold",children:m.id?"Edit Edge":"Add Edge"}),e.jsx(O,{children:"Connect nodes to define branching"})]})]})}),e.jsxs(A,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{value:"From Node",className:"text-sm font-semibold mb-2"}),e.jsx("select",{value:m.fromNodeId,onChange:s=>N({...m,fromNodeId:Number(s.target.value)}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:(k.get(j)?.nodes||[]).map(s=>e.jsxs("option",{value:s.id,children:["Node #",s.id," (",s.type,")"]},s.id))})]}),e.jsxs("div",{children:[e.jsx(l,{value:"To Node",className:"text-sm font-semibold mb-2"}),e.jsx("select",{value:m.toNodeId,onChange:s=>N({...m,toNodeId:Number(s.target.value)}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:(k.get(j)?.nodes||[]).map(s=>e.jsxs("option",{value:s.id,children:["Node #",s.id," (",s.type,")"]},s.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{value:"Label",className:"text-sm font-semibold mb-2"}),e.jsx(c,{value:m.label,onChange:s=>N({...m,label:s.target.value}),className:"mt-1 rounded-xl",placeholder:"true / false / next"})]}),e.jsxs("div",{children:[e.jsx(l,{value:"Sort Order",className:"text-sm font-semibold mb-2"}),e.jsx(c,{type:"number",value:m.sortOrder,onChange:s=>N({...m,sortOrder:s.target.value===""?"":Number(s.target.value)}),className:"mt-1 rounded-xl"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{className:"rounded-xl",onClick:fe,children:"Save Edge"}),e.jsx(x,{variant:"secondary",className:"rounded-xl",onClick:Y,children:"Cancel"})]})]})]})]})]})}export{Ye as default};
