import{r as y,j as e}from"./react-BhzSerM2.js";import{G as we,H as ke,l as _e,N as Te,a6 as ee,B as ae,a8 as Ce,a9 as Se,a0 as se,aa as Ie,Z as Fe,ab as Ee,L as q,e as v}from"./vendor-DxGhd0kb.js";import{A as Oe}from"./AppShell-Cc2RD8Vl.js";import{C as T,a as C,b as E,c as O,d as A}from"./Card-W2rT1n1C.js";import{B as te}from"./Badge-i1wYvjg_.js";import{B as x}from"./app-Iwsu59co.js";import{T as c}from"./TextInput-DRXLElIV.js";import{I as l}from"./InputLabel-qVeuR0hO.js";import{I as G}from"./InputError-6mWSc7R2.js";import{u as Ae}from"./useToast-m6H8bvjE.js";import{C as h}from"./Checkbox-CpJnf9Gf.js";import We from"./FlowBuilder-CLPIKrQ8.js";import"./Topbar-DdwsMJGZ.js";import"./GlobalFlashHandler-xHP6pVTU.js";import"./BrandingWrapper-DK418oSm.js";import"./Alert-CNardO3g.js";import"./CookieConsentBanner-CkGeiZeY.js";/* empty css            */const J={name:"",enabled:!0,priority:100,triggerType:"inbound_message",triggerConnections:[],firstMessageOnly:!1,skipIfAssigned:!1,keywords:"",matchType:"any",caseSensitive:!1,wholeWord:!1,buttonId:""},W={type:"action",sortOrder:"",isStart:!1,conditionType:"text_contains",conditionValue:"",conditionCaseSensitive:!1,regexPattern:"",timeWindowTimezone:"UTC",timeWindowStart:"09:00",timeWindowEnd:"17:00",timeWindowDays:[1,2,3,4,5],conditionConnectionIds:[],conditionStatus:"open",conditionTagId:"",conditionTagName:"",actionType:"send_text",actionMessage:"",actionTemplateId:"",actionTemplateVariables:"{}",actionAgentId:"",actionTagId:"",actionTagName:"",actionStatus:"open",actionPriority:"normal",delaySeconds:60,webhookUrl:"",webhookMethod:"POST",webhookTimeout:10};function ea({account:De,bot:m,connections:w,templates:re,tags:R,agents:oe}){const{toast:n}=Ae(),{data:b,setData:f,patch:de,processing:K,errors:D}=we({name:m.name,description:m.description||"",status:m.status,applies_to:m.applies_to}),[S,M]=y.useState(!1),[I,P]=y.useState(null),[o,g]=y.useState({...J}),[ne,B]=y.useState(!1),[z,U]=y.useState(null),[F,V]=y.useState(null),[s,d]=y.useState({...W}),[le,Z]=y.useState(!1),[j,$]=y.useState(null),[u,N]=y.useState({id:null,fromNodeId:"",toNodeId:"",label:"next",sortOrder:""}),k=y.useMemo(()=>new Map(m.flows.map(a=>[a.id,a])),[m.flows]),ie=(a,t)=>{if(!k.get(a))return;const p=t.edges.map((i,_)=>({from_node_id:i.from_node_id,to_node_id:i.to_node_id,label:i.label??"next",sort_order:i.sort_order??_+1}));v.patch(route("app.chatbots.flows.update",{flow:a}),{nodes:t.nodes.map((i,_)=>({id:i.id,type:i.type,config:i.config,sort_order:i.sort_order??_+1,pos_x:i.pos_x??null,pos_y:i.pos_y??null})),edges:p},{preserveScroll:!0,onSuccess:()=>n.success("Graph saved"),onError:()=>n.error("Failed to save graph")})},ce=a=>{a.preventDefault(),de(route("app.chatbots.update",{bot:m.id}),{onSuccess:()=>{n.success("Bot updated successfully")},onError:()=>{n.error("Failed to update bot")}})},me=()=>{confirm(`Delete bot "${m.name}"? This will also delete flows and execution logs.`)&&v.delete(route("app.chatbots.destroy",{bot:m.id}),{onSuccess:()=>n.success("Bot deleted"),onError:()=>n.error("Failed to delete bot")})},ue=a=>{const r={active:{variant:"success",label:"Active"},paused:{variant:"warning",label:"Paused"},draft:{variant:"default",label:"Draft"}}[a]||{variant:"default",label:a};return e.jsx(te,{variant:r.variant,className:"px-3 py-1",children:r.label})},ge=a=>{const t=b.applies_to.connection_ids||[];t.includes(a)?f("applies_to",{...b.applies_to,connection_ids:t.filter(r=>r!==a)}):f("applies_to",{...b.applies_to,connection_ids:[...t,a]})},H=()=>{g({...J}),P(null),M(!1)},xe=a=>{const t=a.trigger||{},r=t.type||"inbound_message";P(a.id),M(!0),g({name:a.name,enabled:a.enabled,priority:a.priority,triggerType:r,triggerConnections:t.connection_ids||[],firstMessageOnly:!!t.first_message_only,skipIfAssigned:!!t.skip_if_assigned,keywords:Array.isArray(t.keywords)?t.keywords.join(", "):"",matchType:t.match_type||"any",caseSensitive:!!t.case_sensitive,wholeWord:!!t.whole_word,buttonId:t.button_id||""})},pe=()=>o.triggerType==="keyword"?{type:"keyword",keywords:o.keywords.split(",").map(t=>t.trim()).filter(t=>t.length>0),match_type:o.matchType,case_sensitive:o.caseSensitive,whole_word:o.wholeWord}:o.triggerType==="button_reply"?{type:"button_reply",button_id:o.buttonId}:{type:"inbound_message",connection_ids:o.triggerConnections,first_message_only:o.firstMessageOnly,skip_if_assigned:o.skipIfAssigned},he=a=>{a.preventDefault();const t={name:o.name,enabled:o.enabled,priority:o.priority,trigger:pe()};I?v.patch(route("app.chatbots.flows.update",{flow:I}),t,{preserveScroll:!0,onSuccess:()=>{n.success("Flow updated successfully"),H()},onError:()=>{n.error("Failed to update flow")}}):v.post(route("app.chatbots.flows.store",{bot:m.id}),t,{preserveScroll:!0,onSuccess:()=>{n.success("Flow created successfully"),H()},onError:()=>{n.error("Failed to create flow")}})},be=a=>{confirm("Delete this flow?")&&v.delete(route("app.chatbots.flows.destroy",{flow:a}),{preserveScroll:!0,onSuccess:()=>n.success("Flow deleted"),onError:()=>n.error("Failed to delete flow")})},Q=a=>{U(a),V(null),d({...W}),B(!0)},ye=(a,t)=>{const r=t.config||{};U(a),V(t.id),B(!0),d({...W,type:t.type||"action",sortOrder:t.sort_order,isStart:r.is_start??!1,conditionType:r.type||"text_contains",conditionValue:r.value||"",conditionCaseSensitive:!!r.case_sensitive,regexPattern:r.pattern||"",timeWindowTimezone:r.timezone||"UTC",timeWindowStart:r.start_time||"09:00",timeWindowEnd:r.end_time||"17:00",timeWindowDays:r.days||[1,2,3,4,5],conditionConnectionIds:r.connection_ids||[],conditionStatus:r.status||"open",conditionTagId:r.tag_ids?.[0]||"",conditionTagName:r.tags?.[0]||r.tag_names?.[0]||"",actionType:r.action_type||"send_text",actionMessage:r.message||"",actionTemplateId:r.template_id||"",actionTemplateVariables:r.variables?JSON.stringify(r.variables,null,2):"{}",actionAgentId:r.agent_id||"",actionTagId:r.tag_id||"",actionTagName:r.tag||r.tag_name||"",actionStatus:r.status||"open",actionPriority:r.priority||"normal",delaySeconds:r.seconds||60,webhookUrl:r.url||"",webhookMethod:(r.method||"POST").toUpperCase(),webhookTimeout:r.timeout||10})},L=()=>{B(!1),U(null),V(null),d({...W})},ve=()=>{if(s.type==="condition"){const t={type:s.conditionType};return["text_contains","text_equals","text_starts_with"].includes(s.conditionType)&&(t.value=s.conditionValue,t.case_sensitive=s.conditionCaseSensitive),s.conditionType==="regex_match"&&(t.pattern=s.regexPattern),s.conditionType==="time_window"&&(t.timezone=s.timeWindowTimezone,t.start_time=s.timeWindowStart,t.end_time=s.timeWindowEnd,t.days=s.timeWindowDays),s.conditionType==="connection_is"&&(t.connection_ids=s.conditionConnectionIds),s.conditionType==="conversation_status"&&(t.status=s.conditionStatus),s.conditionType==="tags_contains"&&(s.conditionTagId?t.tag_ids=[s.conditionTagId]:s.conditionTagName&&(t.tag_names=[s.conditionTagName])),s.isStart&&(t.is_start=!0),t}if(s.type==="delay"){const t={seconds:Number(s.delaySeconds)||1};return s.isStart&&(t.is_start=!0),t}if(s.type==="webhook"){const t={url:s.webhookUrl,method:s.webhookMethod,timeout:Number(s.webhookTimeout)||10};return s.isStart&&(t.is_start=!0),t}const a={action_type:s.actionType};if(s.actionType==="send_text"&&(a.message=s.actionMessage),s.actionType==="send_template"&&(a.template_id=s.actionTemplateId,s.actionTemplateVariables))try{a.variables=JSON.parse(s.actionTemplateVariables)}catch(t){throw n.error("Template variables must be valid JSON"),t}return s.actionType==="assign_agent"&&(a.agent_id=s.actionAgentId),s.actionType==="add_tag"&&(s.actionTagId&&(a.tag_id=s.actionTagId),s.actionTagName&&(a.tag=s.actionTagName)),s.actionType==="set_status"&&(a.status=s.actionStatus),s.actionType==="set_priority"&&(a.priority=s.actionPriority),s.isStart&&(a.is_start=!0),a},fe=a=>{if(a.preventDefault(),!z)return;let t;try{t=ve()}catch{return}const r={type:s.type,config:t,sort_order:s.sortOrder===""?void 0:s.sortOrder};F?v.patch(route("app.chatbots.nodes.update",{node:F}),r,{preserveScroll:!0,onSuccess:()=>{n.success("Node updated successfully"),L()},onError:()=>n.error("Failed to update node")}):v.post(route("app.chatbots.nodes.store",{flow:z}),r,{preserveScroll:!0,onSuccess:()=>{n.success("Node added successfully"),L()},onError:()=>n.error("Failed to add node")})},je=a=>{confirm("Delete this node?")&&v.delete(route("app.chatbots.nodes.destroy",{node:a}),{preserveScroll:!0,onSuccess:()=>n.success("Node deleted"),onError:()=>n.error("Failed to delete node")})},X=(a,t)=>{const p=k.get(a)?.nodes||[];$(a),Z(!0),N({id:t?.id??null,fromNodeId:t?.from_node_id??p[0]?.id??"",toNodeId:t?.to_node_id??p[1]?.id??"",label:t?.label??"next",sortOrder:t?.sort_order??""})},Y=()=>{Z(!1),$(null),N({id:null,fromNodeId:"",toNodeId:"",label:"next",sortOrder:""})},Ne=()=>{if(!j)return;const a=k.get(j);if(!a)return;const t=[...a.edges||[]],r=t.findIndex(i=>i.id===u.id),p={id:u.id??Date.now(),from_node_id:u.fromNodeId,to_node_id:u.toNodeId,label:u.label||"next",sort_order:u.sortOrder===""?void 0:u.sortOrder};r>=0?t[r]=p:t.push(p),v.patch(route("app.chatbots.flows.update",{flow:j}),{edges:t.map((i,_)=>({from_node_id:i.from_node_id,to_node_id:i.to_node_id,label:i.label,sort_order:i.sort_order??_+1}))},{preserveScroll:!0,onSuccess:()=>{n.success("Edge saved"),Y()},onError:()=>n.error("Failed to save edge")})};return e.jsxs(Oe,{children:[e.jsx(ke,{title:`${m.name} - Chatbot`}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs(_e,{href:route("app.chatbots.index",{}),className:"inline-flex items-center gap-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors mb-4",children:[e.jsx(Te,{className:"h-4 w-4"}),"Back to Chatbots"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent flex items-center gap-3 mb-2",children:[e.jsx(ee,{className:"h-8 w-8 text-purple-600 dark:text-purple-400"}),m.name]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:m.description||"No description"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[ue(m.status),e.jsxs(x,{type:"button",variant:"danger",className:"rounded-xl",onClick:me,children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Delete Bot"]})]})]})]}),e.jsxs("form",{onSubmit:ce,className:"space-y-6",children:[b.status==="active"&&(m.health?.runnable_flows_count??0)===0&&e.jsx(T,{className:"border border-amber-200 dark:border-amber-700 bg-amber-50 dark:bg-amber-900/20 shadow-none",children:e.jsxs(C,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-amber-800 dark:text-amber-100",children:"This bot is active but has no runnable flow."}),e.jsx("div",{className:"text-xs text-amber-700 dark:text-amber-200 mt-1",children:"Add an enabled flow with at least one executable node (`action`, `delay`, or `webhook`)."})]})}),e.jsxs(T,{className:"border-0 shadow-lg",children:[e.jsx(E,{className:"bg-gradient-to-r from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-500 rounded-xl",children:e.jsx(ee,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx(O,{className:"text-xl font-bold",children:"Bot Settings"}),e.jsx(A,{children:"Update your chatbot configuration"})]})]})}),e.jsxs(C,{className:"p-6 space-y-5",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"name",value:"Bot Name",className:"text-sm font-semibold mb-2"}),e.jsx(c,{id:"name",type:"text",value:b.name,onChange:a=>f("name",a.target.value),className:"mt-1 rounded-xl",required:!0}),e.jsx(G,{message:D.name,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"description",value:"Description",className:"text-sm font-semibold mb-2"}),e.jsx("textarea",{id:"description",value:b.description,onChange:a=>f("description",a.target.value),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",rows:3,placeholder:"Describe what this bot does..."}),e.jsx(G,{message:D.description,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"status",value:"Status",className:"text-sm font-semibold mb-2"}),e.jsxs("select",{id:"status",value:b.status,onChange:a=>f("status",a.target.value),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"paused",children:"Paused"})]}),e.jsx(G,{message:D.status,className:"mt-2"})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(l,{value:"Applies To",className:"text-sm font-semibold mb-3"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-4 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-xl border border-gray-200 dark:border-gray-700",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx(h,{checked:b.applies_to.all_connections,onChange:a=>f("applies_to",{...b.applies_to,all_connections:a.target.checked})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"All connections"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:"Apply this bot to all WhatsApp connections"})]})]})}),!b.applies_to.all_connections&&e.jsx("div",{className:"space-y-2",children:w.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 p-4 bg-gray-50 dark:bg-gray-800 rounded-xl",children:"No connections available"}):w.map(a=>e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-xl border border-gray-200 dark:border-gray-700 hover:border-purple-300 dark:hover:border-purple-700 cursor-pointer transition-colors",children:[e.jsx(h,{checked:b.applies_to.connection_ids?.includes(a.id),onChange:()=>ge(a.id)}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:a.name})]},a.id))})]})]}),e.jsx("div",{className:"flex items-center justify-end gap-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx(x,{type:"submit",disabled:K,className:"bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 shadow-lg shadow-purple-500/50 rounded-xl",children:K?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Save Changes"]})})})]})]})]}),e.jsxs(T,{className:"border-0 shadow-lg",children:[e.jsx(E,{className:"bg-gradient-to-r from-gray-50 to-white dark:from-gray-800 dark:to-gray-900",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl",children:e.jsx(Se,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx(O,{className:"text-xl font-bold",children:"Flows"}),e.jsx(A,{children:"Define when and how the bot responds"})]})]}),e.jsxs(x,{variant:"secondary",size:"sm",className:"rounded-xl",onClick:()=>{M(!S),S||(P(null),g({...J}))},children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),S?"Close":"Add Flow"]})]})}),e.jsxs(C,{className:"p-6 space-y-6",children:[S&&e.jsxs("form",{onSubmit:he,className:"space-y-4 rounded-xl border border-gray-200 dark:border-gray-700 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-gray-700 dark:text-gray-300",children:[e.jsx(Ie,{className:"h-4 w-4"}),I?"Edit Flow":"Create Flow"]}),e.jsxs("div",{children:[e.jsx(l,{value:"Flow Name",className:"text-sm font-semibold mb-2"}),e.jsx(c,{value:o.name,onChange:a=>g({...o,name:a.target.value}),className:"mt-1 rounded-xl",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{value:"Priority",className:"text-sm font-semibold mb-2"}),e.jsx(c,{type:"number",value:o.priority,onChange:a=>g({...o,priority:Number(a.target.value)}),className:"mt-1 rounded-xl"})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-7",children:[e.jsx(h,{checked:o.enabled,onChange:a=>g({...o,enabled:a.target.checked})}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Enabled"})]})]}),e.jsxs("div",{children:[e.jsx(l,{value:"Trigger Type",className:"text-sm font-semibold mb-2"}),e.jsxs("select",{value:o.triggerType,onChange:a=>g({...o,triggerType:a.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"inbound_message",children:"Inbound message"}),e.jsx("option",{value:"keyword",children:"Keyword match"}),e.jsx("option",{value:"button_reply",children:"Button reply"})]})]}),o.triggerType==="inbound_message"&&e.jsxs("div",{className:"space-y-3 rounded-xl border border-gray-200 dark:border-gray-700 p-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{checked:o.firstMessageOnly,onChange:a=>g({...o,firstMessageOnly:a.target.checked})}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Only first inbound message"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{checked:o.skipIfAssigned,onChange:a=>g({...o,skipIfAssigned:a.target.checked})}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Skip if already assigned"})]}),e.jsxs("div",{children:[e.jsx(l,{value:"Connections (optional)",className:"text-sm font-semibold mb-2"}),e.jsxs("div",{className:"space-y-2",children:[w.length===0&&e.jsx("p",{className:"text-xs text-gray-500",children:"No connections available"}),w.map(a=>e.jsxs("label",{className:"flex items-center gap-3 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx(h,{checked:o.triggerConnections.includes(a.id),onChange:t=>{const r=o.triggerConnections.includes(a.id)?o.triggerConnections.filter(p=>p!==a.id):[...o.triggerConnections,a.id];g({...o,triggerConnections:r})}}),a.name]},a.id))]})]})]}),o.triggerType==="keyword"&&e.jsxs("div",{className:"space-y-3 rounded-xl border border-gray-200 dark:border-gray-700 p-3",children:[e.jsxs("div",{children:[e.jsx(l,{value:"Keywords (comma separated)",className:"text-sm font-semibold mb-2"}),e.jsx(c,{value:o.keywords,onChange:a=>g({...o,keywords:a.target.value}),className:"mt-1 rounded-xl",placeholder:"pricing, demo, help"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{value:"Match Type",className:"text-sm font-semibold mb-2"}),e.jsxs("select",{value:o.matchType,onChange:a=>g({...o,matchType:a.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"any",children:"Any keyword"}),e.jsx("option",{value:"all",children:"All keywords"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-7",children:[e.jsx(h,{checked:o.caseSensitive,onChange:a=>g({...o,caseSensitive:a.target.checked})}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Case sensitive"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{checked:o.wholeWord,onChange:a=>g({...o,wholeWord:a.target.checked})}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Whole word match"})]})]})]}),o.triggerType==="button_reply"&&e.jsxs("div",{className:"space-y-3 rounded-xl border border-gray-200 dark:border-gray-700 p-3",children:[e.jsx(l,{value:"Button Reply ID",className:"text-sm font-semibold mb-2"}),e.jsx(c,{value:o.buttonId,onChange:a=>g({...o,buttonId:a.target.value}),className:"mt-1 rounded-xl",placeholder:"button_1"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{type:"submit",className:"rounded-xl",children:I?"Update Flow":"Create Flow"}),e.jsx(x,{type:"button",variant:"secondary",className:"rounded-xl",onClick:H,children:"Cancel"})]})]}),m.flows.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-900 mb-4",children:e.jsx(Fe,{className:"h-8 w-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"No flows yet"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:"Add a flow to define when and how the bot responds to messages."})]}):e.jsx("div",{className:"space-y-6",children:m.flows.map(a=>e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-700 p-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:a.name}),e.jsx(te,{variant:a.enabled?"success":"default",className:"px-2 py-1 text-xs",children:a.enabled?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Trigger: ",a.trigger?.type||"inbound_message"," â€¢ Priority: ",a.priority]}),a.enabled&&a.health&&!a.health.is_runnable&&e.jsx("div",{className:"text-xs text-amber-600 dark:text-amber-300 mt-1",children:"Not runnable: add at least one executable node."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(x,{variant:"secondary",size:"sm",className:"rounded-xl",onClick:()=>xe(a),children:[e.jsx(Ee,{className:"h-4 w-4 mr-1"}),"Edit"]}),e.jsxs(x,{variant:"secondary",size:"sm",className:"rounded-xl",onClick:()=>Q(a.id),children:[e.jsx(se,{className:"h-4 w-4 mr-1"}),"Add Node"]}),e.jsxs(x,{variant:"secondary",size:"sm",className:"rounded-xl",onClick:()=>X(a.id),children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),"Add Edge"]}),e.jsxs(x,{variant:"danger",size:"sm",className:"rounded-xl",onClick:()=>be(a.id),children:[e.jsx(ae,{className:"h-4 w-4 mr-1"}),"Delete"]})]})]}),e.jsx("div",{className:"mt-4 space-y-2",children:e.jsx(We,{flow:a,onEditNode:t=>ye(a.id,t),onAddNode:()=>Q(a.id),onDeleteNode:t=>je(t),onSelectEdge:t=>X(a.id,t),onSaveGraph:t=>ie(a.id,t)})})]},a.id))})]})]}),ne&&z&&e.jsxs(T,{className:"border-0 shadow-lg",children:[e.jsx(E,{className:"bg-gradient-to-r from-gray-50 to-white dark:from-gray-800 dark:to-gray-900",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl",children:e.jsx(q,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx(O,{className:"text-xl font-bold",children:F?"Edit Node":"Add Node"}),e.jsx(A,{children:"Configure bot behavior step"})]})]})}),e.jsx(C,{className:"p-6",children:e.jsxs("form",{onSubmit:fe,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{value:"Node Type",className:"text-sm font-semibold mb-2"}),e.jsxs("select",{value:s.type,onChange:a=>d({...s,type:a.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"action",children:"Action"}),e.jsx("option",{value:"condition",children:"Condition"}),e.jsx("option",{value:"delay",children:"Delay"}),e.jsx("option",{value:"webhook",children:"Webhook"})]})]}),e.jsxs("div",{children:[e.jsx(l,{value:"Sort Order",className:"text-sm font-semibold mb-2"}),e.jsx(c,{type:"number",value:s.sortOrder,onChange:a=>d({...s,sortOrder:a.target.value===""?"":Number(a.target.value)}),className:"mt-1 rounded-xl"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx(h,{checked:s.isStart,onChange:a=>d({...s,isStart:a.target.checked})}),"Mark as start node"]}),s.type==="condition"&&e.jsxs("div",{className:"space-y-4 rounded-xl border border-gray-200 dark:border-gray-700 p-4",children:[e.jsx(l,{value:"Condition Type",className:"text-sm font-semibold mb-2"}),e.jsxs("select",{value:s.conditionType,onChange:a=>d({...s,conditionType:a.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"text_contains",children:"Text contains"}),e.jsx("option",{value:"text_equals",children:"Text equals"}),e.jsx("option",{value:"text_starts_with",children:"Text starts with"}),e.jsx("option",{value:"regex_match",children:"Regex match"}),e.jsx("option",{value:"time_window",children:"Time window"}),e.jsx("option",{value:"connection_is",children:"Connection is"}),e.jsx("option",{value:"conversation_status",children:"Conversation status"}),e.jsx("option",{value:"tags_contains",children:"Contact has tag"})]}),["text_contains","text_equals","text_starts_with"].includes(s.conditionType)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{value:s.conditionValue,onChange:a=>d({...s,conditionValue:a.target.value}),className:"mt-1 rounded-xl",placeholder:"Enter value"}),e.jsxs("label",{className:"flex items-center gap-3 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx(h,{checked:s.conditionCaseSensitive,onChange:a=>d({...s,conditionCaseSensitive:a.target.checked})}),"Case sensitive"]})]}),s.conditionType==="regex_match"&&e.jsx(c,{value:s.regexPattern,onChange:a=>d({...s,regexPattern:a.target.value}),className:"mt-1 rounded-xl",placeholder:"/pattern/"}),s.conditionType==="time_window"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(c,{value:s.timeWindowTimezone,onChange:a=>d({...s,timeWindowTimezone:a.target.value}),className:"mt-1 rounded-xl",placeholder:"Timezone (e.g. UTC)"}),e.jsx(c,{value:s.timeWindowStart,onChange:a=>d({...s,timeWindowStart:a.target.value}),className:"mt-1 rounded-xl",placeholder:"Start (HH:MM)"}),e.jsx(c,{value:s.timeWindowEnd,onChange:a=>d({...s,timeWindowEnd:a.target.value}),className:"mt-1 rounded-xl",placeholder:"End (HH:MM)"})]}),e.jsx("div",{className:"flex flex-wrap gap-3 text-sm text-gray-700 dark:text-gray-300",children:[{label:"Sun",value:0},{label:"Mon",value:1},{label:"Tue",value:2},{label:"Wed",value:3},{label:"Thu",value:4},{label:"Fri",value:5},{label:"Sat",value:6}].map(a=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx(h,{checked:s.timeWindowDays.includes(a.value),onChange:()=>{const t=s.timeWindowDays.includes(a.value)?s.timeWindowDays.filter(r=>r!==a.value):[...s.timeWindowDays,a.value];d({...s,timeWindowDays:t})}}),a.label]},a.value))})]}),s.conditionType==="connection_is"&&e.jsx("div",{className:"space-y-2",children:w.map(a=>e.jsxs("label",{className:"flex items-center gap-3 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx(h,{checked:s.conditionConnectionIds.includes(a.id),onChange:t=>{const r=s.conditionConnectionIds.includes(a.id)?s.conditionConnectionIds.filter(p=>p!==a.id):[...s.conditionConnectionIds,a.id];d({...s,conditionConnectionIds:r})}}),a.name]},a.id))}),s.conditionType==="conversation_status"&&e.jsxs("select",{value:s.conditionStatus,onChange:a=>d({...s,conditionStatus:a.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"closed",children:"Closed"})]}),s.conditionType==="tags_contains"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("select",{value:s.conditionTagId,onChange:a=>d({...s,conditionTagId:a.target.value?Number(a.target.value):""}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"",children:"Select tag"}),R.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),e.jsx(c,{value:s.conditionTagName,onChange:a=>d({...s,conditionTagName:a.target.value}),className:"mt-1 rounded-xl",placeholder:"Or type tag name"})]})]}),s.type==="action"&&e.jsxs("div",{className:"space-y-4 rounded-xl border border-gray-200 dark:border-gray-700 p-4",children:[e.jsx(l,{value:"Action Type",className:"text-sm font-semibold mb-2"}),e.jsxs("select",{value:s.actionType,onChange:a=>d({...s,actionType:a.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"send_text",children:"Send text"}),e.jsx("option",{value:"send_template",children:"Send template"}),e.jsx("option",{value:"assign_agent",children:"Assign agent"}),e.jsx("option",{value:"add_tag",children:"Add tag"}),e.jsx("option",{value:"set_status",children:"Set status"}),e.jsx("option",{value:"set_priority",children:"Set priority"})]}),s.actionType==="send_text"&&e.jsx("textarea",{value:s.actionMessage,onChange:a=>d({...s,actionMessage:a.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",rows:3,placeholder:"Message text"}),s.actionType==="send_template"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("select",{value:s.actionTemplateId,onChange:a=>d({...s,actionTemplateId:a.target.value?Number(a.target.value):""}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"",children:"Select template"}),re.map(a=>e.jsxs("option",{value:a.id,children:[a.name," (",a.language,")"]},a.id))]}),e.jsx("textarea",{value:s.actionTemplateVariables,onChange:a=>d({...s,actionTemplateVariables:a.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",rows:3,placeholder:'{"1": "value"}'})]}),s.actionType==="assign_agent"&&e.jsxs("select",{value:s.actionAgentId,onChange:a=>d({...s,actionAgentId:a.target.value?Number(a.target.value):""}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"",children:"Select agent"}),oe.map(a=>e.jsxs("option",{value:a.id,children:[a.name," (",a.role,")"]},a.id))]}),s.actionType==="add_tag"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("select",{value:s.actionTagId,onChange:a=>d({...s,actionTagId:a.target.value?Number(a.target.value):""}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"",children:"Select tag"}),R.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),e.jsx(c,{value:s.actionTagName,onChange:a=>d({...s,actionTagName:a.target.value}),className:"mt-1 rounded-xl",placeholder:"Or type tag name"})]}),s.actionType==="set_status"&&e.jsxs("select",{value:s.actionStatus,onChange:a=>d({...s,actionStatus:a.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"closed",children:"Closed"})]}),s.actionType==="set_priority"&&e.jsxs("select",{value:s.actionPriority,onChange:a=>d({...s,actionPriority:a.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),s.type==="delay"&&e.jsx(c,{type:"number",value:s.delaySeconds,onChange:a=>d({...s,delaySeconds:Number(a.target.value)}),className:"mt-1 rounded-xl",placeholder:"Delay seconds"}),s.type==="webhook"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{value:s.webhookUrl,onChange:a=>d({...s,webhookUrl:a.target.value}),className:"mt-1 rounded-xl",placeholder:"https://example.com/hook"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("select",{value:s.webhookMethod,onChange:a=>d({...s,webhookMethod:a.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"POST",children:"POST"}),e.jsx("option",{value:"GET",children:"GET"})]}),e.jsx(c,{type:"number",value:s.webhookTimeout,onChange:a=>d({...s,webhookTimeout:Number(a.target.value)}),className:"mt-1 rounded-xl",placeholder:"Timeout (seconds)"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{type:"submit",className:"rounded-xl",children:F?"Update Node":"Add Node"}),e.jsx(x,{type:"button",variant:"secondary",className:"rounded-xl",onClick:L,children:"Cancel"})]})]})})]}),le&&j&&e.jsxs(T,{className:"border-0 shadow-lg",children:[e.jsx(E,{className:"bg-gradient-to-r from-gray-50 to-white dark:from-gray-800 dark:to-gray-900",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl",children:e.jsx(q,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx(O,{className:"text-xl font-bold",children:u.id?"Edit Edge":"Add Edge"}),e.jsx(A,{children:"Connect nodes to define branching"})]})]})}),e.jsxs(C,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{value:"From Node",className:"text-sm font-semibold mb-2"}),e.jsx("select",{value:u.fromNodeId,onChange:a=>N({...u,fromNodeId:Number(a.target.value)}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:(k.get(j)?.nodes||[]).map(a=>e.jsxs("option",{value:a.id,children:["Node #",a.id," (",a.type,")"]},a.id))})]}),e.jsxs("div",{children:[e.jsx(l,{value:"To Node",className:"text-sm font-semibold mb-2"}),e.jsx("select",{value:u.toNodeId,onChange:a=>N({...u,toNodeId:Number(a.target.value)}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:(k.get(j)?.nodes||[]).map(a=>e.jsxs("option",{value:a.id,children:["Node #",a.id," (",a.type,")"]},a.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{value:"Label",className:"text-sm font-semibold mb-2"}),e.jsx(c,{value:u.label,onChange:a=>N({...u,label:a.target.value}),className:"mt-1 rounded-xl",placeholder:"true / false / next"})]}),e.jsxs("div",{children:[e.jsx(l,{value:"Sort Order",className:"text-sm font-semibold mb-2"}),e.jsx(c,{type:"number",value:u.sortOrder,onChange:a=>N({...u,sortOrder:a.target.value===""?"":Number(a.target.value)}),className:"mt-1 rounded-xl"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{className:"rounded-xl",onClick:Ne,children:"Save Edge"}),e.jsx(x,{variant:"secondary",className:"rounded-xl",onClick:Y,children:"Cancel"})]})]})]})]})]})}export{ea as default};
