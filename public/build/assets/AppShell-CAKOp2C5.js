import{j as e,r as n}from"./react-BhzSerM2.js";import{u as A,X as q,A as B,U as F,aa as D,ap as O,W as H,a2 as X,Z as U,g as G,a6 as Z,I as K,F as Y,aq as J,n as Q,ar as W,l as $,M as V,C as ee,E as re,m as te}from"./vendor-DxGhd0kb.js";import{c as S,a as ae,B as _}from"./app-DAXd03gX.js";import{T as se}from"./Topbar-DGBYSxei.js";import{T as ie,G as oe}from"./GlobalFlashHandler-xHP6pVTU.js";import{B as ne}from"./BrandingWrapper-DK418oSm.js";import{A as le}from"./Alert-DwA9ZChZ.js";import{C as de,A as ce}from"./CookieConsentBanner-pD2YLMzO.js";const ge={LayoutDashboard:W,Puzzle:Q,MessageCircle:J,FileText:Y,Inbox:K,Bot:Z,Sparkles:G,Zap:U,BarChart3:X,CreditCard:H,LifeBuoy:O,Settings:D,Users:F,Activity:B};function me({navigation:t,currentRoute:x,account:h,isOpen:p=!1,onClose:m}){const{branding:s}=A().props,l=s?.platform_name||"WACP",d=s?.logo_url,u=t.reduce((i,c)=>{const g=c.group||"other";return i[g]||(i[g]=[]),i[g].push(c),i},{}),a={core:"Core",messaging:"Messaging",automation:"Automation",ai:"AI",growth:"Growth",billing:"Billing"},v=(i,c)=>{const g=ge[i.icon]||W;let y="#";try{if(h)y=route(i.href,{});else return null}catch{return null}const j=x.includes(i.href.replace("app.",""));return e.jsxs($,{href:y,className:S("flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all duration-200 group",j?"bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg shadow-blue-500/50":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 hover:translate-x-1"),children:[e.jsx(g,{className:S("h-5 w-5 transition-transform duration-200",j?"text-white":"text-gray-500 dark:text-gray-400 group-hover:text-blue-600 dark:group-hover:text-blue-400",!j&&"group-hover:scale-110")}),e.jsx("span",{className:S(j?"font-semibold":"font-medium"),children:i.label})]},`${i.href}-${i.label}-${c}`)},k=e.jsx("nav",{className:"flex-1 overflow-y-auto p-6 space-y-8",children:Object.entries(u).map(([i,c])=>{const g=c.map(v).filter(y=>y!==null);return g.length===0?null:e.jsxs("div",{children:[a[i]&&e.jsx("h3",{className:"px-4 text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3",children:a[i]}),e.jsx("div",{className:"space-y-1.5",children:g})]},i)}).filter(Boolean)});return e.jsxs(e.Fragment,{children:[p&&e.jsx("div",{className:"lg:hidden fixed inset-0 z-40 bg-black/60 backdrop-blur-sm transition-opacity",onClick:m}),e.jsxs("aside",{className:S("lg:hidden fixed inset-y-0 left-0 z-50 w-72 bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 transform transition-transform duration-300 ease-in-out shadow-2xl",p?"translate-x-0":"-translate-x-full"),children:[e.jsxs("div",{className:"flex items-center justify-between h-16 px-6 border-b border-gray-200 dark:border-gray-800 bg-gradient-to-r from-gray-50 to-white dark:from-gray-900 dark:to-gray-800",children:[d?e.jsx("img",{src:d,alt:l,className:"h-8 w-auto"}):e.jsx("h2",{className:"text-lg font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent",children:l}),e.jsx("button",{onClick:m,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"Close sidebar",children:e.jsx(q,{className:"h-5 w-5 text-gray-700 dark:text-gray-300","aria-hidden":!0})})]}),k]}),e.jsxs("aside",{className:"hidden lg:flex lg:flex-col lg:w-72 lg:fixed lg:inset-y-0 lg:z-30 bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 shadow-lg",children:[e.jsx("div",{className:"flex items-center h-16 px-6 border-b border-gray-200 dark:border-gray-800 bg-gradient-to-r from-gray-50 to-white dark:from-gray-900 dark:to-gray-800",children:d?e.jsx("img",{src:d,alt:l,className:"h-8 w-auto"}):e.jsx("h2",{className:"text-lg font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent",children:l})}),k]})]})}const ue=t=>t.mime_type?t.mime_type.startsWith("image/"):/\.(png|jpe?g|gif|webp|svg)$/i.test(t.file_name),xe=t=>t.mime_type?t.mime_type==="application/pdf":/\.pdf$/i.test(t.file_name);function pe(){const{account:t,branding:x,supportSettings:h}=A().props,{subscribe:p}=ae();if(!(h?.live_chat_enabled??!0))return null;const[s,l]=n.useState(!1),[d,u]=n.useState(!1),[a,v]=n.useState(null),[k,i]=n.useState([]),[c,g]=n.useState(""),[y,j]=n.useState([]),[E,R]=n.useState(!1),N=n.useMemo(()=>({email:x?.support_email,phone:x?.support_phone}),[x?.support_email,x?.support_phone]);n.useEffect(()=>{if(!s||!t?.slug)return;let r=!0;return u(!0),window.axios.get(route("app.support.live",{}),{headers:{Accept:"application/json"}}).then(o=>{const f=o.data;r&&(v(f.thread),i(f.messages||[]))}).finally(()=>{r&&u(!1)}),()=>{r=!1}},[s,t?.slug]),n.useEffect(()=>{if(!a||!t?.id)return;const r=`account.${t.id}.support.thread.${a.id}`;try{console.log("[LiveChatWidget] Subscribing to channel",{channel:r,threadId:a.id,accountId:t.id});const o=p(r,"support.message.created",f=>{console.log("[LiveChatWidget] Received message",{payload:f,channel:r}),i(w=>w.some(C=>C.id===f.id)?w:[...w,f])});return()=>{try{o()}catch(f){console.warn("[LiveChatWidget] Error unsubscribing from channel",f)}}}catch(o){return console.error("[LiveChatWidget] Failed to subscribe to support channel",{channel:r,threadId:a.id,accountId:t.id,error:o}),()=>{}}},[p,a?.id,t?.id]);const M=async()=>{if(!c.trim()&&y.length===0||!t?.slug)return;const r=new FormData;c.trim()&&r.append("message",c.trim()),r.append("subject",a?.subject??"Live chat"),a?.id&&a.status!=="closed"&&r.append("thread_id",String(a.id)),y.forEach(b=>r.append("attachments[]",b)),g(""),j([]);const o=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),w=(await window.axios.post(route("app.support.live.message",{}),r,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":o||window.axios.defaults.headers.common["X-CSRF-TOKEN"]||""},withCredentials:!0})).data;w.thread&&v(w.thread);const C=w.message;C&&i(b=>b.some(L=>L.id===C.id)?b:[...b,C]);const I=w.bot;I&&i(b=>b.some(L=>L.id===I.id)?b:[...b,I])},P=async()=>{t?.slug&&(await window.axios.post(route("app.support.live.close",{}),{},{headers:{Accept:"application/json"}}),v(r=>r&&{...r,status:"closed"}))},T=()=>{v(null),i([]),g(""),j([])},z=async()=>{if(t?.slug){R(!0);try{const o=(await window.axios.post(route("app.support.live.request-human",{}),{},{headers:{Accept:"application/json"}})).data;o.thread&&v(o.thread)}finally{R(!1)}}};return e.jsxs("div",{className:"fixed bottom-6 right-6 z-40",children:[!s&&e.jsxs("button",{onClick:()=>l(!0),className:"flex items-center gap-2 rounded-full bg-blue-600 text-white px-4 py-3 shadow-lg hover:bg-blue-700 transition",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-semibold",children:"Live Chat"})]}),s&&e.jsxs("div",{className:"w-80 max-w-[90vw] rounded-2xl bg-white dark:bg-gray-900 shadow-xl border border-gray-200 dark:border-gray-800 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:"Support Live Chat"}),e.jsx("div",{className:"text-xs opacity-90",children:"We typically reply in a few minutes"})]}),e.jsx("button",{onClick:()=>l(!1),className:"p-1 hover:opacity-80",children:e.jsx(q,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"px-4 py-3 text-xs text-gray-500 dark:text-gray-400 border-b border-gray-200 dark:border-gray-800",children:N.email||N.phone?`Email ${N.email??"—"}${N.phone?` · ${N.phone}`:""}`:"Share details and we will assist you."}),e.jsxs("div",{className:"h-64 overflow-y-auto px-4 py-3 space-y-3",children:[d&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Loading chat..."}),!d&&k.length===0&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Start a conversation with our support team."}),a?.mode==="human"&&e.jsx("div",{className:"text-xs text-amber-700 dark:text-amber-300 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-md px-3 py-2",children:"A live agent has been requested. We will join shortly."}),a?.status==="closed"&&e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md px-3 py-2",children:"This chat is closed. Start a new conversation anytime."}),k.map(r=>e.jsxs("div",{className:`rounded-lg px-3 py-2 text-xs leading-relaxed ${r.sender_type==="admin"||r.sender_type==="bot"?"bg-blue-50 dark:bg-blue-900/30 text-gray-900 dark:text-gray-100":r.sender_type==="system"?"bg-amber-50 dark:bg-amber-900/30 text-gray-900 dark:text-gray-100":"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100"}`,children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wider opacity-60 mb-1",children:r.sender_type==="admin"?"Support":r.sender_type==="bot"?"Assistant":r.sender_type==="system"?"System":"You"}),r.body,r.attachments&&r.attachments.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:r.attachments.map(o=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("a",{href:o.url,target:"_blank",rel:"noreferrer",className:"block text-[11px] text-blue-600 dark:text-blue-300 hover:underline",children:o.file_name}),ue(o)&&e.jsx("img",{src:o.url,alt:o.file_name,className:"max-h-32 rounded-md border border-gray-200 dark:border-gray-700"}),xe(o)&&e.jsxs("details",{className:"text-[11px] text-gray-600 dark:text-gray-300",children:[e.jsx("summary",{className:"cursor-pointer",children:"Preview PDF"}),e.jsx("iframe",{src:o.url,className:"mt-2 h-36 w-full rounded-md border border-gray-200 dark:border-gray-700"})]})]},o.id))})]},r.id))]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-800 p-3 space-y-2",children:[a?.status!=="closed"&&a?.mode!=="human"&&e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"button",onClick:z,disabled:E,className:"text-xs font-semibold text-blue-600 dark:text-blue-400 hover:underline",children:E?"Requesting live agent...":"Talk to a live agent"})}),e.jsx("textarea",{value:c,onChange:r=>g(r.target.value),rows:2,disabled:a?.status==="closed",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100 text-sm disabled:opacity-60",placeholder:a?.status==="closed"?"Start a new chat to send messages.":"Type your message..."}),e.jsx("input",{type:"file",multiple:!0,disabled:a?.status==="closed",onChange:r=>j(Array.from(r.target.files||[])),className:"block w-full text-xs text-gray-500 file:mr-4 file:rounded-md file:border-0 file:bg-gray-100 file:px-3 file:py-1.5 file:text-xs file:font-semibold file:text-gray-700 hover:file:bg-gray-200 dark:file:bg-gray-800 dark:file:text-gray-200 dark:hover:file:bg-gray-700 disabled:opacity-60"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[a?.status==="closed"&&e.jsx(_,{type:"button",variant:"secondary",onClick:T,children:"New Chat"}),a?.status==="open"&&e.jsx(_,{type:"button",variant:"secondary",onClick:P,children:"End Chat"}),e.jsx(_,{type:"button",onClick:M,disabled:c.trim().length===0&&y.length===0||a?.status==="closed",children:"Send"})]})]})]})]})}function he(){const{auth:t}=A().props,[x,h]=n.useState(!1),[p,m]=n.useState(!1),s=t?.user,l=t?.profile_complete??!0;n.useEffect(()=>{sessionStorage.getItem("profile_incomplete_dismissed")==="true"&&m(!0)},[]),n.useEffect(()=>{l&&(m(!1),sessionStorage.removeItem("profile_incomplete_dismissed")),h(!!(!l&&!p&&s))},[l,p,s]);const d=()=>{m(!0),h(!1),sessionStorage.setItem("profile_incomplete_dismissed","true")},u=typeof window<"u"?window.location.pathname:"";return u==="/profile"||u.startsWith("/profile/")||u.startsWith("/platform")||!x||l?null:e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl shadow-2xl max-w-md w-full border border-gray-200 dark:border-gray-800 overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-amber-500 to-orange-500 px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(ee,{className:"h-6 w-6 text-white"})}),e.jsx("h3",{className:"text-lg font-bold text-white",children:"Complete Your Profile"})]}),e.jsx("button",{onClick:d,className:"p-1.5 rounded-lg hover:bg-white/20 transition-colors text-white","aria-label":"Dismiss",children:e.jsx(q,{className:"h-5 w-5","aria-hidden":!0})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs(le,{variant:"warning",children:[e.jsx(re,{className:"h-5 w-5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-sm mb-1",children:"Profile Incomplete"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Please complete your profile to access all features. The following information is required:"})]})]}),e.jsxs("div",{className:"space-y-2 pl-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${s?.name?"bg-green-500":"bg-red-500"}`}),e.jsxs("span",{className:s?.name?"text-gray-600 dark:text-gray-400":"font-semibold text-gray-900 dark:text-gray-100",children:["Full Name ",s?.name?"✓":"(Required)"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${s?.email?"bg-green-500":"bg-red-500"}`}),e.jsxs("span",{className:s?.email?"text-gray-600 dark:text-gray-400":"font-semibold text-gray-900 dark:text-gray-100",children:["Email Address ",s?.email?"✓":"(Required)"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${s?.phone?"bg-green-500":"bg-red-500"}`}),e.jsxs("span",{className:s?.phone?"text-gray-600 dark:text-gray-400":"font-semibold text-gray-900 dark:text-gray-100",children:["Phone Number ",s?.phone?"✓":"(Required)"]})]})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between gap-3",children:[e.jsx("button",{onClick:d,className:"text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors",children:"I'll do it later"}),e.jsx($,{href:route("profile.edit"),className:"flex items-center gap-2",children:e.jsxs(_,{className:"bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white shadow-lg",children:["Complete Profile",e.jsx(te,{className:"h-4 w-4 ml-1"})]})})]})]})})}function Ce({children:t}){const{account:x,navigation:h,auth:p,ziggy:m}=A().props,s=window.location.pathname,[l,d]=n.useState(!1);return n.useEffect(()=>{d(!1)},[s]),n.useEffect(()=>{m&&(window.Ziggy=m)},[m]),n.useEffect(()=>{const u=()=>{window.innerWidth>=1024&&d(!1)};return window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[]),e.jsx(ne,{children:e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-50 dark:from-gray-950 dark:via-gray-900 dark:to-gray-950",children:[e.jsx(me,{navigation:h||[],currentRoute:s,account:x,isOpen:l,onClose:()=>d(!1)}),e.jsxs("div",{className:"lg:pl-72",children:[e.jsx(se,{user:p?.user,onMenuClick:()=>d(!l)}),e.jsx("main",{className:"p-4 lg:p-6",children:t})]}),e.jsx(ie,{}),e.jsx(oe,{}),e.jsx(pe,{}),e.jsx(he,{}),e.jsx(de,{}),e.jsx(ce,{})]})})}export{Ce as A};
