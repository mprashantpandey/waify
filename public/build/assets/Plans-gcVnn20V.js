import{r as R,j as r}from"./react-B_HteL0F.js";import{H,l as K,Y as X,_ as O,o as G,T as V,$ as C,X as Y,e as w,a as A}from"./vendor-GYTC5Pip.js";import{A as Z}from"./AppShell-HrBHfcoG.js";import{C as E,a as J,b as Q,d as ee,c as S}from"./Card-CUbeq4wI.js";import{B as $}from"./Topbar-CPirX8py.js";import{B as v}from"./app-C0WBMkkY.js";import{u as re}from"./useToast-Rch7lQVh.js";import{u as te}from"./useNotifications-TrBdqubX.js";import"./GlobalFlashHandler-DpywDQft.js";import"./BrandingWrapper-DIBfDp2T.js";/* empty css            */function fe({workspace:m,plans:c,current_plan_key:se,current_modules:ae=[],razorpay_enabled:F=!1,razorpay_key_id:I=null}){const[N,n]=R.useState(null),[p,_]=R.useState("cards"),{addToast:l}=re(),{confirm:z}=te(),f=F&&!!I,b=(e,t)=>{if(e===null)return"Custom Pricing";if(e===0)return"Free";const s=e/100;return new Intl.NumberFormat("en-IN",{style:"currency",currency:t,minimumFractionDigits:0}).format(s)},M=async e=>{await z({title:"Switch Plan",message:"Are you sure you want to switch to this plan?",variant:"info"})&&(n(e),w.post(route("app.billing.switch-plan",{workspace:m.slug,plan:e}),{},{onSuccess:()=>{l({title:"Plan changed successfully",variant:"success"}),w.reload({only:["plans","current_plan_key"]})},onError:s=>{const i=s?.plan||s?.error||"Failed to change plan. Please try again.";l({title:"Failed to change plan",description:i,variant:"error"})},onFinish:()=>n(null)}))},T=()=>new Promise((e,t)=>{if(typeof window<"u"&&window.Razorpay){e();return}const s=document.querySelector('script[src="https://checkout.razorpay.com/v1/checkout.js"]');if(s){s.addEventListener("load",()=>e()),s.addEventListener("error",()=>t(new Error("Failed to load Razorpay script")));return}const i=document.createElement("script");i.src="https://checkout.razorpay.com/v1/checkout.js",i.async=!0,i.crossOrigin="anonymous",i.onload=()=>{setTimeout(()=>{window.Razorpay?e():t(new Error("Razorpay failed to initialize"))},100)},i.onerror=()=>t(new Error("Failed to load Razorpay script. Please check your internet connection.")),document.head.appendChild(i)}),B=async e=>{if(await z({title:"Purchase Plan",message:`Proceed to pay for ${e.name}?`,variant:"info"})){if(!f){l({title:"Razorpay is not configured",variant:"error"});return}n(e.key);try{await T();const s=`/app/${m.slug}/settings/billing/plans/${e.key}/razorpay/order`,i=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),P=await A.post(s,{},{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json",...i&&{"X-CSRF-TOKEN":i}}});if(!P.data)throw new Error("Invalid response from server");const{order_id:k,amount:u,currency:U,key_id:g}=P.data;if(!k||!u||!g)throw new Error("Missing required order data from server");if(!window.Razorpay)throw new Error("Razorpay script not loaded");if(!k||!u||!g)throw new Error("Invalid order data received from server");const j=typeof g=="string"?g.trim():g;if(!j)throw new Error("Invalid Razorpay Key ID received from server");if(!/^rzp_(test|live)_[A-Za-z0-9]+$/.test(j))throw new Error("Razorpay Key ID is invalid. Please verify the Key ID in platform settings.");const W=typeof u=="string"?parseInt(u,10):Number(u),q={key:j,amount:W,currency:U||"INR",order_id:k,name:m.name||"Waify",description:e.description||e.name,handler:async a=>{try{const o=`/app/${m.slug}/settings/billing/razorpay/confirm`;await A.post(o,{order_id:a.razorpay_order_id,payment_id:a.razorpay_payment_id,signature:a.razorpay_signature}),l({title:"Payment successful. Plan activated.",variant:"success"}),w.reload({only:["plans","current_plan_key","flash"]})}catch(o){const D=o?.response?.data?.message||o?.message||"Unknown error";l({title:"Payment captured, but activation failed.",description:D,variant:"error"})}},prefill:{name:m?.owner?.name||"",email:m?.owner?.email||""},theme:{color:"#2563eb"},modal:{ondismiss:()=>{n(null)}}},y=console.warn,x=console.error;console.warn=(...a)=>{const o=a.join(" ");o.includes("x-rtb-fingerprint-id")||o.includes("serviceworker")||o.includes("Refused to get unsafe header")||o.includes("Permissions policy violation")||o.includes("devicemotion events are blocked")||y.apply(console,a)},console.error=(...a)=>{const o=a.join(" ");o.includes("x-rtb-fingerprint-id")||o.includes("serviceworker")||o.includes("Refused to get unsafe header")||o.includes("Permissions policy violation")||o.includes("devicemotion events are blocked")||x.apply(console,a)};const h=new window.Razorpay(q);h.on("payment.failed",a=>{console.warn=y,console.error=x,l({title:"Payment failed",description:a.error?.description||a.error?.reason||"Payment could not be processed",variant:"error"}),n(null)}),h.on("modal.close",()=>{console.warn=y,console.error=x,n(null)}),h.on("error",a=>{console.warn=y,console.error=x,console.error("Razorpay error:",a),l({title:"Payment gateway error",description:a?.description||a?.message||"An error occurred with the payment gateway. Please verify your Razorpay account configuration in the Razorpay dashboard.",variant:"error"}),n(null)});try{h.open(),setTimeout(()=>{console.warn=y,console.error=x},2e3)}catch(a){console.warn=y,console.error=x,console.error("Failed to open Razorpay:",a),l({title:"Failed to open payment gateway",description:a?.message||"Please check your Razorpay configuration in platform settings. If the issue persists, verify your Razorpay test account is properly configured.",variant:"error"}),n(null)}}catch(s){console.error("Razorpay checkout error:",s);const i=s?.response?.data?.message||s?.message||"Failed to start Razorpay checkout. Please try again.";l({title:"Failed to start Razorpay checkout",description:i,variant:"error"}),n(null)}}},L=Array.from(new Set(c.flatMap(e=>e.modules))),d=e=>e===void 0?"N/A":e===-1||e===9999||e===9999999?"Unlimited":e.toLocaleString();return r.jsxs(Z,{children:[r.jsx(H,{title:"Available Plans"}),r.jsxs("div",{className:"space-y-8",children:[r.jsxs("div",{children:[r.jsx(K,{href:route("app.billing.index",{workspace:m.slug}),className:"inline-flex items-center gap-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors mb-4",children:"â† Back to Billing"}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent",children:"Available Plans"}),r.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Choose the plan that fits your needs"})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(v,{variant:p==="cards"?"primary":"secondary",size:"sm",onClick:()=>_("cards"),className:"rounded-xl",children:[r.jsx(X,{className:"h-4 w-4 mr-2"}),"Cards"]}),r.jsxs(v,{variant:p==="table"?"primary":"secondary",size:"sm",onClick:()=>_("table"),className:"rounded-xl",children:[r.jsx(O,{className:"h-4 w-4 mr-2"}),"Compare"]})]})]})]}),p==="cards"?r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:c.map(e=>r.jsxs(E,{className:`border-0 shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden ${e.is_current?"ring-2 ring-blue-500 dark:ring-blue-400 shadow-blue-500/20":""}`,children:[r.jsx(J,{className:`pb-4 ${e.is_current?"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20":"bg-gradient-to-r from-gray-50 to-white dark:from-gray-800 dark:to-gray-900"}`,children:r.jsxs("div",{className:"flex items-start justify-between mb-2",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx(Q,{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:e.name}),e.description&&r.jsx(ee,{className:"mt-1 text-xs",children:e.description})]}),e.is_current&&r.jsxs($,{variant:"success",className:"px-3 py-1 flex items-center gap-1",children:[r.jsx(G,{className:"h-3.5 w-3.5"}),"Current"]})]})}),r.jsxs(S,{className:"p-6 space-y-5",children:[r.jsxs("div",{children:[r.jsx("div",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100 mb-1",children:b(e.price_monthly,e.currency)}),r.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"per month"}),e.price_yearly&&r.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["or ",b(e.price_yearly,e.currency),"/year"]})]}),e.warnings.length>0&&r.jsx("div",{className:"p-3 bg-gradient-to-r from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-800/20 rounded-xl border border-yellow-200 dark:border-yellow-800",children:r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx(V,{className:"h-4 w-4 text-yellow-600 dark:text-yellow-400 mt-0.5 flex-shrink-0"}),r.jsx("div",{className:"text-xs text-yellow-800 dark:text-yellow-200",children:e.warnings.map((t,s)=>r.jsx("p",{children:t},s))})]})}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("div",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Limits"}),r.jsxs("div",{className:"space-y-2",children:[e.limits.messages_monthly!==void 0&&r.jsxs("div",{className:"flex items-center justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Messages:"}),r.jsxs("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[d(e.limits.messages_monthly),"/mo"]})]}),e.limits.template_sends_monthly!==void 0&&r.jsxs("div",{className:"flex items-center justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Templates:"}),r.jsxs("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[d(e.limits.template_sends_monthly),"/mo"]})]}),e.limits.whatsapp_connections!==void 0&&r.jsxs("div",{className:"flex items-center justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Connections:"}),r.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:d(e.limits.whatsapp_connections)})]}),e.limits.agents!==void 0&&r.jsxs("div",{className:"flex items-center justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Agents:"}),r.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:d(e.limits.agents)})]})]})]}),r.jsxs("div",{className:"space-y-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[r.jsx("div",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Modules"}),e.modules.length>0?r.jsx("div",{className:"space-y-1.5",children:e.modules.map(t=>r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[r.jsx(C,{className:"h-4 w-4 text-green-600 dark:text-green-400 flex-shrink-0"}),r.jsx("span",{className:"text-xs",children:t.replace("automation.","").replace(/\./g," ").split(" ").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" ")})]},t))}):r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No modules"})]}),e.trial_days>0&&r.jsxs("div",{className:"p-2 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-xs text-blue-600 dark:text-blue-400 font-medium text-center",children:[e.trial_days,"-day free trial"]}),r.jsx(v,{variant:e.is_current?"secondary":"primary",className:`w-full rounded-xl ${e.is_current?"":"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 shadow-lg shadow-blue-500/50"}`,disabled:e.is_current||N===e.key||e.price_monthly===null,onClick:()=>{if(e.price_monthly&&e.price_monthly>0&&f){B(e);return}M(e.key)},children:e.is_current?"Current Plan":N===e.key?"Switching...":e.price_monthly===null?"Contact Sales":e.price_monthly>0&&f?"Pay & Switch":"Switch to this Plan"})]})]},e.key))}):r.jsx(E,{className:"border-0 shadow-lg",children:r.jsx(S,{className:"p-0",children:r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 border-b border-gray-200 dark:border-gray-700",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Feature"}),c.map(e=>r.jsxs("th",{className:`px-6 py-4 text-center ${e.is_current?"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20":""}`,children:[r.jsx("div",{className:"font-bold text-gray-900 dark:text-gray-100",children:e.name}),r.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-2",children:b(e.price_monthly,e.currency)}),e.is_current&&r.jsx($,{variant:"success",className:"mt-2 px-3 py-1",children:"Current"})]},e.key))]})}),r.jsxs("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-800 bg-white dark:bg-gray-900",children:[r.jsxs("tr",{children:[r.jsx("td",{className:"px-6 py-4 font-semibold text-gray-900 dark:text-gray-100",children:"Messages/month"}),c.map(e=>r.jsx("td",{className:`px-6 py-4 text-center text-sm font-medium ${e.is_current?"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20":""}`,children:d(e.limits.messages_monthly)},e.key))]}),r.jsxs("tr",{children:[r.jsx("td",{className:"px-6 py-4 font-semibold text-gray-900 dark:text-gray-100",children:"Template sends/month"}),c.map(e=>r.jsx("td",{className:`px-6 py-4 text-center text-sm font-medium ${e.is_current?"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20":""}`,children:d(e.limits.template_sends_monthly)},e.key))]}),r.jsxs("tr",{children:[r.jsx("td",{className:"px-6 py-4 font-semibold text-gray-900 dark:text-gray-100",children:"WhatsApp Connections"}),c.map(e=>r.jsx("td",{className:`px-6 py-4 text-center text-sm font-medium ${e.is_current?"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20":""}`,children:d(e.limits.whatsapp_connections)},e.key))]}),r.jsxs("tr",{children:[r.jsx("td",{className:"px-6 py-4 font-semibold text-gray-900 dark:text-gray-100",children:"Agents"}),c.map(e=>r.jsx("td",{className:`px-6 py-4 text-center text-sm font-medium ${e.is_current?"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20":""}`,children:d(e.limits.agents)},e.key))]}),L.map(e=>r.jsxs("tr",{children:[r.jsx("td",{className:"px-6 py-4 font-semibold text-gray-900 dark:text-gray-100",children:e.replace("automation.","").replace(/\./g," ").split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}),c.map(t=>r.jsx("td",{className:`px-6 py-4 text-center ${t.is_current?"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20":""}`,children:t.modules.includes(e)?r.jsx(C,{className:"h-5 w-5 text-green-600 dark:text-green-400 mx-auto"}):r.jsx(Y,{className:"h-5 w-5 text-gray-300 dark:text-gray-700 mx-auto"})},t.key))]},e))]})]})})})})]})]})}export{fe as default};
