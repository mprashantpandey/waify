import{r as y,j as e}from"./react-BhzSerM2.js";import{u as we,H as _e,q as ke,V as Te,a9 as ee,e as ae,ab as Ce,ac as Se,f as te,ad as Ie,Z as Fe,ae as Ee,L as J,k as v}from"./vendor-YQoUUhbX.js";import{A as Be}from"./AppShell-A6sQ3pxr.js";import{C as T,a as C,b as E,c as B,d as O}from"./Card-CRSrZ5HZ.js";import{B as se}from"./Badge-C6d-QEGL.js";import{B as g}from"./app-DjsbE74r.js";import{T as l}from"./TextInput-DRXLElIV.js";import{I as i}from"./InputLabel-qVeuR0hO.js";import{I as q}from"./InputError-6mWSc7R2.js";import{u as Oe}from"./useToast-C37H2DkG.js";import{C as p}from"./Checkbox-CpJnf9Gf.js";import Ae from"./FlowBuilder-xe0y7gTd.js";import"./Topbar-D6SeU-QE.js";import"./GlobalFlashHandler-DjMhmIiM.js";import"./BrandingWrapper-Djq-D_tN.js";import"./Alert-u60ICsin.js";import"./CookieConsentBanner-C37xsP7H.js";/* empty css            */const G={name:"",enabled:!0,priority:100,triggerType:"inbound_message",triggerConnections:[],firstMessageOnly:!1,skipIfAssigned:!1,keywords:"",matchType:"any",caseSensitive:!1,wholeWord:!1,buttonId:""},A={type:"action",sortOrder:"",isStart:!1,conditionType:"text_contains",conditionValue:"",conditionCaseSensitive:!1,regexPattern:"",timeWindowTimezone:"UTC",timeWindowStart:"09:00",timeWindowEnd:"17:00",timeWindowDays:[1,2,3,4,5],conditionConnectionIds:[],conditionStatus:"open",conditionTagId:"",conditionTagName:"",actionType:"send_text",actionMessage:"",actionTemplateId:"",actionTemplateVariables:"{}",actionListId:"",actionButtonsJson:"[]",actionButtonBodyText:"",actionButtonHeaderText:"",actionButtonFooterText:"",actionAgentId:"",actionTagId:"",actionTagName:"",actionStatus:"open",actionPriority:"normal",delaySeconds:60,webhookUrl:"",webhookMethod:"POST",webhookTimeout:10};function ea({account:We,bot:c,connections:w,templates:re,tags:R,agents:oe}){const{toast:d}=Oe(),{data:h,setData:f,patch:ne,processing:K,errors:W}=we({name:c.name,description:c.description||"",status:c.status,applies_to:c.applies_to,stop_on_first_flow:c.stop_on_first_flow??!0}),[S,D]=y.useState(!1),[I,M]=y.useState(null),[o,x]=y.useState({...G}),[de,P]=y.useState(!1),[H,z]=y.useState(null),[F,U]=y.useState(null),[t,n]=y.useState({...A}),[le,Z]=y.useState(!1),[j,$]=y.useState(null),[u,N]=y.useState({id:null,fromNodeId:"",toNodeId:"",label:"next",sortOrder:""}),_=y.useMemo(()=>new Map(c.flows.map(a=>[a.id,a])),[c.flows]),ie=(a,s)=>{if(!_.get(a))return;const b=s.edges.map((m,k)=>({from_node_id:m.from_node_id,to_node_id:m.to_node_id,label:m.label??"next",sort_order:m.sort_order??k+1}));v.patch(route("app.chatbots.flows.update",{flow:a}),{nodes:s.nodes.map((m,k)=>({id:m.id,type:m.type,config:m.config,sort_order:m.sort_order??k+1,pos_x:m.pos_x??null,pos_y:m.pos_y??null})),edges:b},{preserveScroll:!0,onSuccess:()=>d.success("Graph saved"),onError:()=>d.error("Failed to save graph")})},ce=a=>{a.preventDefault(),ne(route("app.chatbots.update",{bot:c.id}),{onSuccess:()=>{d.success("Bot updated successfully")},onError:()=>{d.error("Failed to update bot")}})},me=()=>{confirm(`Delete bot "${c.name}"? This will also delete flows and execution logs.`)&&v.post(route("app.chatbots.destroy.post",{bot:c.id}),{_method:"delete"},{onSuccess:()=>d.success("Bot deleted"),onError:()=>d.error("Failed to delete bot")})},ue=a=>{const r={active:{variant:"success",label:"Active"},paused:{variant:"warning",label:"Paused"},draft:{variant:"default",label:"Draft"}}[a]||{variant:"default",label:a};return e.jsx(se,{variant:r.variant,className:"px-3 py-1",children:r.label})},xe=a=>{const s=h.applies_to.connection_ids||[];s.includes(a)?f("applies_to",{...h.applies_to,connection_ids:s.filter(r=>r!==a)}):f("applies_to",{...h.applies_to,connection_ids:[...s,a]})},L=()=>{x({...G}),M(null),D(!1)},ge=a=>{const s=a.trigger||{},r=s.type||"inbound_message";M(a.id),D(!0),x({name:a.name,enabled:a.enabled,priority:a.priority,triggerType:r,triggerConnections:s.connection_ids||[],firstMessageOnly:!!s.first_message_only,skipIfAssigned:!!s.skip_if_assigned,keywords:Array.isArray(s.keywords)?s.keywords.join(", "):"",matchType:s.match_type||"any",caseSensitive:!!s.case_sensitive,wholeWord:!!s.whole_word,buttonId:s.button_id||""})},pe=()=>o.triggerType==="keyword"?{type:"keyword",keywords:o.keywords.split(",").map(s=>s.trim()).filter(s=>s.length>0),match_type:o.matchType,case_sensitive:o.caseSensitive,whole_word:o.wholeWord}:o.triggerType==="button_reply"?{type:"button_reply",button_id:o.buttonId}:{type:"inbound_message",connection_ids:o.triggerConnections,first_message_only:o.firstMessageOnly,skip_if_assigned:o.skipIfAssigned},he=a=>{a.preventDefault();const s={name:o.name,enabled:o.enabled,priority:o.priority,trigger:pe()};I?v.patch(route("app.chatbots.flows.update",{flow:I}),s,{preserveScroll:!0,onSuccess:()=>{d.success("Flow updated successfully"),L()},onError:()=>{d.error("Failed to update flow")}}):v.post(route("app.chatbots.flows.store",{bot:c.id}),s,{preserveScroll:!0,onSuccess:()=>{d.success("Flow created successfully"),L()},onError:()=>{d.error("Failed to create flow")}})},be=a=>{confirm("Delete this flow?")&&v.delete(route("app.chatbots.flows.destroy",{flow:a}),{preserveScroll:!0,onSuccess:()=>d.success("Flow deleted"),onError:()=>d.error("Failed to delete flow")})},Q=a=>{z(a),U(null),n({...A}),P(!0)},ye=(a,s)=>{const r=s.config||{};z(a),U(s.id),P(!0),n({...A,type:s.type||"action",sortOrder:s.sort_order,isStart:r.is_start??!1,conditionType:r.type||"text_contains",conditionValue:r.value||"",conditionCaseSensitive:!!r.case_sensitive,regexPattern:r.pattern||"",timeWindowTimezone:r.timezone||"UTC",timeWindowStart:r.start_time||"09:00",timeWindowEnd:r.end_time||"17:00",timeWindowDays:r.days||[1,2,3,4,5],conditionConnectionIds:r.connection_ids||[],conditionStatus:r.status||"open",conditionTagId:r.tag_ids?.[0]||"",conditionTagName:r.tags?.[0]||r.tag_names?.[0]||"",actionType:r.action_type||"send_text",actionMessage:r.message||"",actionTemplateId:r.template_id||"",actionTemplateVariables:r.variables?JSON.stringify(r.variables,null,2):"{}",actionListId:r.list_id||"",actionButtonsJson:r.buttons?JSON.stringify(r.buttons,null,2):"[]",actionButtonBodyText:r.body_text||r.message||"",actionButtonHeaderText:r.header_text||"",actionButtonFooterText:r.footer_text||"",actionAgentId:r.agent_id||"",actionTagId:r.tag_id||"",actionTagName:r.tag||r.tag_name||"",actionStatus:r.status||"open",actionPriority:r.priority||"normal",delaySeconds:r.seconds||60,webhookUrl:r.url||"",webhookMethod:(r.method||"POST").toUpperCase(),webhookTimeout:r.timeout||10})},V=()=>{P(!1),z(null),U(null),n({...A})},ve=()=>{if(t.type==="condition"){const s={type:t.conditionType};return["text_contains","text_equals","text_starts_with"].includes(t.conditionType)&&(s.value=t.conditionValue,s.case_sensitive=t.conditionCaseSensitive),t.conditionType==="regex_match"&&(s.pattern=t.regexPattern),t.conditionType==="time_window"&&(s.timezone=t.timeWindowTimezone,s.start_time=t.timeWindowStart,s.end_time=t.timeWindowEnd,s.days=t.timeWindowDays),t.conditionType==="connection_is"&&(s.connection_ids=t.conditionConnectionIds),t.conditionType==="conversation_status"&&(s.status=t.conditionStatus),t.conditionType==="tags_contains"&&(t.conditionTagId?s.tag_ids=[t.conditionTagId]:t.conditionTagName&&(s.tag_names=[t.conditionTagName])),t.isStart&&(s.is_start=!0),s}if(t.type==="delay"){const s={seconds:Number(t.delaySeconds)||1};return t.isStart&&(s.is_start=!0),s}if(t.type==="webhook"){const s={url:t.webhookUrl,method:t.webhookMethod,timeout:Number(t.webhookTimeout)||10};return t.isStart&&(s.is_start=!0),s}const a={action_type:t.actionType};if(t.actionType==="send_text"&&(a.message=t.actionMessage),t.actionType==="send_template"&&(a.template_id=t.actionTemplateId,t.actionTemplateVariables))try{a.variables=JSON.parse(t.actionTemplateVariables)}catch(s){throw d.error("Template variables must be valid JSON"),s}if(t.actionType==="send_list"&&(a.list_id=Number(t.actionListId)),t.actionType==="send_buttons"){a.body_text=t.actionButtonBodyText,a.header_text=t.actionButtonHeaderText||null,a.footer_text=t.actionButtonFooterText||null;try{a.buttons=JSON.parse(t.actionButtonsJson||"[]")}catch(s){throw d.error("Buttons must be valid JSON"),s}}return t.actionType==="assign_agent"&&(a.agent_id=t.actionAgentId),t.actionType==="add_tag"&&(t.actionTagId&&(a.tag_id=t.actionTagId),t.actionTagName&&(a.tag=t.actionTagName)),t.actionType==="set_status"&&(a.status=t.actionStatus),t.actionType==="set_priority"&&(a.priority=t.actionPriority),t.isStart&&(a.is_start=!0),a},fe=a=>{if(a.preventDefault(),!H)return;let s;try{s=ve()}catch{return}const r={type:t.type,config:s,sort_order:t.sortOrder===""?void 0:t.sortOrder};F?v.patch(route("app.chatbots.nodes.update",{node:F}),r,{preserveScroll:!0,onSuccess:()=>{d.success("Node updated successfully"),V()},onError:()=>d.error("Failed to update node")}):v.post(route("app.chatbots.nodes.store",{flow:H}),r,{preserveScroll:!0,onSuccess:()=>{d.success("Node added successfully"),V()},onError:()=>d.error("Failed to add node")})},je=a=>{confirm("Delete this node?")&&v.delete(route("app.chatbots.nodes.destroy",{node:a}),{preserveScroll:!0,onSuccess:()=>d.success("Node deleted"),onError:()=>d.error("Failed to delete node")})},X=(a,s)=>{const b=_.get(a)?.nodes||[];$(a),Z(!0),N({id:s?.id??null,fromNodeId:s?.from_node_id??b[0]?.id??"",toNodeId:s?.to_node_id??b[1]?.id??"",label:s?.label??"next",sortOrder:s?.sort_order??""})},Y=()=>{Z(!1),$(null),N({id:null,fromNodeId:"",toNodeId:"",label:"next",sortOrder:""})},Ne=()=>{if(!j)return;const a=_.get(j);if(!a)return;const s=[...a.edges||[]],r=s.findIndex(m=>m.id===u.id),b={id:u.id??Date.now(),from_node_id:u.fromNodeId,to_node_id:u.toNodeId,label:u.label||"next",sort_order:u.sortOrder===""?void 0:u.sortOrder};r>=0?s[r]=b:s.push(b),v.patch(route("app.chatbots.flows.update",{flow:j}),{edges:s.map((m,k)=>({from_node_id:m.from_node_id,to_node_id:m.to_node_id,label:m.label,sort_order:m.sort_order??k+1}))},{preserveScroll:!0,onSuccess:()=>{d.success("Edge saved"),Y()},onError:()=>d.error("Failed to save edge")})};return e.jsxs(Be,{children:[e.jsx(_e,{title:`${c.name} - Chatbot`}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs(ke,{href:route("app.chatbots.index",{}),className:"inline-flex items-center gap-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors mb-4",children:[e.jsx(Te,{className:"h-4 w-4"}),"Back to Chatbots"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent flex items-center gap-3 mb-2",children:[e.jsx(ee,{className:"h-8 w-8 text-purple-600 dark:text-purple-400"}),c.name]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:c.description||"No description"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[ue(c.status),e.jsxs(g,{type:"button",variant:"danger",className:"rounded-xl",onClick:me,children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Delete Bot"]})]})]})]}),e.jsxs("form",{onSubmit:ce,className:"space-y-6",children:[h.status==="active"&&(c.health?.runnable_flows_count??0)===0&&e.jsx(T,{className:"border border-amber-200 dark:border-amber-700 bg-amber-50 dark:bg-amber-900/20 shadow-none",children:e.jsxs(C,{className:"p-4",children:[e.jsx("div",{className:"text-sm font-medium text-amber-800 dark:text-amber-100",children:"This bot is active but has no runnable flow."}),e.jsx("div",{className:"text-xs text-amber-700 dark:text-amber-200 mt-1",children:"Add an enabled flow with at least one executable node (`action`, `delay`, or `webhook`)."})]})}),e.jsxs(T,{className:"border-0 shadow-lg",children:[e.jsx(E,{className:"bg-gradient-to-r from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-500 rounded-xl",children:e.jsx(ee,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx(B,{className:"text-xl font-bold",children:"Bot Settings"}),e.jsx(O,{children:"Update your chatbot configuration"})]})]})}),e.jsxs(C,{className:"p-6 space-y-5",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"name",value:"Bot Name",className:"text-sm font-semibold mb-2"}),e.jsx(l,{id:"name",type:"text",value:h.name,onChange:a=>f("name",a.target.value),className:"mt-1 rounded-xl",required:!0}),e.jsx(q,{message:W.name,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"description",value:"Description",className:"text-sm font-semibold mb-2"}),e.jsx("textarea",{id:"description",value:h.description,onChange:a=>f("description",a.target.value),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",rows:3,placeholder:"Describe what this bot does..."}),e.jsx(q,{message:W.description,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"status",value:"Status",className:"text-sm font-semibold mb-2"}),e.jsxs("select",{id:"status",value:h.status,onChange:a=>f("status",a.target.value),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"paused",children:"Paused"})]}),e.jsx(q,{message:W.status,className:"mt-2"})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(i,{value:"Applies To",className:"text-sm font-semibold mb-3"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-4 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-xl border border-gray-200 dark:border-gray-700",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx(p,{checked:h.applies_to.all_connections,onChange:a=>f("applies_to",{...h.applies_to,all_connections:a.target.checked})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"All connections"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:"Apply this bot to all WhatsApp connections"})]})]})}),!h.applies_to.all_connections&&e.jsx("div",{className:"space-y-2",children:w.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 p-4 bg-gray-50 dark:bg-gray-800 rounded-xl",children:"No connections available"}):w.map(a=>e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-xl border border-gray-200 dark:border-gray-700 hover:border-purple-300 dark:hover:border-purple-700 cursor-pointer transition-colors",children:[e.jsx(p,{checked:h.applies_to.connection_ids?.includes(a.id),onChange:()=>xe(a.id)}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:a.name})]},a.id))})]})]}),e.jsx("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer p-4 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:[e.jsx(p,{checked:h.stop_on_first_flow,onChange:a=>f("stop_on_first_flow",a.target.checked)}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"Stop on first flow"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:"When a flow’s trigger matches, run only that flow and skip the rest for this message"})]})]})}),e.jsx("div",{className:"flex items-center justify-end gap-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx(g,{type:"submit",disabled:K,className:"bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 shadow-lg shadow-purple-500/50 rounded-xl",children:K?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Save Changes"]})})})]})]})]}),e.jsxs(T,{className:"border-0 shadow-lg",children:[e.jsx(E,{className:"bg-gradient-to-r from-gray-50 to-white dark:from-gray-800 dark:to-gray-900",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl",children:e.jsx(Se,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx(B,{className:"text-xl font-bold",children:"Flows"}),e.jsx(O,{children:"Define when and how the bot responds"})]})]}),e.jsxs(g,{variant:"secondary",size:"sm",className:"rounded-xl",onClick:()=>{D(!S),S||(M(null),x({...G}))},children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),S?"Close":"Add Flow"]})]})}),e.jsxs(C,{className:"p-6 space-y-6",children:[S&&e.jsxs("form",{onSubmit:he,className:"space-y-4 rounded-xl border border-gray-200 dark:border-gray-700 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-gray-700 dark:text-gray-300",children:[e.jsx(Ie,{className:"h-4 w-4"}),I?"Edit Flow":"Create Flow"]}),e.jsxs("div",{children:[e.jsx(i,{value:"Flow Name",className:"text-sm font-semibold mb-2"}),e.jsx(l,{value:o.name,onChange:a=>x({...o,name:a.target.value}),className:"mt-1 rounded-xl",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{value:"Priority",className:"text-sm font-semibold mb-2"}),e.jsx(l,{type:"number",value:o.priority,onChange:a=>x({...o,priority:Number(a.target.value)}),className:"mt-1 rounded-xl"})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-7",children:[e.jsx(p,{checked:o.enabled,onChange:a=>x({...o,enabled:a.target.checked})}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Enabled"})]})]}),e.jsxs("div",{children:[e.jsx(i,{value:"Trigger Type",className:"text-sm font-semibold mb-2"}),e.jsxs("select",{value:o.triggerType,onChange:a=>x({...o,triggerType:a.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"inbound_message",children:"Inbound message"}),e.jsx("option",{value:"keyword",children:"Keyword match"}),e.jsx("option",{value:"button_reply",children:"Button reply"})]})]}),o.triggerType==="inbound_message"&&e.jsxs("div",{className:"space-y-3 rounded-xl border border-gray-200 dark:border-gray-700 p-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(p,{checked:o.firstMessageOnly,onChange:a=>x({...o,firstMessageOnly:a.target.checked})}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Only first inbound message"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(p,{checked:o.skipIfAssigned,onChange:a=>x({...o,skipIfAssigned:a.target.checked})}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Skip if already assigned"})]}),e.jsxs("div",{children:[e.jsx(i,{value:"Connections (optional)",className:"text-sm font-semibold mb-2"}),e.jsxs("div",{className:"space-y-2",children:[w.length===0&&e.jsx("p",{className:"text-xs text-gray-500",children:"No connections available"}),w.map(a=>e.jsxs("label",{className:"flex items-center gap-3 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx(p,{checked:o.triggerConnections.includes(a.id),onChange:s=>{const r=o.triggerConnections.includes(a.id)?o.triggerConnections.filter(b=>b!==a.id):[...o.triggerConnections,a.id];x({...o,triggerConnections:r})}}),a.name]},a.id))]})]})]}),o.triggerType==="keyword"&&e.jsxs("div",{className:"space-y-3 rounded-xl border border-gray-200 dark:border-gray-700 p-3",children:[e.jsxs("div",{children:[e.jsx(i,{value:"Keywords (comma separated)",className:"text-sm font-semibold mb-2"}),e.jsx(l,{value:o.keywords,onChange:a=>x({...o,keywords:a.target.value}),className:"mt-1 rounded-xl",placeholder:"pricing, demo, help"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{value:"Match Type",className:"text-sm font-semibold mb-2"}),e.jsxs("select",{value:o.matchType,onChange:a=>x({...o,matchType:a.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"any",children:"Any keyword"}),e.jsx("option",{value:"all",children:"All keywords"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-7",children:[e.jsx(p,{checked:o.caseSensitive,onChange:a=>x({...o,caseSensitive:a.target.checked})}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Case sensitive"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(p,{checked:o.wholeWord,onChange:a=>x({...o,wholeWord:a.target.checked})}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Whole word match"})]})]})]}),o.triggerType==="button_reply"&&e.jsxs("div",{className:"space-y-3 rounded-xl border border-gray-200 dark:border-gray-700 p-3",children:[e.jsx(i,{value:"Button Reply ID",className:"text-sm font-semibold mb-2"}),e.jsx(l,{value:o.buttonId,onChange:a=>x({...o,buttonId:a.target.value}),className:"mt-1 rounded-xl",placeholder:"button_1"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{type:"submit",className:"rounded-xl",children:I?"Update Flow":"Create Flow"}),e.jsx(g,{type:"button",variant:"secondary",className:"rounded-xl",onClick:L,children:"Cancel"})]})]}),c.flows.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-900 mb-4",children:e.jsx(Fe,{className:"h-8 w-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"No flows yet"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:"Add a flow to define when and how the bot responds to messages."})]}):e.jsx("div",{className:"space-y-6",children:c.flows.map(a=>e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-700 p-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:a.name}),e.jsx(se,{variant:a.enabled?"success":"default",className:"px-2 py-1 text-xs",children:a.enabled?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Trigger: ",a.trigger?.type||"inbound_message"," • Priority: ",a.priority]}),a.enabled&&a.health&&!a.health.is_runnable&&e.jsx("div",{className:"text-xs text-amber-600 dark:text-amber-300 mt-1",children:"Not runnable: add at least one executable node."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(g,{variant:"secondary",size:"sm",className:"rounded-xl",onClick:()=>ge(a),children:[e.jsx(Ee,{className:"h-4 w-4 mr-1"}),"Edit"]}),e.jsxs(g,{variant:"secondary",size:"sm",className:"rounded-xl",onClick:()=>Q(a.id),children:[e.jsx(te,{className:"h-4 w-4 mr-1"}),"Add Node"]}),e.jsxs(g,{variant:"secondary",size:"sm",className:"rounded-xl",onClick:()=>X(a.id),children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),"Add Edge"]}),e.jsxs(g,{variant:"danger",size:"sm",className:"rounded-xl",onClick:()=>be(a.id),children:[e.jsx(ae,{className:"h-4 w-4 mr-1"}),"Delete"]})]})]}),e.jsx("div",{className:"mt-4 space-y-2",children:e.jsx(Ae,{flow:a,onEditNode:s=>ye(a.id,s),onAddNode:()=>Q(a.id),onDeleteNode:s=>je(s),onSelectEdge:s=>X(a.id,s),onSaveGraph:s=>ie(a.id,s)})})]},a.id))})]})]}),de&&H&&e.jsxs(T,{className:"border-0 shadow-lg",children:[e.jsx(E,{className:"bg-gradient-to-r from-gray-50 to-white dark:from-gray-800 dark:to-gray-900",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl",children:e.jsx(J,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx(B,{className:"text-xl font-bold",children:F?"Edit Node":"Add Node"}),e.jsx(O,{children:"Configure bot behavior step"})]})]})}),e.jsx(C,{className:"p-6",children:e.jsxs("form",{onSubmit:fe,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{value:"Node Type",className:"text-sm font-semibold mb-2"}),e.jsxs("select",{value:t.type,onChange:a=>n({...t,type:a.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"action",children:"Action"}),e.jsx("option",{value:"condition",children:"Condition"}),e.jsx("option",{value:"delay",children:"Delay"}),e.jsx("option",{value:"webhook",children:"Webhook"})]})]}),e.jsxs("div",{children:[e.jsx(i,{value:"Sort Order",className:"text-sm font-semibold mb-2"}),e.jsx(l,{type:"number",value:t.sortOrder,onChange:a=>n({...t,sortOrder:a.target.value===""?"":Number(a.target.value)}),className:"mt-1 rounded-xl"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx(p,{checked:t.isStart,onChange:a=>n({...t,isStart:a.target.checked})}),"Mark as start node"]}),t.type==="condition"&&e.jsxs("div",{className:"space-y-4 rounded-xl border border-gray-200 dark:border-gray-700 p-4",children:[e.jsx(i,{value:"Condition Type",className:"text-sm font-semibold mb-2"}),e.jsxs("select",{value:t.conditionType,onChange:a=>n({...t,conditionType:a.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"text_contains",children:"Text contains"}),e.jsx("option",{value:"text_equals",children:"Text equals"}),e.jsx("option",{value:"text_starts_with",children:"Text starts with"}),e.jsx("option",{value:"regex_match",children:"Regex match"}),e.jsx("option",{value:"time_window",children:"Time window"}),e.jsx("option",{value:"connection_is",children:"Connection is"}),e.jsx("option",{value:"conversation_status",children:"Conversation status"}),e.jsx("option",{value:"tags_contains",children:"Contact has tag"})]}),["text_contains","text_equals","text_starts_with"].includes(t.conditionType)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{value:t.conditionValue,onChange:a=>n({...t,conditionValue:a.target.value}),className:"mt-1 rounded-xl",placeholder:"Enter value"}),e.jsxs("label",{className:"flex items-center gap-3 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx(p,{checked:t.conditionCaseSensitive,onChange:a=>n({...t,conditionCaseSensitive:a.target.checked})}),"Case sensitive"]})]}),t.conditionType==="regex_match"&&e.jsx(l,{value:t.regexPattern,onChange:a=>n({...t,regexPattern:a.target.value}),className:"mt-1 rounded-xl",placeholder:"/pattern/"}),t.conditionType==="time_window"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(l,{value:t.timeWindowTimezone,onChange:a=>n({...t,timeWindowTimezone:a.target.value}),className:"mt-1 rounded-xl",placeholder:"Timezone (e.g. UTC)"}),e.jsx(l,{value:t.timeWindowStart,onChange:a=>n({...t,timeWindowStart:a.target.value}),className:"mt-1 rounded-xl",placeholder:"Start (HH:MM)"}),e.jsx(l,{value:t.timeWindowEnd,onChange:a=>n({...t,timeWindowEnd:a.target.value}),className:"mt-1 rounded-xl",placeholder:"End (HH:MM)"})]}),e.jsx("div",{className:"flex flex-wrap gap-3 text-sm text-gray-700 dark:text-gray-300",children:[{label:"Sun",value:0},{label:"Mon",value:1},{label:"Tue",value:2},{label:"Wed",value:3},{label:"Thu",value:4},{label:"Fri",value:5},{label:"Sat",value:6}].map(a=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx(p,{checked:t.timeWindowDays.includes(a.value),onChange:()=>{const s=t.timeWindowDays.includes(a.value)?t.timeWindowDays.filter(r=>r!==a.value):[...t.timeWindowDays,a.value];n({...t,timeWindowDays:s})}}),a.label]},a.value))})]}),t.conditionType==="connection_is"&&e.jsx("div",{className:"space-y-2",children:w.map(a=>e.jsxs("label",{className:"flex items-center gap-3 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx(p,{checked:t.conditionConnectionIds.includes(a.id),onChange:s=>{const r=t.conditionConnectionIds.includes(a.id)?t.conditionConnectionIds.filter(b=>b!==a.id):[...t.conditionConnectionIds,a.id];n({...t,conditionConnectionIds:r})}}),a.name]},a.id))}),t.conditionType==="conversation_status"&&e.jsxs("select",{value:t.conditionStatus,onChange:a=>n({...t,conditionStatus:a.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"closed",children:"Closed"})]}),t.conditionType==="tags_contains"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("select",{value:t.conditionTagId,onChange:a=>n({...t,conditionTagId:a.target.value?Number(a.target.value):""}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"",children:"Select tag"}),R.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),e.jsx(l,{value:t.conditionTagName,onChange:a=>n({...t,conditionTagName:a.target.value}),className:"mt-1 rounded-xl",placeholder:"Or type tag name"})]})]}),t.type==="action"&&e.jsxs("div",{className:"space-y-4 rounded-xl border border-gray-200 dark:border-gray-700 p-4",children:[e.jsx(i,{value:"Action Type",className:"text-sm font-semibold mb-2"}),e.jsxs("select",{value:t.actionType,onChange:a=>n({...t,actionType:a.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"send_text",children:"Send text"}),e.jsx("option",{value:"send_template",children:"Send template"}),e.jsx("option",{value:"send_buttons",children:"Send buttons"}),e.jsx("option",{value:"send_list",children:"Send list"}),e.jsx("option",{value:"assign_agent",children:"Assign agent"}),e.jsx("option",{value:"add_tag",children:"Add tag"}),e.jsx("option",{value:"set_status",children:"Set status"}),e.jsx("option",{value:"set_priority",children:"Set priority"})]}),t.actionType==="send_text"&&e.jsx("textarea",{value:t.actionMessage,onChange:a=>n({...t,actionMessage:a.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",rows:3,placeholder:"Message text"}),t.actionType==="send_template"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("select",{value:t.actionTemplateId,onChange:a=>n({...t,actionTemplateId:a.target.value?Number(a.target.value):""}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"",children:"Select template"}),re.map(a=>e.jsxs("option",{value:a.id,children:[a.name," (",a.language,")"]},a.id))]}),e.jsx("textarea",{value:t.actionTemplateVariables,onChange:a=>n({...t,actionTemplateVariables:a.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",rows:3,placeholder:'{"1": "value"}'})]}),t.actionType==="send_buttons"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{value:t.actionButtonBodyText,onChange:a=>n({...t,actionButtonBodyText:a.target.value}),className:"mt-1 rounded-xl",placeholder:"Body text"}),e.jsx(l,{value:t.actionButtonHeaderText,onChange:a=>n({...t,actionButtonHeaderText:a.target.value}),className:"mt-1 rounded-xl",placeholder:"Header text (optional)"}),e.jsx(l,{value:t.actionButtonFooterText,onChange:a=>n({...t,actionButtonFooterText:a.target.value}),className:"mt-1 rounded-xl",placeholder:"Footer text (optional)"}),e.jsx("textarea",{value:t.actionButtonsJson,onChange:a=>n({...t,actionButtonsJson:a.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",rows:3,placeholder:'[{"id":"btn_1","text":"Option 1"},{"id":"btn_2","text":"Option 2"}]'})]}),t.actionType==="send_list"&&e.jsx(l,{type:"number",value:t.actionListId,onChange:a=>n({...t,actionListId:a.target.value?Number(a.target.value):""}),className:"mt-1 rounded-xl",placeholder:"WhatsApp list ID"}),t.actionType==="assign_agent"&&e.jsxs("select",{value:t.actionAgentId,onChange:a=>n({...t,actionAgentId:a.target.value?Number(a.target.value):""}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"",children:"Select agent"}),oe.map(a=>e.jsxs("option",{value:a.id,children:[a.name," (",a.role,")"]},a.id))]}),t.actionType==="add_tag"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("select",{value:t.actionTagId,onChange:a=>n({...t,actionTagId:a.target.value?Number(a.target.value):""}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"",children:"Select tag"}),R.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),e.jsx(l,{value:t.actionTagName,onChange:a=>n({...t,actionTagName:a.target.value}),className:"mt-1 rounded-xl",placeholder:"Or type tag name"})]}),t.actionType==="set_status"&&e.jsxs("select",{value:t.actionStatus,onChange:a=>n({...t,actionStatus:a.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"closed",children:"Closed"})]}),t.actionType==="set_priority"&&e.jsxs("select",{value:t.actionPriority,onChange:a=>n({...t,actionPriority:a.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),t.type==="delay"&&e.jsx(l,{type:"number",value:t.delaySeconds,onChange:a=>n({...t,delaySeconds:Number(a.target.value)}),className:"mt-1 rounded-xl",placeholder:"Delay seconds"}),t.type==="webhook"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{value:t.webhookUrl,onChange:a=>n({...t,webhookUrl:a.target.value}),className:"mt-1 rounded-xl",placeholder:"https://example.com/hook"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("select",{value:t.webhookMethod,onChange:a=>n({...t,webhookMethod:a.target.value}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:[e.jsx("option",{value:"POST",children:"POST"}),e.jsx("option",{value:"GET",children:"GET"})]}),e.jsx(l,{type:"number",value:t.webhookTimeout,onChange:a=>n({...t,webhookTimeout:Number(a.target.value)}),className:"mt-1 rounded-xl",placeholder:"Timeout (seconds)"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{type:"submit",className:"rounded-xl",children:F?"Update Node":"Add Node"}),e.jsx(g,{type:"button",variant:"secondary",className:"rounded-xl",onClick:V,children:"Cancel"})]})]})})]}),le&&j&&e.jsxs(T,{className:"border-0 shadow-lg",children:[e.jsx(E,{className:"bg-gradient-to-r from-gray-50 to-white dark:from-gray-800 dark:to-gray-900",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl",children:e.jsx(J,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx(B,{className:"text-xl font-bold",children:u.id?"Edit Edge":"Add Edge"}),e.jsx(O,{children:"Connect nodes to define branching"})]})]})}),e.jsxs(C,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{value:"From Node",className:"text-sm font-semibold mb-2"}),e.jsx("select",{value:u.fromNodeId,onChange:a=>N({...u,fromNodeId:Number(a.target.value)}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:(_.get(j)?.nodes||[]).map(a=>e.jsxs("option",{value:a.id,children:["Node #",a.id," (",a.type,")"]},a.id))})]}),e.jsxs("div",{children:[e.jsx(i,{value:"To Node",className:"text-sm font-semibold mb-2"}),e.jsx("select",{value:u.toNodeId,onChange:a=>N({...u,toNodeId:Number(a.target.value)}),className:"mt-1 w-full rounded-xl border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 px-4 py-2.5",children:(_.get(j)?.nodes||[]).map(a=>e.jsxs("option",{value:a.id,children:["Node #",a.id," (",a.type,")"]},a.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{value:"Label",className:"text-sm font-semibold mb-2"}),e.jsx(l,{value:u.label,onChange:a=>N({...u,label:a.target.value}),className:"mt-1 rounded-xl",placeholder:"true / false / next"})]}),e.jsxs("div",{children:[e.jsx(i,{value:"Sort Order",className:"text-sm font-semibold mb-2"}),e.jsx(l,{type:"number",value:u.sortOrder,onChange:a=>N({...u,sortOrder:a.target.value===""?"":Number(a.target.value)}),className:"mt-1 rounded-xl"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{className:"rounded-xl",onClick:Ne,children:"Save Edge"}),e.jsx(g,{variant:"secondary",className:"rounded-xl",onClick:Y,children:"Cancel"})]})]})]})]})]})}export{ea as default};
