import{r as g,j as e}from"./react-BhzSerM2.js";import{G as R,H as W,l as y,N as O,C as v,aM as C,g as w,aT as I,p,ao as j,L as H,Z as K,D as V}from"./vendor-DxGhd0kb.js";import{A as $}from"./AppShell-CbiYKKs1.js";import{C as A,b as z,c as E,d as S,a as D}from"./Card-BkWrHWVN.js";import{B as _}from"./app-NZCbGewm.js";import{T as b}from"./TextInput-DRXLElIV.js";import{I as f}from"./InputLabel-qVeuR0hO.js";import{I as F}from"./InputError-6mWSc7R2.js";import{u as G}from"./useToast-m6H8bvjE.js";import{P as J}from"./Progress-DW2oiwOZ.js";import{B as U}from"./Badge-7KrgCsFM.js";import{A as Y}from"./Alert-CGcVTa3U.js";import"./Topbar-a6Jf_b6K.js";import"./GlobalFlashHandler-xHP6pVTU.js";import"./BrandingWrapper-DK418oSm.js";import"./CookieConsentBanner-BZbYMIzh.js";/* empty css            */function xe({account:Z,embeddedSignup:l,defaultApiVersion:q}){const{toast:m}=G(),[N,P]=g.useState(!1),[r,i]=g.useState({step:"init",progress:0,message:"Ready to start",data:{}}),k=g.useRef(null),t=R({name:"",waba_id:"",phone_number_id:"",business_phone:"",access_token:"",code:"",pin:"",redirect_uri:""});g.useEffect(()=>{if(l?.enabled===!1){i(o=>({...o,step:"error",error:"Embedded Signup is disabled by your platform administrator."}));return}if(!l?.appId||!l?.configId){i(o=>({...o,step:"error",error:"Embedded Signup is not configured yet. Please contact support or use manual setup."}));return}const s=()=>{window.FB&&(window.FB.init({appId:l.appId,cookie:!0,xfbml:!0,version:l.apiVersion||"v21.0"}),P(!0),i(o=>({...o,step:"init",message:'Meta SDK loaded. Click "Start Setup" to begin.'})))};if(window.FB){s();return}window.fbAsyncInit=s;const n="facebook-jssdk";if(!document.getElementById(n)){const o=document.createElement("script");o.id=n,o.src="https://connect.facebook.net/en_US/sdk.js",o.async=!0,o.defer=!0,document.body.appendChild(o)}},[l?.enabled,l?.appId,l?.configId,l?.apiVersion]),g.useEffect(()=>{if(!l?.enabled||!l?.appId)return;const s=n=>{if(!["https://www.facebook.com","https://facebook.com","https://web.facebook.com","https://business.facebook.com"].some(d=>n.origin.includes(d.replace("https://",""))))return;let a=n.data;if(typeof a=="string")try{a=JSON.parse(a)}catch{if(a.includes("waba_id")||a.includes("phone_number_id"))try{const d=a.match(/\{.*\}/);d&&(a=JSON.parse(d[0]))}catch{return}else return}const u=a?.event||a?.type||a?.action||a?.status,c=a?.data||a?.payload||a?.result||a;if(u==="FINISH"||u==="COMPLETE"||u==="SUCCESS"||c?.waba_id||c?.phone_number_id||a?.waba_id||a?.phone_number_id){const d={waba_id:c?.waba_id||a?.waba_id||c?.wabaId||a?.wabaId,phone_number_id:c?.phone_number_id||a?.phone_number_id||c?.phoneNumberId||a?.phoneNumberId,business_phone:c?.business_phone||a?.business_phone||c?.display_phone_number||a?.display_phone_number||c?.businessPhone||a?.businessPhone};(d.waba_id||d.phone_number_id)&&(i(h=>({...h,step:"waba-lookup",progress:60,message:"Received signup data from Meta",data:{...h.data,...d}})),d.waba_id&&t.setData("waba_id",d.waba_id),d.phone_number_id&&t.setData("phone_number_id",d.phone_number_id),d.business_phone&&t.setData("business_phone",d.business_phone),m.success("Signup data received from Meta"))}if(c?.code||a?.code||c?.accessToken||a?.accessToken){const d=c?.code||a?.code,h=c?.accessToken||a?.accessToken||c?.access_token||a?.access_token;d&&(t.setData("code",d),i(x=>({...x,step:"code-exchange",progress:30,message:"Authorization code received",data:{...x.data,code:d}}))),h&&(t.setData("access_token",h),i(x=>({...x,step:"code-exchange",progress:40,message:"Access token received",data:{...x.data,accessToken:h}})))}};return k.current=s,window.addEventListener("message",s),()=>{k.current&&window.removeEventListener("message",k.current)}},[l?.appId,m]);const M=()=>{if(!N||!window.FB){m.error("Meta SDK not ready. Please wait...");return}i({step:"auth",progress:10,message:"Starting Meta authorization...",data:{}}),t.setData("redirect_uri",window.location.href),window.FB.login(s=>{if(s?.authResponse){const n=s.authResponse.code,o=s.authResponse.accessToken;n&&(t.setData("code",n),i(a=>({...a,step:"code-exchange",progress:30,message:"Authorization code received. Exchanging for access token...",data:{...a.data,code:n}}))),o&&(t.setData("access_token",o),i(a=>({...a,step:"code-exchange",progress:40,message:"Access token received",data:{...a.data,accessToken:o}}))),n||o?m.success("Authorization successful"):i(a=>({...a,step:"error",error:"Authorization response missing code or access token"}))}else i(n=>({...n,step:"error",error:"Login was cancelled or did not fully authorize"})),m.error("Authorization cancelled")},{config_id:l.configId,response_type:"code",override_default_response_type:!0,scope:"whatsapp_business_management,whatsapp_business_messaging,business_management"})},B=s=>{if(s.preventDefault(),!t.data.code&&!t.data.access_token){m.error("Please complete the authorization step first");return}i(n=>({...n,step:"complete",progress:90,message:"Creating connection..."})),t.post(route("app.whatsapp.connections.store-embedded",{}),{onSuccess:()=>{i(n=>({...n,step:"complete",progress:100,message:"Connection created successfully!"})),m.success("WhatsApp connection created successfully")},onError:n=>{i(o=>({...o,step:"error",error:n?.embedded||"Failed to create connection"})),m.error("Failed to create connection")}})},L=s=>{switch(s){case"init":return e.jsx(w,{className:"h-5 w-5"});case"auth":case"code-exchange":return e.jsx(C,{className:"h-5 w-5"});case"waba-lookup":case"phone-lookup":return e.jsx(I,{className:"h-5 w-5"});case"subscribe":case"register":return e.jsx(V,{className:"h-5 w-5"});case"complete":return e.jsx(p,{className:"h-5 w-5"});case"error":return e.jsx(v,{className:"h-5 w-5"});default:return e.jsx(K,{className:"h-5 w-5"})}},T=s=>s==="error"?"from-red-500 to-red-600":s==="complete"?"from-green-500 to-green-600":"from-blue-500 to-blue-600";return e.jsxs($,{children:[e.jsx(W,{title:"Embedded Signup Wizard"}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs(y,{href:route("app.whatsapp.connections.create",{}),className:"inline-flex items-center gap-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors mb-4",children:[e.jsx(O,{className:"h-4 w-4"}),"Back to Create Connection"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent",children:"Embedded Signup Wizard"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Guided setup for connecting your WhatsApp Business Account via Meta"})]})]}),e.jsxs(A,{className:"border-0 shadow-lg",children:[e.jsx(z,{className:"bg-gradient-to-r from-emerald-50 to-emerald-100 dark:from-emerald-900/20 dark:to-emerald-800/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 bg-gradient-to-br ${T(r.step)} rounded-xl`,children:L(r.step)}),e.jsxs("div",{className:"flex-1",children:[e.jsx(E,{className:"text-xl font-bold",children:"Setup Progress"}),e.jsx(S,{children:r.message})]}),e.jsxs(U,{variant:r.step==="complete"?"success":r.step==="error"?"danger":"default",className:"px-3 py-1",children:[Math.round(r.progress),"%"]})]})}),e.jsxs(D,{className:"p-6 space-y-4",children:[e.jsx(J,{value:r.progress,variant:r.step==="error"?"danger":"default",className:"h-3"}),r.error&&e.jsxs(Y,{variant:"error",className:"border-red-200 dark:border-red-800",children:[e.jsx(v,{className:"h-5 w-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-red-800 dark:text-red-200 mb-1",children:"Error"}),e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:r.error})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mt-6",children:[{key:"auth",label:"Authorize",icon:C},{key:"code-exchange",label:"Exchange",icon:w},{key:"waba-lookup",label:"Lookup",icon:I},{key:"complete",label:"Complete",icon:p}].map(({key:s,label:n,icon:o})=>{const a=r.step===s,u=["waba-lookup","phone-lookup","subscribe","register","complete"].includes(r.step)&&["auth","code-exchange","waba-lookup"].includes(s);return e.jsx("div",{className:`p-4 rounded-xl border-2 transition-all ${a?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":u?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800"}`,children:e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[u?e.jsx(p,{className:"h-4 w-4 text-green-600 dark:text-green-400"}):a?e.jsx(j,{className:"h-4 w-4 text-blue-600 dark:text-blue-400 animate-spin"}):e.jsx(o,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:`text-xs font-semibold ${a?"text-blue-700 dark:text-blue-300":u?"text-green-700 dark:text-green-300":"text-gray-500 dark:text-gray-400"}`,children:n})]})},s)})})]})]}),e.jsxs(A,{className:"border-0 shadow-lg",children:[e.jsx(z,{className:"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500 rounded-xl",children:e.jsx(H,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx(E,{className:"text-xl font-bold",children:"Connection Details"}),e.jsx(S,{children:"Complete the setup to create your WhatsApp connection"})]})]})}),e.jsxs(D,{className:"p-6 space-y-6",children:[r.step==="init"&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-emerald-100 to-emerald-200 dark:from-emerald-900/20 dark:to-emerald-800/20 mb-6",children:e.jsx(w,{className:"h-10 w-10 text-emerald-600 dark:text-emerald-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Ready to Start"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6 max-w-md mx-auto",children:"Click the button below to begin the Meta Embedded Signup process. You'll be guided through authorization and connection setup."}),e.jsx(_,{onClick:M,disabled:!N,className:"bg-gradient-to-r from-emerald-600 to-emerald-700 hover:from-emerald-700 hover:to-emerald-800 shadow-lg shadow-emerald-500/50 rounded-xl px-8",children:N?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"Start Setup"]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"h-4 w-4 mr-2 animate-spin"}),"Loading Meta SDK..."]})})]}),(r.step==="auth"||r.step==="code-exchange")&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(j,{className:"h-12 w-12 text-blue-600 dark:text-blue-400 animate-spin mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:r.step==="auth"?"Authorizing with Meta...":"Exchanging authorization code..."}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r.message})]}),["waba-lookup","phone-lookup","subscribe","register"].includes(r.step)&&e.jsxs("form",{onSubmit:B,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx(f,{htmlFor:"wizard_name",value:"Connection Name",className:"text-sm font-semibold mb-2"}),e.jsx(b,{id:"wizard_name",type:"text",value:t.data.name,className:"mt-1 block w-full rounded-xl",onChange:s=>t.setData("name",s.target.value),placeholder:"My Meta WhatsApp Connection"}),e.jsx(F,{message:t.errors?.name,className:"mt-2"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(f,{htmlFor:"wizard_waba",value:"WABA ID",className:"text-sm font-semibold mb-2"}),e.jsx(b,{id:"wizard_waba",type:"text",value:t.data.waba_id,className:"mt-1 block w-full rounded-xl font-mono",onChange:s=>t.setData("waba_id",s.target.value),placeholder:"Auto-filled after signup",readOnly:!!r.data.wabaId}),r.data.wabaId&&e.jsxs("p",{className:"mt-1 text-xs text-green-600 dark:text-green-400 flex items-center gap-1",children:[e.jsx(p,{className:"h-3 w-3"}),"Auto-detected from Meta"]})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"wizard_phone_id",value:"Phone Number ID",className:"text-sm font-semibold mb-2"}),e.jsx(b,{id:"wizard_phone_id",type:"text",value:t.data.phone_number_id,className:"mt-1 block w-full rounded-xl font-mono",onChange:s=>t.setData("phone_number_id",s.target.value),placeholder:"Auto-filled after signup",readOnly:!!r.data.phoneNumberId}),r.data.phoneNumberId&&e.jsxs("p",{className:"mt-1 text-xs text-green-600 dark:text-green-400 flex items-center gap-1",children:[e.jsx(p,{className:"h-3 w-3"}),"Auto-detected from Meta"]})]})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"wizard_business_phone",value:"Business Phone (Optional)",className:"text-sm font-semibold mb-2"}),e.jsx(b,{id:"wizard_business_phone",type:"text",value:t.data.business_phone,className:"mt-1 block w-full rounded-xl",onChange:s=>t.setData("business_phone",s.target.value),placeholder:"+1234567890",readOnly:!!r.data.businessPhone}),r.data.businessPhone&&e.jsxs("p",{className:"mt-1 text-xs text-green-600 dark:text-green-400 flex items-center gap-1",children:[e.jsx(p,{className:"h-3 w-3"}),"Auto-detected from Meta"]})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"wizard_pin",value:"Registration PIN (Optional)",className:"text-sm font-semibold mb-2"}),e.jsx(b,{id:"wizard_pin",type:"text",value:t.data.pin,className:"mt-1 block w-full rounded-xl font-mono",onChange:s=>t.setData("pin",s.target.value),placeholder:"6-digit PIN",maxLength:6}),e.jsx("p",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:"Provide PIN to register the phone number immediately after signup."})]}),e.jsx(F,{message:t.errors?.embedded,className:"mt-2"}),e.jsx("div",{className:"flex items-center justify-end gap-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx(_,{type:"submit",disabled:t.processing||!t.data.code&&!t.data.access_token,className:"bg-gradient-to-r from-emerald-600 to-emerald-700 hover:from-emerald-700 hover:to-emerald-800 shadow-lg shadow-emerald-500/40 rounded-xl",children:t.processing?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"h-4 w-4 mr-2 animate-spin"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"h-4 w-4 mr-2"}),"Create Connection"]})})})]}),r.step==="complete"&&r.progress===100&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-green-100 to-green-200 dark:from-green-900/20 dark:to-green-800/20 mb-6",children:e.jsx(p,{className:"h-10 w-10 text-green-600 dark:text-green-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Connection Created Successfully!"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Your WhatsApp connection has been set up and is ready to use."}),e.jsx(y,{href:route("app.whatsapp.connections.index",{}),children:e.jsx(_,{className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 shadow-lg shadow-blue-500/50 rounded-xl",children:"View Connections"})})]})]})]})]})]})}export{xe as default};
