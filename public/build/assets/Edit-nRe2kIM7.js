import{j as e,r}from"./react-BhzSerM2.js";import{K as de,h as me,O as E,z as ce,u as xe,H as ue,a1 as N,T as w,q as C,V as he,L as pe,aL as R,a5 as I,J as be,az as O,aa as U,b3 as ge,d as fe,A as V,k as je,a as D}from"./vendor-YQoUUhbX.js";import{A as ke}from"./AppShell-A6sQ3pxr.js";import{C as P,b as $,c as K,d as Q,a as Y}from"./Card-CRSrZ5HZ.js";import{B as u}from"./app-DjsbE74r.js";import{T as d}from"./TextInput-DRXLElIV.js";import{I as o}from"./InputLabel-qVeuR0hO.js";import{I as m}from"./InputError-6mWSc7R2.js";import{B as ye}from"./Badge-C6d-QEGL.js";import{A as T}from"./Alert-u60ICsin.js";import{u as ve}from"./useNotifications-9W-smJed.js";import"./Topbar-D6SeU-QE.js";import"./GlobalFlashHandler-DjMhmIiM.js";import"./useToast-C37H2DkG.js";import"./BrandingWrapper-Djq-D_tN.js";import"./CookieConsentBanner-C37xsP7H.js";/* empty css            */function _e({children:q,show:t=!1,maxWidth:c="2xl",closeable:g=!0,onClose:h=()=>{}}){const p=()=>{g&&h()},f={sm:"sm:max-w-sm",md:"sm:max-w-md",lg:"sm:max-w-lg",xl:"sm:max-w-xl","2xl":"sm:max-w-2xl"}[c];return e.jsx(de,{show:t,leave:"duration-200",children:e.jsxs(me,{as:"div",id:"modal",className:"fixed inset-0 z-50 flex transform items-center overflow-y-auto px-4 py-6 transition-all sm:px-0",onClose:p,children:[e.jsx(E,{enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"absolute inset-0 bg-gray-500/75"})}),e.jsx(E,{enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:e.jsx(ce,{className:`mb-6 transform overflow-hidden rounded-lg bg-white shadow-xl transition-all sm:mx-auto sm:w-full ${f}`,children:q})})]})})}function Oe({account:q,connection:t,canViewSecrets:c=!1}){const{confirm:g,toast:h}=ve(),[p,f]=r.useState(!1),[x,J]=r.useState(!1),[F,S]=r.useState(null),[A,W]=r.useState(!1),[j,k]=r.useState(null),[L,H]=r.useState(!1),[y,v]=r.useState(null),[G,_]=r.useState(!1),[X,Z]=r.useState(""),[ee,se]=r.useState(""),[M,te]=r.useState("success"),{data:l,setData:n,put:ae,processing:z,errors:i}=xe({name:t.name,waba_id:t.waba_id||"",phone_number_id:t.phone_number_id,business_phone:t.business_phone||"",access_token:"",api_version:t.api_version,throughput_cap_per_minute:t.throughput_cap_per_minute||120,quiet_hours_start:t.quiet_hours_start||"",quiet_hours_end:t.quiet_hours_end||"",quiet_hours_timezone:t.quiet_hours_timezone||"UTC"}),re=s=>{s.preventDefault(),ae(route("app.whatsapp.connections.update",{connection:t.slug??t.id}))},B=(s,a)=>{navigator.clipboard.writeText(s),S(a),h.success("Copied to clipboard"),setTimeout(()=>S(null),2e3)},oe=async()=>{await g({title:"Rotate Verify Token",message:"Are you sure you want to rotate the verify token? You will need to update your webhook settings in Meta Business Manager.",variant:"warning"})&&je.post(route("app.whatsapp.connections.rotate-verify-token",{connection:t.slug??t.id}),{},{onSuccess:()=>{h.success("Verify token rotated successfully")},onError:()=>{h.error("Failed to rotate token")}})},b=(s,a,ie)=>{Z(s),se(a),te(ie),_(!0)},le=async()=>{W(!0),k(null);try{const{data:s}=await D.post(route("app.whatsapp.connections.test-saved",{connection:t.slug??t.id})),a=[s.display_phone_number?`Phone: ${s.display_phone_number}`:null,s.verified_name?`Verified: ${s.verified_name}`:null,s.waba_match===!1?"WABA mismatch":null].filter(Boolean).join(" · ");k({ok:!0,message:a||"Connection looks valid."}),b("Connection Test Successful",a||"Connection looks valid.","success")}catch(s){const a=s?.response?.data?.error||"Connection test failed";k({ok:!1,message:a}),b("Connection Test Failed",a,"error")}finally{W(!1)}},ne=async()=>{H(!0),v(null);try{const{data:s}=await D.post(route("app.whatsapp.connections.webhook.test",{connection:t.slug??t.id})),a=s?.message||"Webhook verified successfully.";v({ok:!0,message:a}),b("Webhook Test Successful",a,"success")}catch(s){const a=s?.response?.data?.error||s?.response?.data?.message||"Webhook test failed. Please check your webhook settings and try again.";v({ok:!1,message:a}),b("Webhook Test Failed",a,"error")}finally{H(!1)}};return e.jsxs(ke,{children:[e.jsx(ue,{title:`Edit ${t.name}`}),e.jsx(_e,{show:G,onClose:()=>_(!1),maxWidth:"sm",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`h-10 w-10 rounded-full flex items-center justify-center ${M==="success"?"bg-emerald-100 text-emerald-600":"bg-red-100 text-red-600"}`,children:M==="success"?e.jsx(N,{className:"h-5 w-5"}):e.jsx(w,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:X}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-300 whitespace-pre-wrap",children:ee})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(u,{onClick:()=>_(!1),variant:"secondary",children:"Close"})})]})}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs(C,{href:route("app.whatsapp.connections.index",{}),className:"inline-flex items-center gap-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors mb-4",children:[e.jsx(he,{className:"h-4 w-4"}),"Back to Connections"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent",children:"Edit Connection"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Update your WhatsApp connection settings"})]})]}),e.jsxs(P,{className:"border-0 shadow-xl",children:[e.jsx($,{className:"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500 rounded-xl",children:e.jsx(pe,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx(K,{className:"text-xl font-bold",children:"Connection Settings"}),e.jsx(Q,{children:"Update your connection details"})]})]})}),e.jsx(Y,{className:"p-6",children:e.jsxs("form",{onSubmit:re,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"name",value:"Connection Name",className:"text-sm font-semibold mb-2"}),e.jsx(d,{id:"name",type:"text",value:l.name,className:"mt-1 block w-full rounded-xl",onChange:s=>n("name",s.target.value),required:!0}),e.jsx(m,{message:i.name,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"phone_number_id",value:"Phone Number ID *",className:"text-sm font-semibold mb-2"}),e.jsx(d,{id:"phone_number_id",type:"text",value:l.phone_number_id,className:"mt-1 block w-full rounded-xl font-mono",onChange:s=>n("phone_number_id",s.target.value),required:!0}),e.jsx(m,{message:i.phone_number_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"waba_id",value:"WhatsApp Business Account ID (Optional)",className:"text-sm font-semibold mb-2"}),e.jsx(d,{id:"waba_id",type:"text",value:l.waba_id,className:"mt-1 block w-full rounded-xl font-mono",onChange:s=>n("waba_id",s.target.value)}),e.jsx(m,{message:i.waba_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"business_phone",value:"Business Phone (Optional)",className:"text-sm font-semibold mb-2"}),e.jsx(d,{id:"business_phone",type:"text",value:l.business_phone,className:"mt-1 block w-full rounded-xl",onChange:s=>n("business_phone",s.target.value)}),e.jsx(m,{message:i.business_phone,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(o,{htmlFor:"access_token",value:"Access Token (Leave blank to keep current)",className:"text-sm font-semibold"}),e.jsx("button",{type:"button",onClick:()=>f(!p),className:"text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors flex items-center gap-1",children:p?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-4 w-4"}),"Hide"]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4"}),"Show"]})})]}),e.jsx(d,{id:"access_token",type:p?"text":"password",value:l.access_token,className:"mt-1 block w-full rounded-xl font-mono text-sm",onChange:s=>n("access_token",s.target.value),placeholder:"Leave blank to keep current token"}),e.jsx(m,{message:i.access_token,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"api_version",value:"API Version",className:"text-sm font-semibold mb-2"}),e.jsx(d,{id:"api_version",type:"text",value:l.api_version,className:"mt-1 block w-full rounded-xl font-mono",onChange:s=>n("api_version",s.target.value)}),e.jsx(m,{message:i.api_version,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"throughput_cap_per_minute",value:"Campaign Throughput Cap / min",className:"text-sm font-semibold mb-2"}),e.jsx(d,{id:"throughput_cap_per_minute",type:"number",min:1,max:1e3,value:l.throughput_cap_per_minute,className:"mt-1 block w-full rounded-xl",onChange:s=>n("throughput_cap_per_minute",Number(s.target.value)||120)}),e.jsx(m,{message:i.throughput_cap_per_minute,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"quiet_hours_timezone",value:"Quiet Hours Timezone",className:"text-sm font-semibold mb-2"}),e.jsx(d,{id:"quiet_hours_timezone",type:"text",value:l.quiet_hours_timezone,className:"mt-1 block w-full rounded-xl",onChange:s=>n("quiet_hours_timezone",s.target.value),placeholder:"Asia/Kolkata"}),e.jsx(m,{message:i.quiet_hours_timezone,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"quiet_hours_start",value:"Quiet Hours Start (HH:MM)",className:"text-sm font-semibold mb-2"}),e.jsx(d,{id:"quiet_hours_start",type:"time",value:l.quiet_hours_start,className:"mt-1 block w-full rounded-xl",onChange:s=>n("quiet_hours_start",s.target.value)}),e.jsx(m,{message:i.quiet_hours_start,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"quiet_hours_end",value:"Quiet Hours End (HH:MM)",className:"text-sm font-semibold mb-2"}),e.jsx(d,{id:"quiet_hours_end",type:"time",value:l.quiet_hours_end,className:"mt-1 block w-full rounded-xl",onChange:s=>n("quiet_hours_end",s.target.value)}),e.jsx(m,{message:i.quiet_hours_end,className:"mt-2"})]})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6 space-y-6",children:e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"}),e.jsx(o,{value:"Webhook Configuration",className:"text-base font-bold"})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-xl border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Webhook URL"}),e.jsx("button",{type:"button",onClick:()=>B(t.webhook_url,"url"),className:"text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors flex items-center gap-1",children:F==="url"?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"h-4 w-4"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-4 w-4"}),"Copy"]})})]}),e.jsx("code",{className:"block text-xs font-mono bg-white dark:bg-gray-950 px-3 py-2 rounded-lg break-all border border-gray-200 dark:border-gray-700 text-gray-900 dark:text-gray-100",children:t.webhook_url}),e.jsxs("p",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400 flex items-center gap-1",children:[e.jsx(U,{className:"h-3.5 w-3.5"}),"Paste this URL in Meta Business Manager → WhatsApp → Configuration → Webhook"]})]}),e.jsxs("div",{className:"p-4 bg-gradient-to-r from-amber-50 to-amber-100 dark:from-amber-900/20 dark:to-amber-800/20 rounded-xl border border-amber-200 dark:border-amber-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Verify Token"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>J(!x),className:"text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors flex items-center gap-1",children:x?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-4 w-4"}),"Hide"]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4"}),"Show"]})}),e.jsx("button",{type:"button",onClick:()=>B(c&&t.webhook_verify_token_full?t.webhook_verify_token_full:t.webhook_verify_token,"verify"),className:"text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors flex items-center gap-1",disabled:!c&&!x,title:!c&&!x?"You need owner/admin access to copy the full token":"Copy token",children:F==="verify"?e.jsx(N,{className:"h-4 w-4"}):e.jsx(O,{className:"h-4 w-4"})}),e.jsxs("button",{type:"button",onClick:oe,className:"text-sm font-medium text-orange-600 dark:text-orange-400 hover:text-orange-700 dark:hover:text-orange-300 transition-colors flex items-center gap-1",children:[e.jsx(ge,{className:"h-4 w-4"}),"Rotate"]})]})]}),e.jsx("code",{className:"block text-xs font-mono bg-white dark:bg-gray-950 px-3 py-2 rounded-lg border border-amber-200 dark:border-amber-800 text-gray-900 dark:text-gray-100",children:x&&c&&t.webhook_verify_token_full?t.webhook_verify_token_full:x?t.webhook_verify_token:"••••••••••••••••"}),!c&&e.jsxs("p",{className:"mt-2 text-xs text-amber-600 dark:text-amber-400 flex items-center gap-1",children:[e.jsx(w,{className:"h-3.5 w-3.5"}),"Only account owners/admins can view the full token"]}),e.jsxs("p",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400 flex items-center gap-1",children:[e.jsx(U,{className:"h-3.5 w-3.5"}),"Use this token when verifying the webhook in Meta"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{variant:t.webhook_subscribed?"success":"default",className:"flex items-center gap-1.5 px-3 py-1",children:t.webhook_subscribed?e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"h-3.5 w-3.5"}),"Webhook Subscribed"]}):"Not Subscribed"}),t.webhook_last_received_at&&e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Last received: ",new Date(t.webhook_last_received_at).toLocaleString()]})]}),t.webhook_last_error&&e.jsx(T,{variant:"error",className:"border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(w,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-red-800 dark:text-red-200",children:"Last Error:"}),e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:t.webhook_last_error})]})]})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(C,{href:route("app.whatsapp.connections.health",{connection:t.slug??t.id}),children:e.jsxs(u,{type:"button",variant:"secondary",className:"rounded-xl bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400 hover:bg-green-100 dark:hover:bg-green-900/30",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Health Check"]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(C,{href:route("app.whatsapp.connections.index",{}),children:e.jsx(u,{type:"button",variant:"secondary",className:"rounded-xl",children:"Cancel"})}),e.jsx(u,{type:"submit",disabled:z,className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 shadow-lg shadow-blue-500/50 rounded-xl",children:z?"Saving...":"Save Changes"})]})]})]})})]}),e.jsxs(P,{className:"border-0 shadow-xl",children:[e.jsx($,{className:"bg-gradient-to-r from-emerald-50 to-teal-100 dark:from-emerald-900/20 dark:to-teal-800/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-emerald-500 rounded-xl",children:e.jsx(V,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx(K,{className:"text-xl font-bold",children:"Connection Tests"}),e.jsx(Q,{children:"Validate your Meta connection and webhook from here."})]})]})}),e.jsx(Y,{className:"p-6 space-y-6",children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Uses the credentials saved with this connection."}),e.jsx(u,{onClick:le,disabled:A,children:A?"Testing...":"Test Connection"}),j&&e.jsx(T,{variant:j.ok?"success":"error",children:j.message})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Webhook URL: ",e.jsx("span",{className:"font-mono break-all",children:t.webhook_url})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"This sends an internal verification request to the webhook endpoint."}),e.jsx(u,{variant:"secondary",onClick:ne,disabled:L,children:L?"Testing...":"Test Webhook"}),y&&e.jsx(T,{variant:y.ok?"success":"error",children:y.message})]})]})})]})]})]})}export{Oe as default};
