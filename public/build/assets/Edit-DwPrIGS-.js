import{j as e,r}from"./react-BhzSerM2.js";import{K as de,h as ce,O,z as me,G as xe,H as he,$ as w,T as _,l as C,N as ue,L as be,aJ as D,a5 as U,D as pe,ay as $,a7 as H,a$ as ge,g as fe,A as P,e as ke,a as V}from"./vendor-DxGhd0kb.js";import{A as je}from"./AppShell-CbiYKKs1.js";import{C as q,b as z,c as K,d as Y,a as G}from"./Card-BkWrHWVN.js";import{B as m}from"./app-NZCbGewm.js";import{T as x}from"./TextInput-DRXLElIV.js";import{I as l}from"./InputLabel-qVeuR0hO.js";import{I as h}from"./InputError-6mWSc7R2.js";import{B as ye}from"./Badge-7KrgCsFM.js";import{A as T}from"./Alert-CGcVTa3U.js";import{u as ve}from"./useNotifications-CdqM2Ed8.js";import"./Topbar-a6Jf_b6K.js";import"./GlobalFlashHandler-xHP6pVTU.js";import"./useToast-m6H8bvjE.js";import"./BrandingWrapper-DK418oSm.js";import"./CookieConsentBanner-BZbYMIzh.js";/* empty css            */function Ne({children:S,show:s=!1,maxWidth:o="2xl",closeable:g=!0,onClose:u=()=>{}}){const b=()=>{g&&u()},f={sm:"sm:max-w-sm",md:"sm:max-w-md",lg:"sm:max-w-lg",xl:"sm:max-w-xl","2xl":"sm:max-w-2xl"}[o];return e.jsx(de,{show:s,leave:"duration-200",children:e.jsxs(ce,{as:"div",id:"modal",className:"fixed inset-0 z-50 flex transform items-center overflow-y-auto px-4 py-6 transition-all sm:px-0",onClose:b,children:[e.jsx(O,{enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"absolute inset-0 bg-gray-500/75"})}),e.jsx(O,{enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:e.jsx(me,{className:`mb-6 transform overflow-hidden rounded-lg bg-white shadow-xl transition-all sm:mx-auto sm:w-full ${f}`,children:S})})]})})}function $e({account:S,connection:s,canViewSecrets:o=!1}){const{confirm:g,toast:u}=ve(),[b,f]=r.useState(!1),[n,J]=r.useState(!1),[A,F]=r.useState(null),[W,L]=r.useState(!1),[k,j]=r.useState(null),[B,R]=r.useState(!1),[y,v]=r.useState(null),[Q,N]=r.useState(!1),[X,Z]=r.useState(""),[ee,se]=r.useState(""),[E,ae]=r.useState("success"),{data:i,setData:d,put:te,processing:I,errors:c}=xe({name:s.name,waba_id:s.waba_id||"",phone_number_id:s.phone_number_id,business_phone:s.business_phone||"",access_token:"",api_version:s.api_version}),re=a=>{a.preventDefault(),te(route("app.whatsapp.connections.update",{connection:s.slug??s.id}))},M=(a,t)=>{navigator.clipboard.writeText(a),F(t),u.success("Copied to clipboard"),setTimeout(()=>F(null),2e3)},oe=async()=>{await g({title:"Rotate Verify Token",message:"Are you sure you want to rotate the verify token? You will need to update your webhook settings in Meta Business Manager.",variant:"warning"})&&ke.post(route("app.whatsapp.connections.rotate-verify-token",{connection:s.slug??s.id}),{},{onSuccess:()=>{u.success("Verify token rotated successfully")},onError:()=>{u.error("Failed to rotate token")}})},p=(a,t,ie)=>{Z(a),se(t),ae(ie),N(!0)},le=async()=>{L(!0),j(null);try{const{data:a}=await V.post(route("app.whatsapp.connections.test-saved",{connection:s.slug??s.id})),t=[a.display_phone_number?`Phone: ${a.display_phone_number}`:null,a.verified_name?`Verified: ${a.verified_name}`:null,a.waba_match===!1?"WABA mismatch":null].filter(Boolean).join(" · ");j({ok:!0,message:t||"Connection looks valid."}),p("Connection Test Successful",t||"Connection looks valid.","success")}catch(a){const t=a?.response?.data?.error||"Connection test failed";j({ok:!1,message:t}),p("Connection Test Failed",t,"error")}finally{L(!1)}},ne=async()=>{R(!0),v(null);try{const{data:a}=await V.post(route("app.whatsapp.connections.webhook.test",{connection:s.slug??s.id})),t=a?.message||"Webhook verified successfully.";v({ok:!0,message:t}),p("Webhook Test Successful",t,"success")}catch(a){const t=a?.response?.data?.error||a?.response?.data?.message||"Webhook test failed. Please check your webhook settings and try again.";v({ok:!1,message:t}),p("Webhook Test Failed",t,"error")}finally{R(!1)}};return e.jsxs(je,{children:[e.jsx(he,{title:`Edit ${s.name}`}),e.jsx(Ne,{show:Q,onClose:()=>N(!1),maxWidth:"sm",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`h-10 w-10 rounded-full flex items-center justify-center ${E==="success"?"bg-emerald-100 text-emerald-600":"bg-red-100 text-red-600"}`,children:E==="success"?e.jsx(w,{className:"h-5 w-5"}):e.jsx(_,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:X}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-300 whitespace-pre-wrap",children:ee})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(m,{onClick:()=>N(!1),variant:"secondary",children:"Close"})})]})}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs(C,{href:route("app.whatsapp.connections.index",{}),className:"inline-flex items-center gap-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors mb-4",children:[e.jsx(ue,{className:"h-4 w-4"}),"Back to Connections"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent",children:"Edit Connection"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Update your WhatsApp connection settings"})]})]}),e.jsxs(q,{className:"border-0 shadow-xl",children:[e.jsx(z,{className:"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500 rounded-xl",children:e.jsx(be,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx(K,{className:"text-xl font-bold",children:"Connection Settings"}),e.jsx(Y,{children:"Update your connection details"})]})]})}),e.jsx(G,{className:"p-6",children:e.jsxs("form",{onSubmit:re,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"name",value:"Connection Name",className:"text-sm font-semibold mb-2"}),e.jsx(x,{id:"name",type:"text",value:i.name,className:"mt-1 block w-full rounded-xl",onChange:a=>d("name",a.target.value),required:!0}),e.jsx(h,{message:c.name,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"phone_number_id",value:"Phone Number ID *",className:"text-sm font-semibold mb-2"}),e.jsx(x,{id:"phone_number_id",type:"text",value:i.phone_number_id,className:"mt-1 block w-full rounded-xl font-mono",onChange:a=>d("phone_number_id",a.target.value),required:!0}),e.jsx(h,{message:c.phone_number_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"waba_id",value:"WhatsApp Business Account ID (Optional)",className:"text-sm font-semibold mb-2"}),e.jsx(x,{id:"waba_id",type:"text",value:i.waba_id,className:"mt-1 block w-full rounded-xl font-mono",onChange:a=>d("waba_id",a.target.value)}),e.jsx(h,{message:c.waba_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"business_phone",value:"Business Phone (Optional)",className:"text-sm font-semibold mb-2"}),e.jsx(x,{id:"business_phone",type:"text",value:i.business_phone,className:"mt-1 block w-full rounded-xl",onChange:a=>d("business_phone",a.target.value)}),e.jsx(h,{message:c.business_phone,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(l,{htmlFor:"access_token",value:"Access Token (Leave blank to keep current)",className:"text-sm font-semibold"}),e.jsx("button",{type:"button",onClick:()=>f(!b),className:"text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors flex items-center gap-1",children:b?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-4 w-4"}),"Hide"]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-4 w-4"}),"Show"]})})]}),e.jsx(x,{id:"access_token",type:b?"text":"password",value:i.access_token,className:"mt-1 block w-full rounded-xl font-mono text-sm",onChange:a=>d("access_token",a.target.value),placeholder:"Leave blank to keep current token"}),e.jsx(h,{message:c.access_token,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"api_version",value:"API Version",className:"text-sm font-semibold mb-2"}),e.jsx(x,{id:"api_version",type:"text",value:i.api_version,className:"mt-1 block w-full rounded-xl font-mono",onChange:a=>d("api_version",a.target.value)}),e.jsx(h,{message:c.api_version,className:"mt-2"})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6 space-y-6",children:e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"}),e.jsx(l,{value:"Webhook Configuration",className:"text-base font-bold"})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-xl border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Webhook URL"}),e.jsx("button",{type:"button",onClick:()=>M(s.webhook_url,"url"),className:"text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors flex items-center gap-1",children:A==="url"?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"h-4 w-4"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-4 w-4"}),"Copy"]})})]}),e.jsx("code",{className:"block text-xs font-mono bg-white dark:bg-gray-950 px-3 py-2 rounded-lg break-all border border-gray-200 dark:border-gray-700 text-gray-900 dark:text-gray-100",children:s.webhook_url}),e.jsxs("p",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400 flex items-center gap-1",children:[e.jsx(H,{className:"h-3.5 w-3.5"}),"Paste this URL in Meta Business Manager → WhatsApp → Configuration → Webhook"]})]}),e.jsxs("div",{className:"p-4 bg-gradient-to-r from-amber-50 to-amber-100 dark:from-amber-900/20 dark:to-amber-800/20 rounded-xl border border-amber-200 dark:border-amber-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Verify Token"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>J(!n),className:"text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors flex items-center gap-1",children:n?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-4 w-4"}),"Hide"]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-4 w-4"}),"Show"]})}),e.jsx("button",{type:"button",onClick:()=>M(o&&s.webhook_verify_token_full?s.webhook_verify_token_full:s.webhook_verify_token,"verify"),className:"text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors flex items-center gap-1",disabled:!o&&!n,title:!o&&!n?"You need owner/admin access to copy the full token":"Copy token",children:A==="verify"?e.jsx(w,{className:"h-4 w-4"}):e.jsx($,{className:"h-4 w-4"})}),e.jsxs("button",{type:"button",onClick:oe,className:"text-sm font-medium text-orange-600 dark:text-orange-400 hover:text-orange-700 dark:hover:text-orange-300 transition-colors flex items-center gap-1",children:[e.jsx(ge,{className:"h-4 w-4"}),"Rotate"]})]})]}),e.jsx("code",{className:"block text-xs font-mono bg-white dark:bg-gray-950 px-3 py-2 rounded-lg border border-amber-200 dark:border-amber-800 text-gray-900 dark:text-gray-100",children:n&&o&&s.webhook_verify_token_full?s.webhook_verify_token_full:n?s.webhook_verify_token:"••••••••••••••••"}),!o&&e.jsxs("p",{className:"mt-2 text-xs text-amber-600 dark:text-amber-400 flex items-center gap-1",children:[e.jsx(_,{className:"h-3.5 w-3.5"}),"Only account owners/admins can view the full token"]}),e.jsxs("p",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400 flex items-center gap-1",children:[e.jsx(H,{className:"h-3.5 w-3.5"}),"Use this token when verifying the webhook in Meta"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{variant:s.webhook_subscribed?"success":"default",className:"flex items-center gap-1.5 px-3 py-1",children:s.webhook_subscribed?e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"h-3.5 w-3.5"}),"Webhook Subscribed"]}):"Not Subscribed"}),s.webhook_last_received_at&&e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Last received: ",new Date(s.webhook_last_received_at).toLocaleString()]})]}),s.webhook_last_error&&e.jsx(T,{variant:"error",className:"border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(_,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-red-800 dark:text-red-200",children:"Last Error:"}),e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:s.webhook_last_error})]})]})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(C,{href:route("app.whatsapp.connections.health",{connection:s.slug??s.id}),children:e.jsxs(m,{type:"button",variant:"secondary",className:"rounded-xl bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400 hover:bg-green-100 dark:hover:bg-green-900/30",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Health Check"]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(C,{href:route("app.whatsapp.connections.index",{}),children:e.jsx(m,{type:"button",variant:"secondary",className:"rounded-xl",children:"Cancel"})}),e.jsx(m,{type:"submit",disabled:I,className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 shadow-lg shadow-blue-500/50 rounded-xl",children:I?"Saving...":"Save Changes"})]})]})]})})]}),e.jsxs(q,{className:"border-0 shadow-xl",children:[e.jsx(z,{className:"bg-gradient-to-r from-emerald-50 to-teal-100 dark:from-emerald-900/20 dark:to-teal-800/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-emerald-500 rounded-xl",children:e.jsx(P,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx(K,{className:"text-xl font-bold",children:"Connection Tests"}),e.jsx(Y,{children:"Validate your Meta connection and webhook from here."})]})]})}),e.jsx(G,{className:"p-6 space-y-6",children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Uses the credentials saved with this connection."}),e.jsx(m,{onClick:le,disabled:W,children:W?"Testing...":"Test Connection"}),k&&e.jsx(T,{variant:k.ok?"success":"error",children:k.message})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Webhook URL: ",e.jsx("span",{className:"font-mono break-all",children:s.webhook_url})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"This sends an internal verification request to the webhook endpoint."}),e.jsx(m,{variant:"secondary",onClick:ne,disabled:B,children:B?"Testing...":"Test Webhook"}),y&&e.jsx(T,{variant:y.ok?"success":"error",children:y.message})]})]})})]})]})]})}export{$e as default};
