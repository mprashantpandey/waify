import{r as d,j as e}from"./react-BhzSerM2.js";import{G as F,u as O,H as U,l as B,e as G,a as H}from"./vendor-DxGhd0kb.js";import{P as W}from"./PlatformShell-DffYmFA1.js";import{C as c,b as g,c as x,d as m,a as u}from"./Card-2LWG2Pxg.js";import{a as z,B as o}from"./app-LxBsIpMW.js";import{u as J}from"./useToast-m6H8bvjE.js";import"./Topbar-C479R05n.js";import"./Badge-DpSbAfCU.js";import"./BrandingWrapper-DK418oSm.js";import"./GlobalFlashHandler-xHP6pVTU.js";/* empty css            */const M=s=>s.mime_type?s.mime_type.startsWith("image/"):/\.(png|jpe?g|gif|webp|svg)$/i.test(s.file_name),V=s=>s.mime_type?s.mime_type==="application/pdf":/\.pdf$/i.test(s.file_name);function ie({thread:s,messages:p,admins:A,auditLogs:v}){const{data:y,setData:b,post:N,processing:w,reset:T}=F({message:"",attachments:[]}),{subscribe:_}=z(),{addToast:L}=J(),{ai:f}=O().props,[P,S]=d.useState(p),[n,C]=d.useState(!1),[t,l]=d.useState({status:s.status,priority:s.priority||"normal",assigned_to:s.assigned_to||"",category:s.category||"",tags:(s.tags||[]).join(", ")}),[h,D]=d.useState(null);d.useEffect(()=>{S(p)},[p]),d.useEffect(()=>{if(!s.account)return;const r=`account.${s.account.id}.support.thread.${s.id}`,a=_(r,"support.message.created",i=>{S(k=>k.some($=>$.id===i.id)?k:[...k,i])});return()=>{a()}},[_,s.id,s.account?.id]);const R=r=>{r.preventDefault(),N(route("platform.support.message",{thread:s.slug??s.id}),{forceFormData:!0,onSuccess:()=>T()})},E=()=>{N(route("platform.support.close",{thread:s.slug??s.id}))},I=r=>{r.preventDefault();const a=t.tags.split(",").map(i=>i.trim()).filter(Boolean);G.post(route("platform.support.update",{thread:s.slug??s.id}),{status:t.status,priority:t.priority,assigned_to:t.assigned_to||null,category:t.category||null,tags:a})},j=async r=>{C(!0);try{const i=(await H.post(route("platform.support.assistant",{thread:s.slug??s.id}),{action:r},{headers:{Accept:"application/json"}})).data?.suggestion;i&&r==="reply"?(b("message",i),D(null)):i&&D({title:r==="summary"?"AI Summary":"AI Next Steps",content:i})}catch(a){L({title:"AI Assistant",description:a?.response?.data?.error||"Unable to generate a suggestion.",variant:"error"})}finally{C(!1)}};return e.jsxs(W,{children:[e.jsx(U,{title:`Support - ${s.subject}`}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:s.subject}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Tenant: ",s.account?.name??"Unknown"," · Status: ",s.status]}),s.account&&e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-xs text-gray-600 dark:text-gray-300",children:[e.jsxs("span",{children:["Owner: ",s.account.owner?.name||"—"]}),e.jsx("span",{children:"·"}),e.jsx("span",{children:s.account.owner?.email||"—"}),e.jsx("span",{children:"·"}),e.jsx("a",{href:route("platform.accounts.show",{account:s.account.id}),className:"text-blue-600 dark:text-blue-300 hover:underline",children:"View Tenant"}),e.jsx("span",{children:"·"}),e.jsx(B,{href:route("platform.accounts.impersonate",{account:s.account.id}),method:"post",className:"text-blue-600 dark:text-blue-300 hover:underline",children:"Open Dashboard"})]})]}),e.jsxs(c,{className:"border-0 shadow-lg",children:[e.jsxs(g,{className:"bg-gradient-to-r from-gray-50 to-white dark:from-gray-800 dark:to-gray-900",children:[e.jsx(x,{className:"text-xl font-bold",children:"Conversation"}),e.jsx(m,{children:"Reply to the tenant"})]}),e.jsxs(u,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid gap-2 text-xs text-gray-500 dark:text-gray-400 md:grid-cols-2",children:[e.jsxs("div",{children:["Category: ",s.category||"—"]}),e.jsxs("div",{children:["Tags: ",s.tags&&s.tags.length>0?s.tags.join(", "):"—"]}),e.jsxs("div",{children:["First response due:"," ",s.first_response_due_at?new Date(s.first_response_due_at).toLocaleString():"—"]}),e.jsxs("div",{children:["Resolution due: ",s.due_at?new Date(s.due_at).toLocaleString():"—"]}),e.jsxs("div",{children:["Escalation level: ",s.escalation_level??0]})]}),s.status==="closed"&&e.jsx("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 text-sm text-gray-700 dark:text-gray-200 px-4 py-3",children:"This chat is closed."}),h&&e.jsxs("div",{className:"rounded-lg border border-indigo-200 dark:border-indigo-800 bg-indigo-50/60 dark:bg-indigo-900/20 p-4 text-sm text-gray-800 dark:text-gray-200",children:[e.jsx("div",{className:"text-xs uppercase tracking-wider text-indigo-600 dark:text-indigo-300 mb-2",children:h.title}),e.jsx("div",{className:"whitespace-pre-wrap",children:h.content})]}),e.jsx("div",{className:"space-y-3",children:P.map(r=>e.jsxs("div",{className:`rounded-lg px-4 py-3 ${r.sender_type==="admin"||r.sender_type==="bot"?"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800":r.sender_type==="system"?"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800":"bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700"}`,children:[e.jsx("div",{className:"text-xs uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-1",children:r.sender_type==="admin"?"Support":r.sender_type==="bot"?"Assistant":r.sender_type==="system"?"System":"Tenant"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-gray-100 whitespace-pre-wrap",children:r.body}),r.attachments&&r.attachments.length>0&&e.jsx("div",{className:"mt-2 space-y-2",children:r.attachments.map(a=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("a",{href:a.url,target:"_blank",rel:"noreferrer",className:"block text-xs text-blue-600 dark:text-blue-300 hover:underline",children:a.file_name}),M(a)&&e.jsx("img",{src:a.url,alt:a.file_name,className:"max-h-40 rounded-md border border-gray-200 dark:border-gray-700"}),V(a)&&e.jsxs("details",{className:"text-xs text-gray-600 dark:text-gray-300",children:[e.jsx("summary",{className:"cursor-pointer",children:"Preview PDF"}),e.jsx("iframe",{src:a.url,className:"mt-2 h-48 w-full rounded-md border border-gray-200 dark:border-gray-700"})]})]},a.id))}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:new Date(r.created_at).toLocaleString()})]},r.id))}),e.jsxs("form",{onSubmit:R,className:"space-y-3",children:[e.jsx("textarea",{value:y.message,onChange:r=>b("message",r.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100",rows:4,placeholder:"Write a reply..."}),e.jsx("input",{type:"file",multiple:!0,onChange:r=>b("attachments",Array.from(r.target.files||[])),className:"block w-full text-sm text-gray-500 file:mr-4 file:rounded-md file:border-0 file:bg-gray-100 file:px-4 file:py-2 file:text-sm file:font-semibold file:text-gray-700 hover:file:bg-gray-200 dark:file:bg-gray-800 dark:file:text-gray-200 dark:hover:file:bg-gray-700"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[s.status==="open"&&e.jsx(o,{type:"button",variant:"secondary",onClick:E,children:"Close Chat"}),f?.enabled&&e.jsx(o,{type:"button",variant:"secondary",onClick:()=>j("reply"),disabled:n,children:n?"Generating...":"AI Suggest"}),f?.enabled&&e.jsx(o,{type:"button",variant:"secondary",onClick:()=>j("summary"),disabled:n,children:n?"Generating...":"Summarize"}),f?.enabled&&e.jsx(o,{type:"button",variant:"secondary",onClick:()=>j("next_steps"),disabled:n,children:n?"Generating...":"Next Steps"}),e.jsx(o,{type:"submit",disabled:w||s.status==="closed"||y.message.trim().length===0&&y.attachments.length===0,children:w?"Sending...":"Send Reply"})]})]})]})]}),s.channel!=="live"?e.jsxs(c,{className:"border-0 shadow-lg",children:[e.jsxs(g,{className:"bg-gradient-to-r from-indigo-50 to-indigo-100 dark:from-indigo-900/20 dark:to-indigo-800/20",children:[e.jsx(x,{className:"text-xl font-bold",children:"Ticket Management"}),e.jsx(m,{children:"Update status, priority, and assignee"})]}),e.jsxs(u,{className:"p-6",children:[e.jsxs("form",{onSubmit:I,className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 dark:text-gray-200",children:"Status"}),e.jsxs("select",{value:t.status,onChange:r=>l({...t,status:r.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100",children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"closed",children:"Closed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 dark:text-gray-200",children:"Priority"}),e.jsxs("select",{value:t.priority,onChange:r=>l({...t,priority:r.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 dark:text-gray-200",children:"Assignee"}),e.jsxs("select",{value:t.assigned_to,onChange:r=>l({...t,assigned_to:r.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100",children:[e.jsx("option",{value:"",children:"Unassigned"}),A.map(r=>e.jsxs("option",{value:r.id,children:[r.name," (",r.email,")"]},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 dark:text-gray-200",children:"Category"}),e.jsx("input",{value:t.category,onChange:r=>l({...t,category:r.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100",placeholder:"Billing, WhatsApp, Templates..."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 dark:text-gray-200",children:"Tags (comma separated)"}),e.jsx("input",{value:t.tags,onChange:r=>l({...t,tags:r.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100",placeholder:"urgent, whatsapp, api"})]}),e.jsx("div",{className:"md:col-span-3 flex justify-end",children:e.jsx(o,{type:"submit",children:"Save Changes"})})]}),e.jsxs("div",{className:"mt-4 grid gap-2 text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("div",{children:["First response due: ",s.first_response_due_at?new Date(s.first_response_due_at).toLocaleString():"—"]}),e.jsxs("div",{children:["Resolution due: ",s.due_at?new Date(s.due_at).toLocaleString():"—"]}),e.jsxs("div",{children:["Escalation level: ",s.escalation_level??0]})]})]})]}):e.jsxs(c,{className:"border-0 shadow-lg",children:[e.jsxs(g,{className:"bg-gradient-to-r from-indigo-50 to-indigo-100 dark:from-indigo-900/20 dark:to-indigo-800/20",children:[e.jsx(x,{className:"text-xl font-bold",children:"Live Chat Summary"}),e.jsx(m,{children:"Live chat sessions do not use ticket management fields."})]}),e.jsx(u,{className:"p-6 text-sm text-gray-600 dark:text-gray-300",children:"Convert this chat to a ticket if you need assignments, priorities, and SLA tracking."})]}),e.jsxs(c,{className:"border-0 shadow-lg",children:[e.jsxs(g,{className:"bg-gradient-to-r from-slate-50 to-slate-100 dark:from-slate-900/20 dark:to-slate-800/20",children:[e.jsx(x,{className:"text-xl font-bold",children:"Audit Log"}),e.jsx(m,{children:"Recent activity on this ticket"})]}),e.jsxs(u,{className:"p-6 space-y-3",children:[v.length===0&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No audit entries yet."}),v.map(r=>e.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-800 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wider text-gray-500 dark:text-gray-400",children:r.action.replace(/_/g," ")}),e.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-200 mt-1",children:[r.user?.name||"System"," · ",r.user?.email||"—"]}),r.meta&&Object.keys(r.meta).length>0&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:JSON.stringify(r.meta)}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:r.created_at?new Date(r.created_at).toLocaleString():"—"})]},r.id))]})]})]})]})}export{ie as default};
