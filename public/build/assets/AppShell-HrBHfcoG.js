import{j as e,r as n}from"./react-B_HteL0F.js";import{u as E,X as M,A as q,U as I,ad as F,ae as P,W as R,a2 as D,Z as H,f as O,a6 as G,I as U,F as Z,af as X,n as Y,ag as $,l as J,a as S,M as K}from"./vendor-GYTC5Pip.js";import{c as _,a as Q,B as L}from"./app-C0WBMkkY.js";import{T as V}from"./Topbar-CPirX8py.js";import{T as ee,G as re}from"./GlobalFlashHandler-DpywDQft.js";import{B as ae}from"./BrandingWrapper-DIBfDp2T.js";const te={LayoutDashboard:$,Puzzle:Y,MessageCircle:X,FileText:Z,Inbox:U,Bot:G,Sparkles:O,Zap:H,BarChart3:D,CreditCard:R,LifeBuoy:P,Settings:F,Users:I,Activity:q};function se({navigation:t,currentRoute:u,workspace:y,isOpen:p=!1,onClose:f}){const{branding:x}=E().props,l=x?.platform_name||"WACP",a=x?.logo_url,i=t.reduce((s,c)=>{const d=c.group||"other";return s[d]||(s[d]=[]),s[d].push(c),s},{}),h={core:"Core",messaging:"Messaging",automation:"Automation",ai:"AI",growth:"Growth",billing:"Billing"},k=(s,c)=>{const d=te[s.icon]||$;let j="#";try{if(y)j=route(s.href,{workspace:y.slug});else return null}catch{return null}const w=u.includes(s.href.replace("app.",""));return e.jsxs(J,{href:j,className:_("flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all duration-200 group",w?"bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg shadow-blue-500/50":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 hover:translate-x-1"),children:[e.jsx(d,{className:_("h-5 w-5 transition-transform duration-200",w?"text-white":"text-gray-500 dark:text-gray-400 group-hover:text-blue-600 dark:group-hover:text-blue-400",!w&&"group-hover:scale-110")}),e.jsx("span",{className:_(w?"font-semibold":"font-medium"),children:s.label})]},`${s.href}-${s.label}-${c}`)},b=e.jsx("nav",{className:"flex-1 overflow-y-auto p-6 space-y-8",children:Object.entries(i).map(([s,c])=>{const d=c.map(k).filter(j=>j!==null);return d.length===0?null:e.jsxs("div",{children:[h[s]&&e.jsx("h3",{className:"px-4 text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3",children:h[s]}),e.jsx("div",{className:"space-y-1.5",children:d})]},s)}).filter(Boolean)});return e.jsxs(e.Fragment,{children:[p&&e.jsx("div",{className:"lg:hidden fixed inset-0 z-40 bg-black/60 backdrop-blur-sm transition-opacity",onClick:f}),e.jsxs("aside",{className:_("lg:hidden fixed inset-y-0 left-0 z-50 w-72 bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 transform transition-transform duration-300 ease-in-out shadow-2xl",p?"translate-x-0":"-translate-x-full"),children:[e.jsxs("div",{className:"flex items-center justify-between h-16 px-6 border-b border-gray-200 dark:border-gray-800 bg-gradient-to-r from-gray-50 to-white dark:from-gray-900 dark:to-gray-800",children:[a?e.jsx("img",{src:a,alt:l,className:"h-8 w-auto"}):e.jsx("h2",{className:"text-lg font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent",children:l}),e.jsx("button",{onClick:f,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:e.jsx(M,{className:"h-5 w-5 text-gray-700 dark:text-gray-300"})})]}),b]}),e.jsxs("aside",{className:"hidden lg:flex lg:flex-col lg:w-72 lg:fixed lg:inset-y-0 lg:z-30 bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 shadow-lg",children:[e.jsx("div",{className:"flex items-center h-16 px-6 border-b border-gray-200 dark:border-gray-800 bg-gradient-to-r from-gray-50 to-white dark:from-gray-900 dark:to-gray-800",children:a?e.jsx("img",{src:a,alt:l,className:"h-8 w-auto"}):e.jsx("h2",{className:"text-lg font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent",children:l})}),b]})]})}const oe=t=>t.mime_type?t.mime_type.startsWith("image/"):/\.(png|jpe?g|gif|webp|svg)$/i.test(t.file_name),ne=t=>t.mime_type?t.mime_type==="application/pdf":/\.pdf$/i.test(t.file_name);function ie(){const{workspace:t,branding:u}=E().props,{subscribe:y}=Q(),[p,f]=n.useState(!1),[x,l]=n.useState(!1),[a,i]=n.useState(null),[h,k]=n.useState([]),[b,s]=n.useState(""),[c,d]=n.useState([]),[j,w]=n.useState(!1),N=n.useMemo(()=>({email:u?.support_email,phone:u?.support_phone}),[u?.support_email,u?.support_phone]);n.useEffect(()=>{if(!p||!t?.slug)return;let r=!0;return l(!0),S.get(route("app.support.live",{workspace:t.slug}),{headers:{Accept:"application/json"}}).then(o=>{const g=o.data;r&&(i(g.thread),k(g.messages||[]))}).finally(()=>{r&&l(!1)}),()=>{r=!1}},[p,t?.slug]),n.useEffect(()=>{if(!a||!t?.id)return;const r=`workspace.${t.id}.support.thread.${a.id}`,o=y(r,"support.message.created",g=>{k(v=>v.some(C=>C.id===g.id)?v:[...v,g])});return()=>{o()}},[y,a?.id,t?.id]);const z=async()=>{if(!b.trim()&&c.length===0||!t?.slug)return;const r=new FormData;b.trim()&&r.append("message",b.trim()),r.append("subject",a?.subject??"Live chat"),a?.id&&a.status!=="closed"&&r.append("thread_id",String(a.id)),c.forEach(m=>r.append("attachments[]",m)),s(""),d([]);const g=(await S.post(route("app.support.live.message",{workspace:t.slug}),r,{headers:{Accept:"application/json"}})).data;g.thread&&i(g.thread);const v=g.message;v&&k(m=>m.some(A=>A.id===v.id)?m:[...m,v]);const C=g.bot;C&&k(m=>m.some(A=>A.id===C.id)?m:[...m,C])},B=async()=>{t?.slug&&(await S.post(route("app.support.live.close",{workspace:t.slug}),{},{headers:{Accept:"application/json"}}),i(r=>r&&{...r,status:"closed"}))},T=()=>{i(null),k([]),s(""),d([])},W=async()=>{if(t?.slug){w(!0);try{const o=(await S.post(route("app.support.live.request-human",{workspace:t.slug}),{},{headers:{Accept:"application/json"}})).data;o.thread&&i(o.thread)}finally{w(!1)}}};return e.jsxs("div",{className:"fixed bottom-6 right-6 z-40",children:[!p&&e.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-2 rounded-full bg-blue-600 text-white px-4 py-3 shadow-lg hover:bg-blue-700 transition",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-semibold",children:"Live Chat"})]}),p&&e.jsxs("div",{className:"w-80 max-w-[90vw] rounded-2xl bg-white dark:bg-gray-900 shadow-xl border border-gray-200 dark:border-gray-800 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:"Support Live Chat"}),e.jsx("div",{className:"text-xs opacity-90",children:"We typically reply in a few minutes"})]}),e.jsx("button",{onClick:()=>f(!1),className:"p-1 hover:opacity-80",children:e.jsx(M,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"px-4 py-3 text-xs text-gray-500 dark:text-gray-400 border-b border-gray-200 dark:border-gray-800",children:N.email||N.phone?`Email ${N.email??"—"}${N.phone?` · ${N.phone}`:""}`:"Share details and we will assist you."}),e.jsxs("div",{className:"h-64 overflow-y-auto px-4 py-3 space-y-3",children:[x&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Loading chat..."}),!x&&h.length===0&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Start a conversation with our support team."}),a?.mode==="human"&&e.jsx("div",{className:"text-xs text-amber-700 dark:text-amber-300 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-md px-3 py-2",children:"A live agent has been requested. We will join shortly."}),a?.status==="closed"&&e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md px-3 py-2",children:"This chat is closed. Start a new conversation anytime."}),h.map(r=>e.jsxs("div",{className:`rounded-lg px-3 py-2 text-xs leading-relaxed ${r.sender_type==="admin"||r.sender_type==="bot"?"bg-blue-50 dark:bg-blue-900/30 text-gray-900 dark:text-gray-100":r.sender_type==="system"?"bg-amber-50 dark:bg-amber-900/30 text-gray-900 dark:text-gray-100":"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100"}`,children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wider opacity-60 mb-1",children:r.sender_type==="admin"?"Support":r.sender_type==="bot"?"Assistant":r.sender_type==="system"?"System":"You"}),r.body,r.attachments&&r.attachments.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:r.attachments.map(o=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("a",{href:o.url,target:"_blank",rel:"noreferrer",className:"block text-[11px] text-blue-600 dark:text-blue-300 hover:underline",children:o.file_name}),oe(o)&&e.jsx("img",{src:o.url,alt:o.file_name,className:"max-h-32 rounded-md border border-gray-200 dark:border-gray-700"}),ne(o)&&e.jsxs("details",{className:"text-[11px] text-gray-600 dark:text-gray-300",children:[e.jsx("summary",{className:"cursor-pointer",children:"Preview PDF"}),e.jsx("iframe",{src:o.url,className:"mt-2 h-36 w-full rounded-md border border-gray-200 dark:border-gray-700"})]})]},o.id))})]},r.id))]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-800 p-3 space-y-2",children:[a?.status!=="closed"&&a?.mode!=="human"&&e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"button",onClick:W,disabled:j,className:"text-xs font-semibold text-blue-600 dark:text-blue-400 hover:underline",children:j?"Requesting live agent...":"Talk to a live agent"})}),e.jsx("textarea",{value:b,onChange:r=>s(r.target.value),rows:2,disabled:a?.status==="closed",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100 text-sm disabled:opacity-60",placeholder:a?.status==="closed"?"Start a new chat to send messages.":"Type your message..."}),e.jsx("input",{type:"file",multiple:!0,disabled:a?.status==="closed",onChange:r=>d(Array.from(r.target.files||[])),className:"block w-full text-xs text-gray-500 file:mr-4 file:rounded-md file:border-0 file:bg-gray-100 file:px-3 file:py-1.5 file:text-xs file:font-semibold file:text-gray-700 hover:file:bg-gray-200 dark:file:bg-gray-800 dark:file:text-gray-200 dark:hover:file:bg-gray-700 disabled:opacity-60"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[a?.status==="closed"&&e.jsx(L,{type:"button",variant:"secondary",onClick:T,children:"New Chat"}),a?.status==="open"&&e.jsx(L,{type:"button",variant:"secondary",onClick:B,children:"End Chat"}),e.jsx(L,{type:"button",onClick:z,disabled:b.trim().length===0&&c.length===0||a?.status==="closed",children:"Send"})]})]})]})]})}function xe({children:t}){const{workspace:u,workspaces:y,navigation:p,auth:f,ziggy:x}=E().props,l=window.location.pathname,[a,i]=n.useState(!1);return n.useEffect(()=>{i(!1)},[l]),n.useEffect(()=>{x&&(window.Ziggy=x)},[x]),n.useEffect(()=>{const h=()=>{window.innerWidth>=1024&&i(!1)};return window.addEventListener("resize",h),()=>window.removeEventListener("resize",h)},[]),e.jsx(ae,{children:e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-50 dark:from-gray-950 dark:via-gray-900 dark:to-gray-950",children:[e.jsx(se,{navigation:p||[],currentRoute:l,workspace:u,isOpen:a,onClose:()=>i(!1)}),e.jsxs("div",{className:"lg:pl-72",children:[e.jsx(V,{workspace:u,workspaces:y||[],user:f?.user,onMenuClick:()=>i(!a)}),e.jsx("main",{className:"p-4 lg:p-6",children:t})]}),e.jsx(ee,{}),e.jsx(re,{}),e.jsx(ie,{})]})})}export{xe as A};
