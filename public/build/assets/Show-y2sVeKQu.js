import{r as o,j as e}from"./react-B_HteL0F.js";import{G as F,u as O,H as U,l as W,e as B,a as G}from"./vendor-GYTC5Pip.js";import{P as H}from"./PlatformShell-D3A5CZuP.js";import{C as c,a as g,b as x,d as m,c as p}from"./Card-CUbeq4wI.js";import{a as z,B as n}from"./app-C0WBMkkY.js";import{u as J}from"./useToast-Rch7lQVh.js";import"./Topbar-CPirX8py.js";import"./BrandingWrapper-DIBfDp2T.js";import"./GlobalFlashHandler-DpywDQft.js";/* empty css            */const M=s=>s.mime_type?s.mime_type.startsWith("image/"):/\.(png|jpe?g|gif|webp|svg)$/i.test(s.file_name),V=s=>s.mime_type?s.mime_type==="application/pdf":/\.pdf$/i.test(s.file_name);function te({thread:s,messages:u,admins:A,auditLogs:v}){const{data:y,setData:b,post:N,processing:w,reset:L}=F({message:"",attachments:[]}),{subscribe:_}=z(),{addToast:T}=J(),{ai:f}=O().props,[P,S]=o.useState(u),[d,C]=o.useState(!1),[a,l]=o.useState({status:s.status,priority:s.priority||"normal",assigned_to:s.assigned_to||"",category:s.category||"",tags:(s.tags||[]).join(", ")}),[h,D]=o.useState(null);o.useEffect(()=>{S(u)},[u]),o.useEffect(()=>{if(!s.workspace)return;const r=`workspace.${s.workspace.id}.support.thread.${s.id}`,t=_(r,"support.message.created",i=>{S(k=>k.some($=>$.id===i.id)?k:[...k,i])});return()=>{t()}},[_,s.id,s.workspace?.id]);const R=r=>{r.preventDefault(),N(route("platform.support.message",{thread:s.slug??s.id}),{forceFormData:!0,onSuccess:()=>L()})},E=()=>{N(route("platform.support.close",{thread:s.slug??s.id}))},I=r=>{r.preventDefault();const t=a.tags.split(",").map(i=>i.trim()).filter(Boolean);B.post(route("platform.support.update",{thread:s.slug??s.id}),{status:a.status,priority:a.priority,assigned_to:a.assigned_to||null,category:a.category||null,tags:t})},j=async r=>{C(!0);try{const i=(await G.post(route("platform.support.assistant",{thread:s.slug??s.id}),{action:r},{headers:{Accept:"application/json"}})).data?.suggestion;i&&r==="reply"?(b("message",i),D(null)):i&&D({title:r==="summary"?"AI Summary":"AI Next Steps",content:i})}catch(t){T({title:"AI Assistant",description:t?.response?.data?.error||"Unable to generate a suggestion.",variant:"error"})}finally{C(!1)}};return e.jsxs(H,{children:[e.jsx(U,{title:`Support - ${s.subject}`}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:s.subject}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Workspace: ",s.workspace?.name??"Unknown"," · Status: ",s.status]}),s.workspace&&e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-xs text-gray-600 dark:text-gray-300",children:[e.jsxs("span",{children:["Owner: ",s.workspace.owner?.name||"—"]}),e.jsx("span",{children:"·"}),e.jsx("span",{children:s.workspace.owner?.email||"—"}),e.jsx("span",{children:"·"}),e.jsx("a",{href:route("platform.workspaces.show",{workspace:s.workspace.id}),className:"text-blue-600 dark:text-blue-300 hover:underline",children:"View Workspace"}),e.jsx("span",{children:"·"}),e.jsx(W,{href:route("platform.workspaces.impersonate",{workspace:s.workspace.id}),method:"post",className:"text-blue-600 dark:text-blue-300 hover:underline",children:"Open Dashboard"})]})]}),e.jsxs(c,{className:"border-0 shadow-lg",children:[e.jsxs(g,{className:"bg-gradient-to-r from-gray-50 to-white dark:from-gray-800 dark:to-gray-900",children:[e.jsx(x,{className:"text-xl font-bold",children:"Conversation"}),e.jsx(m,{children:"Reply to the tenant"})]}),e.jsxs(p,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid gap-2 text-xs text-gray-500 dark:text-gray-400 md:grid-cols-2",children:[e.jsxs("div",{children:["Category: ",s.category||"—"]}),e.jsxs("div",{children:["Tags: ",s.tags&&s.tags.length>0?s.tags.join(", "):"—"]}),e.jsxs("div",{children:["First response due:"," ",s.first_response_due_at?new Date(s.first_response_due_at).toLocaleString():"—"]}),e.jsxs("div",{children:["Resolution due: ",s.due_at?new Date(s.due_at).toLocaleString():"—"]}),e.jsxs("div",{children:["Escalation level: ",s.escalation_level??0]})]}),s.status==="closed"&&e.jsx("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 text-sm text-gray-700 dark:text-gray-200 px-4 py-3",children:"This chat is closed."}),h&&e.jsxs("div",{className:"rounded-lg border border-indigo-200 dark:border-indigo-800 bg-indigo-50/60 dark:bg-indigo-900/20 p-4 text-sm text-gray-800 dark:text-gray-200",children:[e.jsx("div",{className:"text-xs uppercase tracking-wider text-indigo-600 dark:text-indigo-300 mb-2",children:h.title}),e.jsx("div",{className:"whitespace-pre-wrap",children:h.content})]}),e.jsx("div",{className:"space-y-3",children:P.map(r=>e.jsxs("div",{className:`rounded-lg px-4 py-3 ${r.sender_type==="admin"||r.sender_type==="bot"?"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800":r.sender_type==="system"?"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800":"bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700"}`,children:[e.jsx("div",{className:"text-xs uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-1",children:r.sender_type==="admin"?"Support":r.sender_type==="bot"?"Assistant":r.sender_type==="system"?"System":"Tenant"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-gray-100 whitespace-pre-wrap",children:r.body}),r.attachments&&r.attachments.length>0&&e.jsx("div",{className:"mt-2 space-y-2",children:r.attachments.map(t=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("a",{href:t.url,target:"_blank",rel:"noreferrer",className:"block text-xs text-blue-600 dark:text-blue-300 hover:underline",children:t.file_name}),M(t)&&e.jsx("img",{src:t.url,alt:t.file_name,className:"max-h-40 rounded-md border border-gray-200 dark:border-gray-700"}),V(t)&&e.jsxs("details",{className:"text-xs text-gray-600 dark:text-gray-300",children:[e.jsx("summary",{className:"cursor-pointer",children:"Preview PDF"}),e.jsx("iframe",{src:t.url,className:"mt-2 h-48 w-full rounded-md border border-gray-200 dark:border-gray-700"})]})]},t.id))}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:new Date(r.created_at).toLocaleString()})]},r.id))}),e.jsxs("form",{onSubmit:R,className:"space-y-3",children:[e.jsx("textarea",{value:y.message,onChange:r=>b("message",r.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100",rows:4,placeholder:"Write a reply..."}),e.jsx("input",{type:"file",multiple:!0,onChange:r=>b("attachments",Array.from(r.target.files||[])),className:"block w-full text-sm text-gray-500 file:mr-4 file:rounded-md file:border-0 file:bg-gray-100 file:px-4 file:py-2 file:text-sm file:font-semibold file:text-gray-700 hover:file:bg-gray-200 dark:file:bg-gray-800 dark:file:text-gray-200 dark:hover:file:bg-gray-700"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[s.status==="open"&&e.jsx(n,{type:"button",variant:"secondary",onClick:E,children:"Close Chat"}),f?.enabled&&e.jsx(n,{type:"button",variant:"secondary",onClick:()=>j("reply"),disabled:d,children:d?"Generating...":"AI Suggest"}),f?.enabled&&e.jsx(n,{type:"button",variant:"secondary",onClick:()=>j("summary"),disabled:d,children:d?"Generating...":"Summarize"}),f?.enabled&&e.jsx(n,{type:"button",variant:"secondary",onClick:()=>j("next_steps"),disabled:d,children:d?"Generating...":"Next Steps"}),e.jsx(n,{type:"submit",disabled:w||s.status==="closed"||y.message.trim().length===0&&y.attachments.length===0,children:w?"Sending...":"Send Reply"})]})]})]})]}),s.channel!=="live"?e.jsxs(c,{className:"border-0 shadow-lg",children:[e.jsxs(g,{className:"bg-gradient-to-r from-indigo-50 to-indigo-100 dark:from-indigo-900/20 dark:to-indigo-800/20",children:[e.jsx(x,{className:"text-xl font-bold",children:"Ticket Management"}),e.jsx(m,{children:"Update status, priority, and assignee"})]}),e.jsxs(p,{className:"p-6",children:[e.jsxs("form",{onSubmit:I,className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 dark:text-gray-200",children:"Status"}),e.jsxs("select",{value:a.status,onChange:r=>l({...a,status:r.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100",children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"closed",children:"Closed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 dark:text-gray-200",children:"Priority"}),e.jsxs("select",{value:a.priority,onChange:r=>l({...a,priority:r.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 dark:text-gray-200",children:"Assignee"}),e.jsxs("select",{value:a.assigned_to,onChange:r=>l({...a,assigned_to:r.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100",children:[e.jsx("option",{value:"",children:"Unassigned"}),A.map(r=>e.jsxs("option",{value:r.id,children:[r.name," (",r.email,")"]},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 dark:text-gray-200",children:"Category"}),e.jsx("input",{value:a.category,onChange:r=>l({...a,category:r.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100",placeholder:"Billing, WhatsApp, Templates..."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 dark:text-gray-200",children:"Tags (comma separated)"}),e.jsx("input",{value:a.tags,onChange:r=>l({...a,tags:r.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100",placeholder:"urgent, whatsapp, api"})]}),e.jsx("div",{className:"md:col-span-3 flex justify-end",children:e.jsx(n,{type:"submit",children:"Save Changes"})})]}),e.jsxs("div",{className:"mt-4 grid gap-2 text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("div",{children:["First response due: ",s.first_response_due_at?new Date(s.first_response_due_at).toLocaleString():"—"]}),e.jsxs("div",{children:["Resolution due: ",s.due_at?new Date(s.due_at).toLocaleString():"—"]}),e.jsxs("div",{children:["Escalation level: ",s.escalation_level??0]})]})]})]}):e.jsxs(c,{className:"border-0 shadow-lg",children:[e.jsxs(g,{className:"bg-gradient-to-r from-indigo-50 to-indigo-100 dark:from-indigo-900/20 dark:to-indigo-800/20",children:[e.jsx(x,{className:"text-xl font-bold",children:"Live Chat Summary"}),e.jsx(m,{children:"Live chat sessions do not use ticket management fields."})]}),e.jsx(p,{className:"p-6 text-sm text-gray-600 dark:text-gray-300",children:"Convert this chat to a ticket if you need assignments, priorities, and SLA tracking."})]}),e.jsxs(c,{className:"border-0 shadow-lg",children:[e.jsxs(g,{className:"bg-gradient-to-r from-slate-50 to-slate-100 dark:from-slate-900/20 dark:to-slate-800/20",children:[e.jsx(x,{className:"text-xl font-bold",children:"Audit Log"}),e.jsx(m,{children:"Recent activity on this ticket"})]}),e.jsxs(p,{className:"p-6 space-y-3",children:[v.length===0&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No audit entries yet."}),v.map(r=>e.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-800 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wider text-gray-500 dark:text-gray-400",children:r.action.replace(/_/g," ")}),e.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-200 mt-1",children:[r.user?.name||"System"," · ",r.user?.email||"—"]}),r.meta&&Object.keys(r.meta).length>0&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:JSON.stringify(r.meta)}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:r.created_at?new Date(r.created_at).toLocaleString():"—"})]},r.id))]})]})]})]})}export{te as default};
