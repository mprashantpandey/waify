import{r,j as e}from"./react-B_HteL0F.js";import{G as Ee,a as E,H as Le,l as Ie,N as $e,aF as Me,aR as Re,aQ as Fe,X as W,ah as Be,k as ie,aS as Pe,aT as He,aU as Ue,aG as de,F as oe,Z as Ke,C as Ve,aV as ce,$ as Oe}from"./vendor-GYTC5Pip.js";import{A as We}from"./AppShell-HrBHfcoG.js";import{a as ze,c as L,B as N}from"./app-C0WBMkkY.js";import{T as h}from"./TextInput-79R2a16S.js";import{B as Qe}from"./Topbar-CPirX8py.js";import{M as Ge}from"./Skeleton-DT9aH67B.js";import{u as Je}from"./useToast-Rch7lQVh.js";import"./GlobalFlashHandler-DpywDQft.js";import"./BrandingWrapper-DIBfDp2T.js";/* empty css            */function dt({workspace:c,conversation:me,messages:I,templates:ge}){const{subscribe:k,connected:_}=ze(),{addToast:m}=Je(),[b,S]=r.useState(I),[n,z]=r.useState(me),[xe,qe]=r.useState(!1),[y,C]=r.useState(!1),[ue,Q]=r.useState(!1),[he,$]=r.useState(!1),[pe,M]=r.useState(!1),[be,R]=r.useState(!1),[x,F]=r.useState([]),[f,D]=r.useState({label:"",lat:"",lng:""}),[d,B]=r.useState(null),[u,p]=r.useState([]),[P,ye]=r.useState(""),[G,J]=r.useState([]),H=r.useRef(null),q=r.useRef(null),U=r.useRef(null),[Z,fe]=r.useState(!0),[X,Y]=r.useState(null),v=r.useRef(Math.max(...I.map(t=>t.id),0)),ee=r.useRef(new Set(I.map(t=>t.id))),{data:j,setData:K,post:te,processing:T,errors:ae,reset:V}=Ee({message:""}),se=["ðŸ˜€","ðŸ˜","ðŸ˜‚","ðŸ¤£","ðŸ˜","ðŸ˜˜","ðŸ˜Š","ðŸ¥°","ðŸ˜Ž","ðŸ¤","ðŸ‘","ðŸ™","ðŸŽ‰","ðŸ”¥","âœ¨","ðŸ’¡","ðŸ˜¢","ðŸ˜®","ðŸ˜¡","ðŸ¤”","ðŸ˜…","ðŸ™Œ","âœ…","âŒ"],ve=[{id:"greeting",label:"Greeting",text:"Hi! How can I help you today?"},{id:"followup",label:"Follow-up",text:"Just checking inâ€”did that solve the issue?"},{id:"thanks",label:"Thanks",text:"Thanks for reaching out! Weâ€™re on it."},{id:"handover",label:"Handover",text:"Iâ€™m looping in a specialist to assist you."}],re=ge||[],je=t=>{K("message",`${j.message||""}${t}`)};r.useEffect(()=>{const t=localStorage.getItem("waify.recentEmojis");if(t)try{const a=JSON.parse(t);Array.isArray(a)&&J(a.slice(0,12))}catch{console.warn("[Emoji] Failed to parse recent emojis")}},[]);const ne=t=>{je(t),J(a=>{const s=[t,...a.filter(l=>l!==t)].slice(0,12);return localStorage.setItem("waify.recentEmojis",JSON.stringify(s)),s})},we=t=>{K("message",t)},Ne=t=>{const a=Array.from(t.target.files||[]);a.length!==0&&(F(s=>[...s,...a]),t.target.value="",m({title:"Attachment added",description:"Attachments will be supported for sending soon.",variant:"info"}))},ke=t=>{F(a=>a.filter((s,l)=>l!==t))},_e=r.useCallback(async()=>{const{label:t,lat:a,lng:s}=f;if(!a||!s){m({title:"Location needed",description:"Add latitude and longitude.",variant:"warning"});return}try{await E.post(route("app.whatsapp.conversations.send-location",{workspace:c.slug,conversation:n.id}),{latitude:Number(a),longitude:Number(s),name:t||null,address:null}),m({title:"Location sent",variant:"success"}),R(!1),D({label:"",lat:"",lng:""})}catch(l){m({title:"Failed to send location",description:l?.response?.data?.message||"Please try again",variant:"error"})}},[m,n.id,f,c.slug]),le=r.useCallback(async t=>{if(x.length!==0){for(let a=0;a<x.length;a+=1){const s=x[a],l=s.type.startsWith("image/")?"image":s.type.startsWith("video/")?"video":"document",i=new FormData;i.append("type",l),i.append("attachment",s),t&&a===0&&i.append("caption",t);try{await E.post(route("app.whatsapp.conversations.send-media",{workspace:c.slug,conversation:n.id}),i,{headers:{"Content-Type":"multipart/form-data"}})}catch(o){m({title:"Failed to send attachment",description:o?.response?.data?.message||"Please try again",variant:"error"});return}}m({title:"Attachments sent",variant:"success"}),F([])}},[m,x,n.id,c.slug]),Se=r.useCallback(async()=>{if(d)try{await E.post(route("app.whatsapp.conversations.send-template",{workspace:c.slug,conversation:n.id}),{template_id:d.id,variables:u}),m({title:"Template sent",variant:"success"}),B(null),p([]),M(!1)}catch(t){m({title:"Failed to send template",description:t?.response?.data?.message||"Please try again",variant:"error"})}},[m,n.id,d,u,c.slug]),A=r.useCallback(()=>{const t=U.current;if(!t)return;const a=t.scrollHeight-t.scrollTop-t.clientHeight<150;fe(a)},[]);r.useEffect(()=>{const t=U.current;if(t)return t.addEventListener("scroll",A),A(),()=>t.removeEventListener("scroll",A)},[A]),r.useEffect(()=>{Z&&b.length>0&&setTimeout(()=>{q.current?.scrollIntoView({behavior:"smooth"})},100)},[b,Z]),r.useEffect(()=>{if(!c?.id||!n?.id)return;const t=`private-workspace.${c.id}.whatsapp.conversation.${n.id}`,a=k(t,".whatsapp.message.created",i=>{const o=i.message;o&&!ee.current.has(o.id)&&(ee.current.add(o.id),S(g=>g.find(w=>w.id===o.id)?g:[...g,o].sort((w,Ae)=>new Date(w.created_at).getTime()-new Date(Ae.created_at).getTime())),v.current=Math.max(v.current,o.id),o.direction==="inbound"&&m({title:"New message",description:o.text_body?.substring(0,50)||"New message received",variant:"info",duration:3e3}))}),s=k(t,".whatsapp.message.updated",i=>{S(o=>o.map(g=>g.id===i.message.id?{...g,status:i.message.status,error_message:i.message.error_message,sent_at:i.message.sent_at,delivered_at:i.message.delivered_at,read_at:i.message.read_at}:g))}),l=k(t,".whatsapp.conversation.updated",i=>{i.conversation&&z(o=>({...o,status:i.conversation.status??o.status}))});return()=>{a(),s(),l()}},[c?.id,n?.id,k,m]),r.useEffect(()=>{if(_||!c?.id||!n?.id){X&&(clearInterval(X),Y(null));return}const t=async()=>{try{const s=await E.get(route("app.whatsapp.inbox.conversation.stream",{workspace:c.slug,conversation:n.id}),{params:{after_message_id:v.current}});s.data.new_messages?.length>0&&(S(l=>{const i=new Set(l.map(g=>g.id)),o=s.data.new_messages.filter(g=>!i.has(g.id));return[...l,...o].sort((g,w)=>new Date(g.created_at).getTime()-new Date(w.created_at).getTime())}),v.current=Math.max(...s.data.new_messages.map(l=>l.id),v.current)),s.data.updated_messages?.length>0&&S(l=>l.map(i=>{const o=s.data.updated_messages.find(g=>g.id===i.id);return o?{...i,...o}:i})),s.data.conversation&&z(l=>({...l,...s.data.conversation}))}catch(s){console.error("[Conversation] Polling error:",s)}},a=setInterval(t,15e3);return Y(a),t(),()=>{clearInterval(a)}},[_,c?.id,c?.slug,n?.id]);const O=r.useCallback(async()=>{if(T)return;const t=j.message.trim();if(x.length>0){await le(t||void 0),V("message");return}t&&te(route("app.whatsapp.conversations.send",{workspace:c.slug,conversation:n.id}),{onSuccess:()=>{V("message"),m({title:"Message sent",variant:"success",duration:2e3})},onError:a=>{m({title:"Failed to send message",description:a.message||"Please try again",variant:"error"})}})},[T,j.message,x.length,le,te,c.slug,n.id,V,m]),Ce=t=>{t.preventDefault(),O()};r.useEffect(()=>{const t=a=>{a.key==="Escape"&&y&&C(!1),(a.metaKey||a.ctrlKey)&&a.key==="Enter"&&(a.preventDefault(),O()),(a.metaKey||a.ctrlKey)&&a.shiftKey&&(a.key.toLowerCase()==="e"&&(a.preventDefault(),Q(s=>!s)),a.key.toLowerCase()==="k"&&(a.preventDefault(),$(s=>!s)),a.key.toLowerCase()==="t"&&(a.preventDefault(),M(s=>!s)))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[y,O]);const De=t=>{if(t.direction==="inbound")return null;switch(t.status){case"sent":return e.jsx(Oe,{className:"h-3.5 w-3.5 text-gray-400"});case"delivered":return e.jsx(ce,{className:"h-3.5 w-3.5 text-gray-400"});case"read":return e.jsx(ce,{className:"h-3.5 w-3.5 text-blue-500"});case"failed":return e.jsx("span",{className:"text-xs text-red-500 font-medium",children:"Failed"});default:return e.jsx(Ve,{className:"h-3.5 w-3.5 text-gray-400"})}},Te=t=>{const a=t.payload||{};if(t.type==="image"&&a.link)return e.jsxs("div",{className:"space-y-2",children:[e.jsx("img",{src:a.link,alt:"Image attachment",className:"max-h-48 rounded-lg border border-gray-200 object-cover"}),t.text_body&&e.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:t.text_body})]});if(t.type==="video"&&a.link)return e.jsxs("div",{className:"space-y-2",children:[e.jsx("video",{controls:!0,className:"max-h-48 rounded-lg border border-gray-200 w-full",children:e.jsx("source",{src:a.link})}),t.text_body&&e.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:t.text_body})]});if(t.type==="document"&&a.link)return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("a",{href:a.link,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-2 text-sm font-semibold text-emerald-700 hover:text-emerald-800",children:[e.jsx(oe,{className:"h-4 w-4"}),a.filename||"Document"]}),t.text_body&&e.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:t.text_body})]});if(t.type==="location"&&a.latitude&&a.longitude){const s=`https://maps.google.com/?q=${a.latitude},${a.longitude}`;return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("a",{href:s,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-2 text-sm font-semibold text-emerald-700 hover:text-emerald-800",children:[e.jsx(de,{className:"h-4 w-4"}),"View location"]}),a.name&&e.jsx("p",{className:"text-sm text-gray-700",children:a.name}),a.address&&e.jsx("p",{className:"text-xs text-gray-500",children:a.address})]})}return t.text_body?e.jsx("p",{className:"text-sm whitespace-pre-wrap break-words leading-relaxed",children:t.text_body}):null};return e.jsxs(We,{children:[e.jsx(Le,{title:`${n.contact.name||n.contact.wa_id} - Inbox`}),e.jsxs("div",{className:"flex flex-col h-[calc(100vh-8rem)] lg:h-[calc(100vh-6rem)] rounded-3xl overflow-hidden border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-[#075E54] text-white",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsxs(Ie,{href:route("app.whatsapp.conversations.index",{workspace:c.slug}),className:"inline-flex items-center text-sm font-medium text-white/90 hover:text-white transition-colors","aria-label":"Back to conversations",children:[e.jsx($e,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Back"})]}),e.jsx("div",{className:"h-10 w-10 rounded-full bg-[#25D366] flex items-center justify-center text-white font-bold text-lg shadow-lg flex-shrink-0",children:n.contact.name?.charAt(0).toUpperCase()||n.contact.wa_id.charAt(0)}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-base sm:text-lg font-semibold truncate",children:n.contact.name||n.contact.wa_id}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-white/80",children:[e.jsx(Me,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate",children:n.contact.wa_id}),e.jsx("span",{className:"text-white/60",children:"â€¢"}),e.jsx("span",{className:"truncate",children:n.connection.name}),!_&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-white/60",children:"â€¢"}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Re,{className:"h-3 w-3 text-amber-200"}),"Polling"]})]}),_&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Fe,{className:"h-3 w-3 text-green-200"}),"Live"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"hidden sm:inline-flex rounded-full bg-white/15 px-3 py-1 text-xs uppercase tracking-wide",children:n.status}),e.jsx("button",{onClick:()=>C(!y),className:"lg:hidden p-2 rounded-lg text-white/90 hover:bg-white/10 transition-colors","aria-label":"Toggle menu",children:y?e.jsx(W,{className:"h-5 w-5"}):e.jsx(Be,{className:"h-5 w-5"})})]})]}),y&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-40 lg:hidden",onClick:()=>C(!1),"aria-hidden":"true"}),e.jsxs("div",{className:"fixed right-0 top-0 h-full w-80 bg-white dark:bg-gray-900 shadow-2xl z-50 lg:hidden p-6 border-l border-gray-200 dark:border-gray-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:"Conversation Info"}),e.jsx("button",{onClick:()=>C(!1),className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800",children:e.jsx(W,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"p-4 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-xl border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-lg shadow-lg",children:n.contact.name?.charAt(0).toUpperCase()||n.contact.wa_id.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:n.contact.name||"Unknown"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:n.contact.wa_id})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2",children:"Connection"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:n.connection.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2",children:"Status"}),e.jsx(Qe,{variant:n.status==="open"?"success":"default",className:"px-3 py-1",children:n.status})]})]})]})]})]}),e.jsxs("div",{ref:U,className:"flex-1 overflow-y-auto px-4 py-6 space-y-4 bg-[#efeae2] dark:bg-gray-950 focus:outline-none",style:{backgroundImage:"radial-gradient(rgba(0,0,0,0.04) 1px, transparent 1px)",backgroundSize:"16px 16px"},tabIndex:0,children:[xe?e.jsx(e.Fragment,{children:[...Array(3)].map((t,a)=>e.jsx(Ge,{},a))}):b.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-white/80 dark:bg-gray-900 mb-4 shadow-sm",children:e.jsx(ie,{className:"h-8 w-8 text-gray-400"})}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 font-medium mb-1",children:"No messages yet"}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:"Start the conversation!"})]}):b.map((t,a)=>{const s=a===0||new Date(t.created_at).toDateString()!==new Date(b[a-1].created_at).toDateString();return e.jsxs("div",{children:[s&&e.jsx("div",{className:"flex items-center justify-center my-4",children:e.jsx("div",{className:"px-3 py-1 bg-gray-100 dark:bg-gray-800 rounded-full text-xs font-medium text-gray-600 dark:text-gray-400",children:new Date(t.created_at).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})}),e.jsx("div",{className:L("flex",t.direction==="outbound"?"justify-end":"justify-start"),children:e.jsxs("div",{className:L("max-w-xs lg:max-w-md px-4 py-2.5 rounded-2xl shadow-sm",t.direction==="outbound"?"bg-[#d9fdd3] text-gray-900 rounded-tr-md":"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border border-gray-200 dark:border-gray-700 rounded-tl-md"),children:[Te(t),e.jsxs("div",{className:"flex items-center justify-end gap-1.5 mt-2",children:[e.jsx("span",{className:L("text-[11px]",t.direction==="outbound"?"text-gray-600":"text-gray-500 dark:text-gray-400"),children:new Date(t.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),De(t)]})]})})]},t.id)}),e.jsx("div",{ref:q})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-800 bg-[#f0f2f5] dark:bg-gray-900 p-3",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>Q(t=>!t),className:"inline-flex items-center gap-2 rounded-full border border-gray-200 bg-white px-3 py-1.5 text-xs font-semibold text-gray-600 shadow-sm hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:[e.jsx(Pe,{className:"h-3.5 w-3.5"}),"Emoji"]}),e.jsxs("button",{type:"button",onClick:()=>H.current?.click(),className:"inline-flex items-center gap-2 rounded-full border border-gray-200 bg-white px-3 py-1.5 text-xs font-semibold text-gray-600 shadow-sm hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:[e.jsx(He,{className:"h-3.5 w-3.5"}),"Attach"]}),e.jsxs("button",{type:"button",onClick:()=>H.current?.click(),className:"inline-flex items-center gap-2 rounded-full border border-gray-200 bg-white px-3 py-1.5 text-xs font-semibold text-gray-600 shadow-sm hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:[e.jsx(Ue,{className:"h-3.5 w-3.5"}),"Photo/Video"]}),e.jsxs("button",{type:"button",onClick:()=>R(t=>!t),className:"inline-flex items-center gap-2 rounded-full border border-gray-200 bg-white px-3 py-1.5 text-xs font-semibold text-gray-600 shadow-sm hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:[e.jsx(de,{className:"h-3.5 w-3.5"}),"Location"]}),e.jsxs("button",{type:"button",onClick:()=>M(t=>!t),className:"inline-flex items-center gap-2 rounded-full border border-gray-200 bg-white px-3 py-1.5 text-xs font-semibold text-gray-600 shadow-sm hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:[e.jsx(oe,{className:"h-3.5 w-3.5"}),"Templates"]}),e.jsxs("button",{type:"button",onClick:()=>$(t=>!t),className:"inline-flex items-center gap-2 rounded-full border border-gray-200 bg-white px-3 py-1.5 text-xs font-semibold text-gray-600 shadow-sm hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:[e.jsx(Ke,{className:"h-3.5 w-3.5"}),"Quick Replies"]}),e.jsx("input",{ref:H,type:"file",multiple:!0,accept:"image/*,video/*,application/pdf",className:"hidden",onChange:Ne})]}),ue&&e.jsxs("div",{className:"absolute bottom-full left-0 mb-3 z-20 flex flex-wrap items-center gap-2 rounded-2xl border border-gray-200 bg-white/95 p-3 text-lg shadow-lg dark:border-gray-700 dark:bg-gray-800",children:[e.jsx("div",{className:"w-full",children:e.jsx(h,{value:P,onChange:t=>ye(t.target.value),placeholder:"Search emojis",className:"rounded-xl text-sm"})}),G.length>0&&e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"mb-2 text-[11px] font-semibold uppercase tracking-wide text-gray-500",children:"Recent"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:G.map(t=>e.jsx("button",{type:"button",onClick:()=>ne(t),className:"rounded-lg px-2 py-1 hover:bg-gray-100 dark:hover:bg-gray-700",children:t},`recent-${t}`))})]}),(P.trim()?se.filter(t=>t.includes(P.trim())):se).map(t=>e.jsx("button",{type:"button",onClick:()=>ne(t),className:"rounded-lg px-2 py-1 hover:bg-gray-100 dark:hover:bg-gray-700",children:t},t))]})]}),be&&e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-gray-800",children:[e.jsxs("div",{className:"grid gap-3 sm:grid-cols-3",children:[e.jsx(h,{value:f.label,onChange:t=>D(a=>({...a,label:t.target.value})),placeholder:"Label (optional)",className:"rounded-xl"}),e.jsx(h,{value:f.lat,onChange:t=>D(a=>({...a,lat:t.target.value})),placeholder:"Latitude",className:"rounded-xl"}),e.jsx(h,{value:f.lng,onChange:t=>D(a=>({...a,lng:t.target.value})),placeholder:"Longitude",className:"rounded-xl"})]}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx(N,{type:"button",variant:"secondary",onClick:()=>R(!1),children:"Cancel"}),e.jsx(N,{type:"button",onClick:_e,className:"bg-[#25D366] hover:bg-[#1DAA57] text-white",children:"Send Location"})]})]}),he&&e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-gray-800",children:e.jsx("div",{className:"grid gap-2",children:ve.map(t=>e.jsxs("button",{type:"button",onClick:()=>{we(t.text),$(!1)},className:"w-full rounded-xl border border-gray-200 px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:text-gray-200 dark:hover:bg-gray-700",children:[e.jsx("p",{className:"font-semibold",children:t.label}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.text})]},t.id))})}),pe&&e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-gray-800",children:[e.jsxs("div",{className:"grid gap-3",children:[re.length===0&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No approved templates found for this connection."}),re.map(t=>e.jsxs("button",{type:"button",onClick:()=>{B(t),p(Array.from({length:t.variable_count||0},()=>""))},className:L("w-full rounded-xl border px-3 py-2 text-left text-sm hover:bg-gray-50 dark:hover:bg-gray-700",d?.id===t.id?"border-emerald-400 bg-emerald-50/70 text-emerald-900 dark:border-emerald-500/70 dark:bg-emerald-500/10 dark:text-emerald-100":"border-gray-200 text-gray-700 dark:border-gray-700 dark:text-gray-200"),children:[e.jsx("p",{className:"font-semibold",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.body_text||"Template message"})]},t.id))]}),d&&e.jsxs("div",{className:"mt-4 rounded-xl border border-gray-200 bg-gray-50 p-3 dark:border-gray-700 dark:bg-gray-900",children:[e.jsx("div",{className:"mb-3 text-sm font-semibold text-gray-700 dark:text-gray-200",children:"Fill template variables"}),u.length===0&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"This template has no variables."}),e.jsxs("div",{className:"grid gap-4",children:[d.header_count>0&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Header variables"}),u.slice(0,d.header_count).map((t,a)=>e.jsx(h,{value:t,onChange:s=>{const l=[...u];l[a]=s.target.value,p(l)},placeholder:`Header variable ${a+1}`,className:"rounded-xl"},`${d.id}-header-${a}`))]}),d.body_count>0&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Body variables"}),u.slice(d.header_count,d.header_count+d.body_count).map((t,a)=>e.jsx(h,{value:t,onChange:s=>{const l=[...u];l[d.header_count+a]=s.target.value,p(l)},placeholder:`Body variable ${a+1}`,className:"rounded-xl"},`${d.id}-body-${a}`))]}),d.button_count>0&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Button variables"}),u.slice(d.header_count+d.body_count,d.variable_count).map((t,a)=>e.jsx(h,{value:t,onChange:s=>{const l=[...u];l[d.header_count+d.body_count+a]=s.target.value,p(l)},placeholder:`Button variable ${a+1}`,className:"rounded-xl"},`${d.id}-button-${a}`))]})]}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx(N,{type:"button",variant:"secondary",onClick:()=>{B(null),p([])},children:"Clear"}),e.jsx(N,{type:"button",onClick:Se,className:"bg-[#25D366] hover:bg-[#1DAA57] text-white",children:"Send Template"})]})]})]}),x.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:x.map((t,a)=>e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-white px-3 py-1 text-xs text-gray-600 shadow-sm dark:bg-gray-800 dark:text-gray-300",children:[e.jsx("span",{className:"truncate max-w-[160px]",children:t.name}),e.jsx("button",{type:"button",onClick:()=>ke(a),className:"text-gray-400 hover:text-gray-600",children:e.jsx(W,{className:"h-3.5 w-3.5"})})]},`${t.name}-${a}`))}),e.jsxs("form",{onSubmit:Ce,className:"flex items-center gap-3",children:[e.jsx(h,{value:j.message,onChange:t=>K("message",t.target.value),placeholder:"Type a message",className:"flex-1 rounded-full bg-white dark:bg-gray-800",disabled:T,autoFocus:!0,"aria-label":"Message input"}),e.jsx(N,{type:"submit",disabled:T||!j.message.trim()&&x.length===0,"aria-label":"Send message",className:"bg-[#25D366] hover:bg-[#1DAA57] text-white rounded-full px-5",children:e.jsx(ie,{className:"h-4 w-4"})})]})]}),ae.message&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-2",role:"alert",children:ae.message})]})]})]})}export{dt as default};
