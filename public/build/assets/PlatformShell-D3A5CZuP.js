import{r as t,j as e}from"./react-B_HteL0F.js";import{u as B,M as O,X as D,a as k,ag as U,ao as G,U as H,W as q,n as X,F as z,a2 as Z,ae as J,A as K,D as W,ad as Q,l as $}from"./vendor-GYTC5Pip.js";import{T as V}from"./Topbar-CPirX8py.js";import{B as Y}from"./BrandingWrapper-DIBfDp2T.js";import{T as ee,G as re}from"./GlobalFlashHandler-DpywDQft.js";import{a as ae,B as A,c as M}from"./app-C0WBMkkY.js";import{u as se}from"./useToast-Rch7lQVh.js";const te=i=>i.mime_type?i.mime_type.startsWith("image/"):/\.(png|jpe?g|gif|webp|svg)$/i.test(i.file_name),ie=i=>i.mime_type?i.mime_type==="application/pdf":/\.pdf$/i.test(i.file_name);function oe(){const{branding:i,ai:m}=B().props,{subscribe:g}=ae(),{addToast:u}=se(),[o,f]=t.useState(!1),[h,d]=t.useState(!1),[a,j]=t.useState(null),[y,n]=t.useState([]),[l,v]=t.useState(null),[_,w]=t.useState([]),[b,S]=t.useState(""),[C,T]=t.useState([]),[L,E]=t.useState(!1),N=async()=>{const s=(await k.get(route("platform.support.live.list"),{headers:{Accept:"application/json"}})).data;n(s.threads||[]),(!l||!s.threads?.some(c=>c.slug===l))&&s.threads?.length&&v(s.threads[0].slug)},P=async r=>{d(!0);const c=(await k.get(route("platform.support.live.thread",{thread:r}),{headers:{Accept:"application/json"}})).data;j(c.thread),w(c.messages||[]),d(!1)};t.useEffect(()=>{if(!o)return;let r=!0;return d(!0),N().then(()=>{if(l)return P(l)}).finally(()=>{r&&d(!1)}),()=>{r=!1}},[o]),t.useEffect(()=>{!o||!l||P(l)},[l]),t.useEffect(()=>{if(!o)return;const r=g("platform.support","support.message.created",()=>{N()});return()=>r()},[o,g]),t.useEffect(()=>{if(!a?.workspace?.id)return;const r=`workspace.${a.workspace.id}.support.thread.${a.id}`,s=g(r,"support.message.created",c=>{w(p=>p.some(x=>x.id===c.id)?p:[...p,c])});return()=>{s()}},[g,a?.id,a?.workspace?.id]);const I=async()=>{if(!b.trim()&&C.length===0||!a?.id)return;const r=new FormData;b.trim()&&r.append("message",b.trim()),r.append("thread_id",String(a.id)),C.forEach(x=>r.append("attachments[]",x)),S(""),T([]);const p=(await k.post(route("platform.support.live.message"),r,{headers:{Accept:"application/json"}})).data.message;p&&w(x=>x.some(F=>F.id===p.id)?x:[...x,p]),N()},R=async()=>{if(a?.id){E(!0);try{const s=(await k.post(route("platform.support.assistant",{thread:a.slug??a.id}),{action:"reply"},{headers:{Accept:"application/json"}})).data?.suggestion;s&&S(s)}catch(r){u({title:"AI Assistant",description:r?.response?.data?.error||"AI assistant is disabled.",variant:"error"})}finally{E(!1)}}};return e.jsxs("div",{className:"fixed bottom-6 right-6 z-40",children:[!o&&e.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-2 rounded-full bg-gray-900 text-white px-4 py-3 shadow-lg hover:bg-gray-800 transition",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-semibold",children:"Support Live"})]}),o&&e.jsxs("div",{className:"w-[28rem] max-w-[95vw] rounded-2xl bg-white dark:bg-gray-900 shadow-xl border border-gray-200 dark:border-gray-800 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-gradient-to-r from-gray-900 to-gray-700 text-white",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:"Support Inbox"}),e.jsx("div",{className:"text-xs opacity-80",children:a?.workspace?.name?`Workspace: ${a.workspace.name}`:"Live conversations"})]}),e.jsx("button",{onClick:()=>f(!1),className:"p-1 hover:opacity-80",children:e.jsx(D,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"px-4 py-3 text-xs text-gray-500 dark:text-gray-400 border-b border-gray-200 dark:border-gray-800",children:i?.support_email?`Primary support email: ${i.support_email}`:"Reply to keep the thread active."}),e.jsxs("div",{className:"grid grid-cols-5 gap-0",children:[e.jsxs("div",{className:"col-span-2 border-r border-gray-200 dark:border-gray-800 max-h-[26rem] overflow-y-auto",children:[y.length===0&&e.jsx("div",{className:"p-4 text-xs text-gray-500 dark:text-gray-400",children:"No active live chats."}),y.map(r=>e.jsxs("button",{onClick:()=>v(r.slug),className:`w-full text-left px-4 py-3 border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800/40 ${l===r.slug?"bg-gray-50 dark:bg-gray-800/60":""}`,children:[e.jsx("div",{className:"text-xs font-semibold text-gray-900 dark:text-gray-100",children:r.workspace?.name??"Workspace"}),e.jsx("div",{className:"text-[11px] text-gray-500 dark:text-gray-400 truncate",children:r.subject})]},r.id))]}),e.jsxs("div",{className:"col-span-3 flex flex-col",children:[e.jsxs("div",{className:"h-64 overflow-y-auto px-4 py-3 space-y-3",children:[h&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Loading latest conversation..."}),!h&&_.length===0&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"No messages yet. Open the support inbox for more details."}),a?.status==="closed"&&e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md px-3 py-2",children:"This chat is closed."}),_.map(r=>e.jsxs("div",{className:`rounded-lg px-3 py-2 text-xs leading-relaxed ${r.sender_type==="admin"?"bg-blue-50 dark:bg-blue-900/30 text-gray-900 dark:text-gray-100":"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100"}`,children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wider opacity-60 mb-1",children:r.sender_type==="admin"?"Support":"Tenant"}),r.body,r.attachments&&r.attachments.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:r.attachments.map(s=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("a",{href:s.url,target:"_blank",rel:"noreferrer",className:"block text-[11px] text-blue-600 dark:text-blue-300 hover:underline",children:s.file_name}),te(s)&&e.jsx("img",{src:s.url,alt:s.file_name,className:"max-h-32 rounded-md border border-gray-200 dark:border-gray-700"}),ie(s)&&e.jsxs("details",{className:"text-[11px] text-gray-600 dark:text-gray-300",children:[e.jsx("summary",{className:"cursor-pointer",children:"Preview PDF"}),e.jsx("iframe",{src:s.url,className:"mt-2 h-36 w-full rounded-md border border-gray-200 dark:border-gray-700"})]})]},s.id))})]},r.id))]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-800 p-3 space-y-2",children:[e.jsx("textarea",{value:b,onChange:r=>S(r.target.value),rows:2,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100 text-sm",placeholder:"Reply to tenant..."}),e.jsx("input",{type:"file",multiple:!0,onChange:r=>T(Array.from(r.target.files||[])),className:"block w-full text-xs text-gray-500 file:mr-4 file:rounded-md file:border-0 file:bg-gray-100 file:px-3 file:py-1.5 file:text-xs file:font-semibold file:text-gray-700 hover:file:bg-gray-200 dark:file:bg-gray-800 dark:file:text-gray-200 dark:hover:file:bg-gray-700"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[m?.enabled&&e.jsx(A,{type:"button",variant:"secondary",onClick:R,disabled:L||!a,children:L?"Generating...":"AI Suggest"}),a?.status==="open"&&e.jsx(A,{type:"button",variant:"secondary",onClick:async()=>{a&&(await k.post(route("platform.support.close",{thread:a.slug??a.id})),j({...a,status:"closed"}),N())},children:"Close Chat"}),e.jsx(A,{type:"button",onClick:I,disabled:b.trim().length===0&&C.length===0||!a||a?.status==="closed",children:"Send"})]})]})]})]})]})]})}function me({children:i,auth:m}){const{branding:g,ziggy:u}=B().props,o=g?.platform_name||"Platform",f=g?.logo_url,h=window.location.pathname,[d,a]=t.useState(!1);t.useEffect(()=>{a(!1)},[h]),t.useEffect(()=>{u&&(window.Ziggy=u)},[u]),t.useEffect(()=>{const n=()=>{window.innerWidth>=1024&&a(!1)};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]);const j=[{name:"Dashboard",href:route("platform.dashboard"),icon:U},{name:"Workspaces",href:route("platform.workspaces.index"),icon:G},{name:"Users",href:route("platform.users.index"),icon:H},{name:"Plans",href:route("platform.plans.index"),icon:q},{name:"Modules",href:route("platform.modules.index"),icon:X},{name:"Subscriptions",href:route("platform.subscriptions.index"),icon:z},{name:"Analytics",href:route("platform.analytics"),icon:Z},{name:"Templates",href:route("platform.templates.index"),icon:z},{name:"Support",href:route("platform.support.hub"),icon:J},{name:"Activity Logs",href:route("platform.activity-logs"),icon:K},{name:"System Health",href:route("platform.system-health"),icon:W},{name:"Settings",href:route("platform.settings"),icon:Q}],y=e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between h-16 px-6 border-b border-gray-200 dark:border-gray-800",children:[f?e.jsx("img",{src:f,alt:o,className:"h-8 w-auto"}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"}),e.jsx("h1",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:o})]}),e.jsx("button",{onClick:()=>a(!1),className:"lg:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800",children:e.jsx(D,{className:"h-5 w-5 text-gray-700 dark:text-gray-300"})})]}),e.jsx("nav",{className:"flex-1 px-4 py-4 space-y-1",children:j.map(n=>{const l=n.icon,v=h.startsWith(n.href);return e.jsxs($,{href:n.href,className:M("flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-colors",v?"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[e.jsx(l,{className:"h-5 w-5"}),n.name]},n.name)})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-800",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 truncate",children:m?.user?.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:m?.user?.email})]})}),e.jsx($,{href:route("profile.edit"),className:"mt-2 block text-xs text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100",children:"Profile Settings"})]})]});return e.jsxs(Y,{children:[e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-950",children:[d&&e.jsx("div",{className:"lg:hidden fixed inset-0 z-40 bg-black/50 transition-opacity",onClick:()=>a(!1)}),e.jsx("aside",{className:M("lg:hidden fixed inset-y-0 left-0 z-50 w-64 bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 transform transition-transform duration-300 ease-in-out",d?"translate-x-0":"-translate-x-full"),children:y}),e.jsx("aside",{className:"hidden lg:flex lg:flex-col lg:w-64 lg:fixed lg:inset-y-0 lg:z-30 bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800",children:y}),e.jsxs("div",{className:"lg:pl-64",children:[e.jsx(V,{workspace:null,workspaces:[],user:m?.user||null,onMenuClick:()=>a(!d)}),e.jsx("main",{className:"p-4 lg:p-6",children:i})]})]}),e.jsx(ee,{}),e.jsx(re,{}),e.jsx(oe,{})]})}export{me as P};
