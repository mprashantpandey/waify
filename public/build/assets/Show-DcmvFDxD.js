import{j as e,r as n}from"./react-BhzSerM2.js";import{o as jt,H as wt,u as ua,a as I,k as ma,q as Oe,V as ha,aX as pa,b5 as ba,b4 as ya,X as fe,at as fa,p as Nt,b6 as va,b7 as ja,b8 as wa,a_ as kt,F as _t,b9 as Na,ba as ka,Z as _a,f as Sa,d as Ca,l as Aa,bb as St,a1 as Ta}from"./vendor-YQoUUhbX.js";import{A as Ct}from"./AppShell-A6sQ3pxr.js";import{a as Ma,B as y,c as ie}from"./app-DjsbE74r.js";import{T as w}from"./TextInput-DRXLElIV.js";import{T as At}from"./Textarea-DNfs4TUT.js";import{B as Tt}from"./Badge-C6d-QEGL.js";import{M as Da}from"./Skeleton-CfTHwkjJ.js";import{u as La}from"./useToast-C37H2DkG.js";import"./Topbar-D6SeU-QE.js";import"./GlobalFlashHandler-DjMhmIiM.js";import"./BrandingWrapper-Djq-D_tN.js";import"./Alert-u60ICsin.js";import"./CookieConsentBanner-C37xsP7H.js";/* empty css            */const h=d=>{if(Array.isArray(d))return d;if(d&&typeof d=="object"){const f=d.data;if(Array.isArray(f))return f;const k=Object.values(d);if(k.every(b=>b&&typeof b=="object"))return k}return[]},ve=d=>{if(!d||d.id==null||!d.created_at)return null;const f=Number(d.id);return!Number.isInteger(f)||f<1?null:{id:f,direction:d.direction==="inbound"?"inbound":"outbound",type:String(d.type??"text"),text_body:d.text_body??null,payload:d.payload??null,status:String(d.status??"queued"),created_at:String(d.created_at),updated_at:d.updated_at??null,sent_at:d.sent_at??null,delivered_at:d.delivered_at??null,read_at:d.read_at??null}},je=(d,f)=>{const k=new Map;for(const b of d)k.set(b.id,b);for(const b of f){const U=k.get(b.id);k.set(b.id,U?{...U,...b}:b)}return Array.from(k.values()).sort((b,U)=>new Date(b.created_at).getTime()-new Date(U.created_at).getTime())},T=d=>d.length>0?Math.max(...d.map(f=>f.id)):0;function Ga({account:d,conversation:f,messages:k=[],total_messages:b,templates:U=[],lists:qe=[],notes:Ve=[],audit_events:Ke=[],agents:We=[],inbox_settings:Ge={auto_assign_enabled:!1,auto_assign_strategy:"round_robin"},ai_available:Mt=!1}){const _=jt().props,S=f??_?.conversation??null,Je=h(k).length>0?h(k):h(_?.messages),Dt=h(Ve).length>0?h(Ve):h(_?.notes),Lt=h(Ke).length>0?h(Ke):h(_?.audit_events),Et=h(We).length>0?h(We):h(_?.agents),Bt=h(U).length>0?h(U):h(_?.templates),It=h(qe).length>0?h(qe):h(_?.lists),$=Number(b??_?.total_messages??0),Rt=!!(Mt??_?.ai_available??!1),Ft=!!(_?.ai?.enabled??!1);if(!S)return e.jsxs(Ct,{children:[e.jsx(wt,{title:"Conversation"}),e.jsx("div",{className:"p-6 text-sm text-gray-600 dark:text-gray-300",children:"Unable to load conversation data. Please refresh the page."})]});const q=t=>Array.isArray(t)?t:[],p=n.useMemo(()=>q(Je).map(ve).filter(t=>t!==null).sort((t,a)=>new Date(t.created_at).getTime()-new Date(a.created_at).getTime()),[Je]),R=Dt,F=Lt,we=Et,Pt=Bt,Qe=It,{subscribe:V,connected:de}=Ma(),{addToast:o}=La(),{auth:M}=jt().props,v=M?.user?.id,Xe=M?.user?.notify_assignment_enabled??!0,Ze=M?.user?.notify_mention_enabled??!0,Ye=M?.user?.notify_sound_enabled??!0,Ut=M?.user?.ai_suggestions_enabled??!1,Ne=!!(Rt&&Ut&&Ft),[H,z]=n.useState(p),[i,oe]=n.useState(S),[$t,K]=n.useState(p.length===0&&$>0),[X,le]=n.useState(!1),[Ht,et]=n.useState(!1),[zt,ke]=n.useState(!1),[Ot,_e]=n.useState(!1),[qt,Se]=n.useState(!1),[ce,tt]=n.useState(!1),[Vt,ge]=n.useState(!1),[Kt,Ce]=n.useState(!1),[W,Ae]=n.useState(null),[D,Z]=n.useState([{id:"",text:""}]),[Y,Te]=n.useState(""),[xe,Me]=n.useState(""),[ue,De]=n.useState(""),[L,Le]=n.useState([]),[ee,me]=n.useState({label:"",lat:"",lng:""}),[x,Ee]=n.useState(null),[E,G]=n.useState([]),[Be,Wt]=n.useState(""),[at,st]=n.useState([]),[Ie,te]=n.useState(R),[Re,he]=n.useState(F),[rt,nt]=n.useState(""),[O,it]=n.useState(!1),Fe=n.useRef(null),dt=n.useRef(null),Pe=n.useRef(null),[ot,Gt]=n.useState(!0),[lt,ct]=n.useState(null),C=n.useRef(T(p)),ae=n.useRef(new Set(p.map(t=>t.id))),j=n.useRef(p.reduce((t,a)=>{const s=a.updated_at??a.created_at;return t?new Date(s).getTime()>new Date(t).getTime()?s:t:s},"")),N=n.useRef(T(R)),B=n.useRef(T(F)),pe=n.useRef(S.assigned_to??null),gt=n.useRef(null),J=n.useRef(p.length>0),{data:se,setData:re,post:xt,processing:ne,errors:ut,reset:Ue}=ua({message:""});n.useEffect(()=>{if(!S)return;const t=gt.current!==S.id;if(oe(a=>t?S:{...a,...S}),t){z(p),te(R),he(F),K(p.length===0&&$>0),gt.current=S.id,pe.current=S.assigned_to??null,J.current=p.length>0,C.current=T(p),ae.current=new Set(p.map(a=>a.id)),j.current=p.reduce((a,s)=>{const r=s.updated_at??s.created_at;return a?new Date(r).getTime()>new Date(a).getTime()?r:a:r},""),N.current=T(R),B.current=T(F);return}p.length>0&&(z(a=>je(a,p)),K(!1),J.current=!0,C.current=Math.max(...p.map(a=>a.id),C.current)),R.length>0&&(te(a=>{const s=new Map(a.map(r=>[r.id,r]));return R.forEach(r=>s.set(r.id,r)),Array.from(s.values()).sort((r,u)=>new Date(u.created_at).getTime()-new Date(r.created_at).getTime())}),N.current=Math.max(...R.map(a=>a.id),N.current)),F.length>0&&(he(a=>{const s=new Map(a.map(r=>[r.id,r]));return F.forEach(r=>s.set(r.id,r)),Array.from(s.values()).sort((r,u)=>new Date(u.created_at).getTime()-new Date(r.created_at).getTime())}),B.current=Math.max(...F.map(a=>a.id),B.current))},[S,p,R,F,$]);const mt=["ðŸ˜€","ðŸ˜","ðŸ˜‚","ðŸ¤£","ðŸ˜","ðŸ˜˜","ðŸ˜Š","ðŸ¥°","ðŸ˜Ž","ðŸ¤","ðŸ‘","ðŸ™","ðŸŽ‰","ðŸ”¥","âœ¨","ðŸ’¡","ðŸ˜¢","ðŸ˜®","ðŸ˜¡","ðŸ¤”","ðŸ˜…","ðŸ™Œ","âœ…","âŒ"],Jt=[{id:"greeting",label:"Greeting",text:"Hi! How can I help you today?"},{id:"followup",label:"Follow-up",text:"Just checking inâ€”did that solve the issue?"},{id:"thanks",label:"Thanks",text:"Thanks for reaching out! Weâ€™re on it."},{id:"handover",label:"Handover",text:"Iâ€™m looping in a specialist to assist you."}],ht=Pt,Qt=new Map(we.map(t=>[t.id,t])),pt=n.useMemo(()=>{if(!M?.user)return[];const t=M.user.name||"",a=M.user.email||"",s=t.split(" ")[0]||"",r=t.replace(/\s+/g,"");return[a,t,s,r].filter(Boolean).map(u=>`@${u.toLowerCase()}`)},[M?.user]),$e=n.useCallback(()=>{if(Ye)try{const t=window.AudioContext||window.webkitAudioContext;if(!t)return;const a=new t,s=a.createOscillator(),r=a.createGain();s.type="sine",s.frequency.value=880,r.gain.value=.04,s.connect(r),r.connect(a.destination),s.start(),s.stop(a.currentTime+.12)}catch{console.warn("[Notifications] Unable to play sound")}},[Ye]),bt=n.useCallback((t,a)=>{if(!Ze||!v||a&&a===v)return!1;const s=t.toLowerCase();return pt.some(r=>s.includes(r))},[Ze,v,pt]),Xt=t=>{re("message",`${se.message||""}${t}`)};n.useEffect(()=>{const t=localStorage.getItem("waify.recentEmojis");if(t)try{const a=JSON.parse(t);Array.isArray(a)&&st(a.slice(0,12))}catch{console.warn("[Emoji] Failed to parse recent emojis")}},[]);const yt=t=>{Xt(t),st(a=>{const s=[t,...a.filter(r=>r!==t)].slice(0,12);return localStorage.setItem("waify.recentEmojis",JSON.stringify(s)),s})},Zt=t=>{re("message",t)},Yt=t=>{const a=Array.from(t.target.files||[]);a.length!==0&&(Le(s=>[...s,...a]),t.target.value="",o({title:"Attachment added",description:"Attachments will be supported for sending soon.",variant:"info"}))},ea=t=>{Le(a=>a.filter((s,r)=>r!==t))},ta=n.useCallback(async()=>{if(!W){o({title:"List needed",description:"Please select a list to send.",variant:"warning"});return}try{await I.post(route("app.whatsapp.conversations.send-list",{conversation:i.id}),{list_id:W.id}),o({title:"List sent",variant:"success"}),Se(!1),Ae(null)}catch(t){o({title:"Failed to send list",description:t?.response?.data?.message||"Please try again",variant:"error"})}},[o,i.id,W,d.slug]),aa=n.useCallback(async()=>{const t=D.filter(a=>a.id.trim()&&a.text.trim());if(t.length===0){o({title:"Buttons needed",description:"Please add at least one button.",variant:"warning"});return}if(!Y.trim()){o({title:"Body text needed",description:"Please enter body text.",variant:"warning"});return}try{await I.post(route("app.whatsapp.conversations.send-buttons",{conversation:i.id}),{body_text:Y,buttons:t,header_text:xe||null,footer_text:ue||null}),o({title:"Interactive buttons sent",variant:"success"}),ge(!1),Z([{id:"",text:""}]),Te(""),Me(""),De("")}catch(a){o({title:"Failed to send buttons",description:a?.response?.data?.message||"Please try again",variant:"error"})}},[o,i.id,D,Y,xe,ue,d.slug]),sa=()=>{if(D.length>=3){o({title:"Maximum 3 buttons allowed",variant:"warning"});return}Z([...D,{id:"",text:""}])},ra=t=>{const a=[...D];a.splice(t,1),a.length===0&&a.push({id:"",text:""}),Z(a)},ft=(t,a,s)=>{const r=[...D];r[t]={...r[t],[a]:s},Z(r)},na=n.useCallback(async()=>{const{label:t,lat:a,lng:s}=ee;if(!a||!s){o({title:"Location needed",description:"Add latitude and longitude.",variant:"warning"});return}try{await I.post(route("app.whatsapp.conversations.send-location",{conversation:i.id}),{latitude:Number(a),longitude:Number(s),name:t||null,address:null}),o({title:"Location sent",variant:"success"}),Ce(!1),me({label:"",lat:"",lng:""})}catch(r){o({title:"Failed to send location",description:r?.response?.data?.message||"Please try again",variant:"error"})}},[o,i.id,ee,d.slug]),vt=n.useCallback(async t=>{if(L.length!==0){for(let a=0;a<L.length;a+=1){const s=L[a],r=s.type.startsWith("image/")?"image":s.type.startsWith("video/")?"video":"document",u=new FormData;u.append("type",r),u.append("attachment",s),t&&a===0&&u.append("caption",t);try{await I.post(route("app.whatsapp.conversations.send-media",{conversation:i.id}),u,{headers:{"Content-Type":"multipart/form-data"}})}catch(P){o({title:"Failed to send attachment",description:P?.response?.data?.message||"Please try again",variant:"error"});return}}o({title:"Attachments sent",variant:"success"}),Le([])}},[o,L,i.id,d.slug]),ia=n.useCallback(async()=>{if(x)try{await I.post(route("app.whatsapp.conversations.send-template",{conversation:i.id}),{template_id:x.id,variables:E}),o({title:"Template sent",variant:"success"}),Ee(null),G([]),_e(!1)}catch(t){o({title:"Failed to send template",description:t?.response?.data?.message||"Please try again",variant:"error"})}},[o,i.id,x,E,d.slug]),be=n.useCallback(()=>{const t=Pe.current;if(!t)return;const a=t.scrollHeight-t.scrollTop-t.clientHeight<150;Gt(a)},[]);n.useEffect(()=>{const t=Pe.current;if(t)return t.addEventListener("scroll",be),be(),()=>t.removeEventListener("scroll",be)},[be]),n.useEffect(()=>{ot&&H.length>0&&setTimeout(()=>{dt.current?.scrollIntoView({behavior:"smooth"})},100)},[H,ot]);const He=n.useCallback(async()=>{if(!(!d?.id||!i?.id)){K(!0);try{const t=await I.get(route("app.whatsapp.inbox.conversation.stream",{conversation:i.id}),{params:{after_message_id:0,after_note_id:Math.max(0,N.current||0),after_audit_id:Math.max(0,B.current||0)}}),a=q(t.data?.new_messages).map(ve).filter(s=>s!==null);if(a.length>0){z(s=>s.length>0?je(s,a):a),C.current=Math.max(C.current,T(a));for(const s of a){ae.current.add(s.id);const r=s.updated_at??s.created_at;(!j.current||new Date(r).getTime()>new Date(j.current).getTime())&&(j.current=r)}}}catch(t){console.error("[Conversation] History recovery failed:",t)}finally{J.current=!0,K(!1)}}},[d?.id,i?.id]);n.useEffect(()=>{i?.id&&(H.length>0||$<=0||J.current||(J.current=!0,He()))},[i?.id,H.length,$,He]),n.useEffect(()=>{if(!d?.id||!i?.id)return;const t=`account.${d.id}.whatsapp.conversation.${i.id}`,a=V(t,".whatsapp.message.created",c=>{const l=ve(c?.message);l&&!ae.current.has(l.id)&&(ae.current.add(l.id),z(g=>je(g,[l])),C.current=Math.max(C.current,l.id),j.current=l.updated_at??l.created_at,l.direction==="inbound"&&o({title:"New message",description:l.text_body?.substring(0,50)||"New message received",variant:"info",duration:3e3}))}),s=V(t,".whatsapp.message.updated",c=>{const l=Number(c?.message?.id);if(!Number.isInteger(l)||l<1)return;const g=c?.message?.updated_at??new Date().toISOString();j.current=g,z(A=>A.map(m=>m.id===l?{...m,status:c.message.status??m.status,updated_at:g,sent_at:c.message.sent_at??m.sent_at,delivered_at:c.message.delivered_at??m.delivered_at,read_at:c.message.read_at??m.read_at}:m))}),r=V(t,".whatsapp.conversation.updated",c=>{c.conversation&&(oe(l=>({...l,status:c.conversation.status??l.status,assigned_to:c.conversation.assignee_id??l.assigned_to,priority:c.conversation.priority??l.priority})),v&&Xe&&c.conversation.assignee_id===v&&pe.current!==v&&(o({title:"Conversation assigned",description:"This chat was assigned to you.",variant:"info",duration:3e3}),$e()),pe.current=c.conversation.assignee_id??pe.current)}),u=V(t,".whatsapp.note.added",c=>{c.note&&(te(l=>[c.note,...l]),N.current=Math.max(N.current,c.note.id),bt(c.note.note||"",c.note.created_by?.id)&&(o({title:"You were mentioned",description:c.note.note?.slice(0,80)||"A note mentioned you.",variant:"info",duration:4e3}),$e()))}),P=V(t,".whatsapp.audit.added",c=>{if(c.audit_event){he(m=>[c.audit_event,...m]),B.current=Math.max(B.current,c.audit_event.id);const l=c.audit_event,g=l.event_type==="assigned"||l.event_type==="auto_assigned",A=l.meta?.assigned_to!=null&&l.meta.assigned_to!==v;g&&l.description&&A&&o({title:l.event_type==="auto_assigned"?"Chat auto-assigned":"Assignment updated",description:l.description,variant:"info",duration:4e3})}});return()=>{a(),s(),r(),u(),P()}},[d?.id,i?.id,V,o,v,Xe,bt,$e]),n.useEffect(()=>{if(!d?.id||!i?.id){lt&&(clearInterval(lt),ct(null));return}const t=async()=>{try{const r=await I.get(route("app.whatsapp.inbox.conversation.stream",{conversation:i.id}),{params:{after_message_id:Math.max(0,C.current||0),after_updated_at:j.current||void 0,after_note_id:Math.max(0,N.current||0),after_audit_id:Math.max(0,B.current||0)}}),u=q(r.data?.new_messages).map(ve).filter(g=>g!==null),P=q(r.data?.updated_messages),c=q(r.data?.new_notes),l=q(r.data?.new_audit_events);if(u.length>0){z(g=>je(g,u)),J.current=!0,C.current=Math.max(T(u),C.current);for(const g of u){ae.current.add(g.id);const A=g.updated_at??g.created_at;(!j.current||new Date(A).getTime()>new Date(j.current).getTime())&&(j.current=A)}}if(P.length>0){z(A=>A.map(m=>{const Q=P.find(xa=>Number(xa.id)===m.id);return Q?{...m,status:Q.status??m.status,updated_at:Q.updated_at??m.updated_at,sent_at:Q.sent_at??m.sent_at,delivered_at:Q.delivered_at??m.delivered_at,read_at:Q.read_at??m.read_at}:m}));const g=P.map(A=>A?.updated_at).filter(Boolean).sort().pop();g&&(j.current=g)}c.length>0&&(te(g=>[...c.slice().reverse(),...g]),N.current=Math.max(T(c),N.current)),l.length>0&&(he(g=>[...l.slice().reverse(),...g]),B.current=Math.max(T(l),B.current)),r.data.conversation&&oe(g=>({...g,...r.data.conversation})),r.data?.server_time&&(j.current=r.data.server_time),K(!1)}catch(r){console.error("[Conversation] Polling error:",r),K(!1)}},s=setInterval(t,de?12e3:7e3);return ct(s),t(),()=>{clearInterval(s)}},[de,d?.id,i?.id]);const ze=n.useCallback(async()=>{if(ne)return;const t=se.message.trim();if(L.length>0){await vt(t||void 0),Ue("message");return}t&&xt(route("app.whatsapp.conversations.send",{conversation:i.id}),{onSuccess:()=>{Ue("message"),o({title:"Message sent",variant:"success",duration:2e3})},onError:a=>{const s=Array.isArray(a?.message)?a.message[0]:a?.message,r=Array.isArray(a?.message_detail)?a.message_detail[0]:a?.message_detail,u=s==="outside_24h"||typeof s=="string"&&(s.includes("template")||s.includes("24 hour")||s.includes("recovery"));o({title:u?"Use a template to start the conversation":"Failed to send message",description:r||s||(u?"Send a template message using the template button above.":"Please try again"),variant:"error",duration:8e3}),u&&setTimeout(()=>{document.querySelector("[data-template-section]")?.scrollIntoView({behavior:"smooth",block:"nearest"})},300)}})},[ne,se.message,L.length,vt,xt,d.slug,i.id,Ue,o]),da=async()=>{const t=rt.trim();if(t)try{const a=await I.post(route("app.whatsapp.conversations.notes.store",{conversation:i.id}),{note:t});a.data?.note&&(te(s=>[a.data.note,...s]),N.current=Math.max(N.current,a.data.note.id)),nt(""),o({title:"Note added",variant:"success"})}catch(a){o({title:"Failed to add note",description:a?.response?.data?.message||"Please try again",variant:"error"})}},ye=n.useCallback(t=>{O||(it(!0),ma.post(route("app.whatsapp.conversations.update",{conversation:i.id}),t,{preserveScroll:!0,preserveState:!0,onSuccess:()=>{oe(a=>({...a,...t})),o({title:"Conversation updated",variant:"success",duration:2e3})},onError:a=>{o({title:"Update failed",description:a?.assigned_to||a?.status||a?.priority||"Please try again.",variant:"error"})},onFinish:()=>{it(!1)}}))},[o,i.id,O]),oa=n.useCallback(()=>{!Ne||ce||(tt(!0),I.post(route("app.whatsapp.conversations.ai-suggest",{conversation:i.id})).then(t=>{const a=t.data?.suggestion;typeof a=="string"&&a.trim()&&(re("message",a.trim()),o({title:"AI suggestion added",description:"Edit or send as is.",variant:"info",duration:2e3}))}).catch(t=>{const a=t?.response?.data?.error||t?.message||"AI suggestion failed.";o({title:"AI suggestion failed",description:a,variant:"error"})}).finally(()=>tt(!1)))},[Ne,ce,i.id,re,o]),la=t=>{t.preventDefault(),ze()};n.useEffect(()=>{const t=a=>{a.key==="Escape"&&X&&le(!1),(a.metaKey||a.ctrlKey)&&a.key==="Enter"&&(a.preventDefault(),ze()),(a.metaKey||a.ctrlKey)&&a.shiftKey&&(a.key.toLowerCase()==="e"&&(a.preventDefault(),et(s=>!s)),a.key.toLowerCase()==="k"&&(a.preventDefault(),ke(s=>!s)),a.key.toLowerCase()==="t"&&(a.preventDefault(),_e(s=>!s)))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[X,ze]);const ca=t=>{if(t.direction==="inbound")return null;switch(t.status){case"sent":return e.jsx(Ta,{className:"h-3.5 w-3.5 text-gray-400"});case"delivered":return e.jsx(St,{className:"h-3.5 w-3.5 text-gray-400"});case"read":return e.jsx(St,{className:"h-3.5 w-3.5 text-blue-500"});case"failed":return e.jsx("span",{className:"text-xs text-red-500 font-medium",children:"Failed"});default:return e.jsx(Aa,{className:"h-3.5 w-3.5 text-gray-400"})}},ga=t=>{const a=t.payload||{};if(t.type==="image"&&a.link)return e.jsxs("div",{className:"space-y-2",children:[e.jsx("img",{src:a.link,alt:"Image attachment",className:"max-h-48 rounded-lg border border-gray-200 object-cover"}),t.text_body&&e.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:t.text_body})]});if(t.type==="video"&&a.link)return e.jsxs("div",{className:"space-y-2",children:[e.jsx("video",{controls:!0,className:"max-h-48 rounded-lg border border-gray-200 w-full",children:e.jsx("source",{src:a.link})}),t.text_body&&e.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:t.text_body})]});if(t.type==="document"&&a.link)return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("a",{href:a.link,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-2 text-sm font-semibold text-emerald-700 hover:text-emerald-800",children:[e.jsx(_t,{className:"h-4 w-4"}),a.filename||"Document"]}),t.text_body&&e.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:t.text_body})]});if(t.type==="location"&&a.latitude&&a.longitude){const s=`https://maps.google.com/?q=${a.latitude},${a.longitude}`;return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("a",{href:s,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-2 text-sm font-semibold text-emerald-700 hover:text-emerald-800",children:[e.jsx(kt,{className:"h-4 w-4"}),"View location"]}),a.name&&e.jsx("p",{className:"text-sm text-gray-700",children:a.name}),a.address&&e.jsx("p",{className:"text-xs text-gray-500",children:a.address})]})}return t.text_body?e.jsx("p",{className:"text-sm whitespace-pre-wrap break-words leading-relaxed",children:t.text_body}):null};return e.jsxs(Ct,{children:[e.jsx(wt,{title:`${i.contact.name||i.contact.wa_id} - Inbox`}),e.jsxs("div",{className:"flex flex-col h-[calc(100vh-8rem)] lg:h-[calc(100vh-6rem)] rounded-3xl overflow-hidden border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-[#075E54] text-white",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsxs(Oe,{href:route("app.whatsapp.conversations.index",{}),className:"inline-flex items-center text-sm font-medium text-white/90 hover:text-white transition-colors","aria-label":"Back to conversations",children:[e.jsx(ha,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Back"})]}),e.jsx("div",{className:"h-10 w-10 rounded-full bg-[#25D366] flex items-center justify-center text-white font-bold text-lg shadow-lg flex-shrink-0",children:i.contact.name?.charAt(0).toUpperCase()||i.contact.wa_id.charAt(0)}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-base sm:text-lg font-semibold truncate",children:i.contact.name||i.contact.wa_id}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-white/80",children:[e.jsx(pa,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate",children:i.contact.wa_id}),e.jsx("span",{className:"text-white/60",children:"â€¢"}),e.jsx("span",{className:"truncate",children:i.connection.name}),!de&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-white/60",children:"â€¢"}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(ba,{className:"h-3 w-3 text-amber-200"}),"Polling"]})]}),de&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(ya,{className:"h-3 w-3 text-green-200"}),"Live"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"hidden sm:inline-flex rounded-full bg-white/15 px-3 py-1 text-xs uppercase tracking-wide",children:i.status}),e.jsx("button",{onClick:()=>le(!X),className:"lg:hidden p-2 rounded-lg text-white/90 hover:bg-white/10 transition-colors","aria-label":"Toggle menu",children:X?e.jsx(fe,{className:"h-5 w-5"}):e.jsx(fa,{className:"h-5 w-5"})})]})]}),X&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-40 lg:hidden",onClick:()=>le(!1),"aria-hidden":"true"}),e.jsxs("div",{className:"fixed right-0 top-0 h-full w-80 bg-white dark:bg-gray-900 shadow-2xl z-50 lg:hidden p-6 border-l border-gray-200 dark:border-gray-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:"Conversation Info"}),e.jsx("button",{onClick:()=>le(!1),className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800","aria-label":"Close conversation info",children:e.jsx(fe,{className:"h-5 w-5","aria-hidden":!0})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"p-4 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-xl border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-lg shadow-lg",children:i.contact.name?.charAt(0).toUpperCase()||i.contact.wa_id.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:i.contact.name||"Unknown"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:i.contact.wa_id})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2",children:"Connection"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:i.connection.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2",children:"Status"}),e.jsx(Tt,{variant:i.status==="open"?"success":"default",className:"px-3 py-1",children:i.status})]})]})]})]})]}),e.jsxs("div",{className:"flex flex-1 min-h-0 overflow-hidden",children:[e.jsxs("div",{ref:Pe,className:"flex-1 min-h-0 overflow-y-auto overflow-x-hidden px-4 py-6 space-y-4 bg-[#efeae2] dark:bg-gray-950 focus:outline-none",style:{backgroundImage:"radial-gradient(rgba(0,0,0,0.04) 1px, transparent 1px)",backgroundSize:"16px 16px"},tabIndex:0,children:[$t?e.jsx(e.Fragment,{children:[...Array(3)].map((t,a)=>e.jsx(Da,{},a))}):H.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-white/80 dark:bg-gray-900 mb-4 shadow-sm",children:e.jsx(Nt,{className:"h-8 w-8 text-gray-400"})}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 font-medium mb-1",children:"No messages yet"}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:$>0?"History did not load yet.":"Start the conversation!"}),$>0&&e.jsx("div",{className:"mt-3",children:e.jsx(y,{type:"button",variant:"secondary",onClick:He,children:"Retry Loading History"})})]}):H.map((t,a)=>{const s=a===0||new Date(t.created_at).toDateString()!==new Date(H[a-1].created_at).toDateString();return e.jsxs("div",{children:[s&&e.jsx("div",{className:"flex items-center justify-center my-4",children:e.jsx("div",{className:"px-3 py-1 bg-gray-100 dark:bg-gray-800 rounded-full text-xs font-medium text-gray-600 dark:text-gray-400",children:new Date(t.created_at).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})}),e.jsx("div",{className:ie("flex",t.direction==="outbound"?"justify-end":"justify-start"),children:e.jsxs("div",{className:ie("max-w-xs lg:max-w-md px-4 py-2.5 rounded-2xl shadow-sm",t.direction==="outbound"?"bg-[#d9fdd3] text-gray-900 rounded-tr-md":"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border border-gray-200 dark:border-gray-700 rounded-tl-md"),children:[ga(t),e.jsxs("div",{className:"flex items-center justify-end gap-1.5 mt-2",children:[e.jsx("span",{className:ie("text-[11px]",t.direction==="outbound"?"text-gray-600":"text-gray-500 dark:text-gray-400"),children:new Date(t.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),ca(t)]})]})})]},t.id)}),e.jsx("div",{ref:dt})]}),e.jsxs("aside",{className:"hidden lg:flex lg:w-80 xl:w-96 flex-col border-l border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-lg shadow-lg",children:i.contact.name?.charAt(0).toUpperCase()||i.contact.wa_id.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:i.contact.name||"Unknown"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:i.contact.wa_id})]})]}),e.jsxs("div",{className:"mt-4 space-y-2 text-sm text-gray-600 dark:text-gray-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wider text-gray-500",children:"Connection"}),e.jsx("span",{className:"font-medium",children:i.connection.name})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wider text-gray-500",children:"Status"}),e.jsx(Tt,{variant:i.status==="open"?"success":"default",className:"px-3 py-1",children:i.status})]})]})]}),e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"Assignment & Priority"}),O&&e.jsx("span",{className:"text-xs text-gray-400",children:"Savingâ€¦"})]}),e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wider text-gray-500",children:"Assignee"}),e.jsxs("select",{value:i.assigned_to??"",onChange:t=>{const a=t.target.value?Number(t.target.value):null;ye({assigned_to:a})},disabled:O,className:"mt-1 block w-full rounded-xl border-gray-200 bg-white px-3 py-2 text-sm shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:border-gray-700 dark:bg-gray-800",children:[e.jsx("option",{value:"",children:"Unassigned"}),we.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.role,")"]},t.id))]}),i.assigned_to&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Assigned to ",Qt.get(i.assigned_to)?.name||"Unknown"]}),v&&i.assigned_to!==v&&we.some(t=>t.id===v)&&e.jsx("button",{type:"button",onClick:()=>ye({assigned_to:v}),disabled:O,className:"mt-2 text-xs font-medium text-[#25D366] hover:text-[#20BD5A] dark:text-[#34C759] disabled:opacity-50",children:"Assign to me"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wider text-gray-500",children:"Priority"}),e.jsxs("select",{value:i.priority??"",onChange:t=>{const a=t.target.value||null;ye({priority:a})},disabled:O,className:"mt-1 block w-full rounded-xl border-gray-200 bg-white px-3 py-2 text-sm shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:border-gray-700 dark:bg-gray-800",children:[e.jsx("option",{value:"",children:"Not set"}),e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wider text-gray-500",children:"Status"}),e.jsxs("select",{value:i.status,onChange:t=>ye({status:t.target.value}),disabled:O,className:"mt-1 block w-full rounded-xl border-gray-200 bg-white px-3 py-2 text-sm shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:border-gray-700 dark:bg-gray-800",children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"closed",children:"Closed"})]})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-gray-50 p-3 text-xs text-gray-600 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:[e.jsx("div",{className:"font-semibold text-gray-700 dark:text-gray-200",children:"Auto-assign"}),e.jsx("div",{className:"mt-1",children:Ge?.auto_assign_enabled?`Enabled (${Ge.auto_assign_strategy.replace("_"," ")})`:"Disabled"}),e.jsx(Oe,{href:route("app.settings",{}),className:"mt-2 inline-flex text-xs font-semibold text-blue-600 hover:text-blue-700 dark:text-blue-400",children:"Manage inbox settings"})]})]})]}),e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"Internal Notes"}),e.jsx("span",{className:"text-xs text-gray-500",children:Ie.length})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(At,{value:rt,onChange:t=>nt(t.target.value),placeholder:"Add a private note...",className:"min-h-[80px] rounded-xl"}),e.jsx(y,{type:"button",onClick:da,className:"w-full bg-[#25D366] hover:bg-[#1DAA57] text-white",children:"Add Note"})]}),e.jsxs("div",{className:"mt-4 space-y-3",children:[Ie.length===0&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"No notes yet."}),Ie.map(t=>e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 p-3",children:[e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-200 whitespace-pre-wrap",children:t.note}),e.jsxs("div",{className:"mt-2 text-[11px] text-gray-500 dark:text-gray-400",children:[t.created_by?.name||"System"," â€¢ ",new Date(t.created_at).toLocaleString()]})]},t.id))]})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"Audit Events"}),e.jsx("span",{className:"text-xs text-gray-500",children:Re.length})]}),e.jsxs("div",{className:"space-y-3",children:[Re.length===0&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"No audit events yet."}),Re.map(t=>e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-3",children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wider text-gray-500",children:t.event_type.replaceAll("_"," ")}),t.description&&e.jsx("p",{className:"mt-1 text-sm text-gray-700 dark:text-gray-200",children:t.description}),e.jsxs("div",{className:"mt-2 text-[11px] text-gray-500 dark:text-gray-400",children:[t.actor?.name||"System"," â€¢ ",new Date(t.created_at).toLocaleString()]})]},t.id))]})]})]})]}),e.jsxs("div",{className:"flex-shrink-0 border-t border-gray-200 dark:border-gray-800 bg-[#f0f2f5] dark:bg-gray-900 p-3 sticky bottom-0",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>et(t=>!t),className:"inline-flex items-center gap-2 rounded-full border border-gray-200 bg-white px-3 py-1.5 text-xs font-semibold text-gray-600 shadow-sm hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:[e.jsx(va,{className:"h-3.5 w-3.5"}),"Emoji"]}),e.jsxs("button",{type:"button",onClick:()=>Fe.current?.click(),className:"inline-flex items-center gap-2 rounded-full border border-gray-200 bg-white px-3 py-1.5 text-xs font-semibold text-gray-600 shadow-sm hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:[e.jsx(ja,{className:"h-3.5 w-3.5"}),"Attach"]}),e.jsxs("button",{type:"button",onClick:()=>Fe.current?.click(),className:"inline-flex items-center gap-2 rounded-full border border-gray-200 bg-white px-3 py-1.5 text-xs font-semibold text-gray-600 shadow-sm hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:[e.jsx(wa,{className:"h-3.5 w-3.5"}),"Photo/Video"]}),e.jsxs("button",{type:"button",onClick:()=>Ce(t=>!t),className:"inline-flex items-center gap-2 rounded-full border border-gray-200 bg-white px-3 py-1.5 text-xs font-semibold text-gray-600 shadow-sm hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:[e.jsx(kt,{className:"h-3.5 w-3.5"}),"Location"]}),e.jsxs("button",{type:"button","data-template-section":!0,onClick:()=>_e(t=>!t),className:"inline-flex items-center gap-2 rounded-full border border-gray-200 bg-white px-3 py-1.5 text-xs font-semibold text-gray-600 shadow-sm hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300","aria-label":"Send template message",children:[e.jsx(_t,{className:"h-3.5 w-3.5"}),"Templates"]}),e.jsxs("button",{type:"button",onClick:()=>{Se(t=>!t),ge(!1)},className:"inline-flex items-center gap-2 rounded-full border border-gray-200 bg-white px-3 py-1.5 text-xs font-semibold text-gray-600 shadow-sm hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:[e.jsx(Na,{className:"h-3.5 w-3.5"}),"Lists"]}),e.jsxs("button",{type:"button",onClick:()=>{ge(t=>!t),Se(!1)},className:"inline-flex items-center gap-2 rounded-full border border-gray-200 bg-white px-3 py-1.5 text-xs font-semibold text-gray-600 shadow-sm hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:[e.jsx(ka,{className:"h-3.5 w-3.5"}),"Buttons"]}),e.jsxs("button",{type:"button",onClick:()=>ke(t=>!t),className:"inline-flex items-center gap-2 rounded-full border border-gray-200 bg-white px-3 py-1.5 text-xs font-semibold text-gray-600 shadow-sm hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:[e.jsx(_a,{className:"h-3.5 w-3.5"}),"Quick Replies"]}),e.jsx("input",{ref:Fe,type:"file",multiple:!0,accept:"image/*,video/*,application/pdf",className:"hidden",onChange:Yt})]}),Ht&&e.jsxs("div",{className:"absolute bottom-full left-0 mb-3 z-20 flex flex-wrap items-center gap-2 rounded-2xl border border-gray-200 bg-white/95 p-3 text-lg shadow-lg dark:border-gray-700 dark:bg-gray-800",children:[e.jsx("div",{className:"w-full",children:e.jsx(w,{value:Be,onChange:t=>Wt(t.target.value),placeholder:"Search emojis",className:"rounded-xl text-sm"})}),at.length>0&&e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"mb-2 text-[11px] font-semibold uppercase tracking-wide text-gray-500",children:"Recent"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:at.map(t=>e.jsx("button",{type:"button",onClick:()=>yt(t),className:"rounded-lg px-2 py-1 hover:bg-gray-100 dark:hover:bg-gray-700",children:t},`recent-${t}`))})]}),(Be.trim()?mt.filter(t=>t.includes(Be.trim())):mt).map(t=>e.jsx("button",{type:"button",onClick:()=>yt(t),className:"rounded-lg px-2 py-1 hover:bg-gray-100 dark:hover:bg-gray-700",children:t},t))]})]}),Kt&&e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-gray-800",children:[e.jsxs("div",{className:"grid gap-3 sm:grid-cols-3",children:[e.jsx(w,{value:ee.label,onChange:t=>me(a=>({...a,label:t.target.value})),placeholder:"Label (optional)",className:"rounded-xl"}),e.jsx(w,{value:ee.lat,onChange:t=>me(a=>({...a,lat:t.target.value})),placeholder:"Latitude",className:"rounded-xl"}),e.jsx(w,{value:ee.lng,onChange:t=>me(a=>({...a,lng:t.target.value})),placeholder:"Longitude",className:"rounded-xl"})]}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx(y,{type:"button",variant:"secondary",onClick:()=>Ce(!1),children:"Cancel"}),e.jsx(y,{type:"button",onClick:na,className:"bg-[#25D366] hover:bg-[#1DAA57] text-white",children:"Send Location"})]})]}),zt&&e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-gray-800",children:e.jsx("div",{className:"grid gap-2",children:Jt.map(t=>e.jsxs("button",{type:"button",onClick:()=>{Zt(t.text),ke(!1)},className:"w-full rounded-xl border border-gray-200 px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:text-gray-200 dark:hover:bg-gray-700",children:[e.jsx("p",{className:"font-semibold",children:t.label}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.text})]},t.id))})}),Ot&&e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-gray-800","data-template-section":!0,children:[e.jsxs("div",{className:"grid gap-3",children:[ht.length===0&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No approved templates found for this connection."}),ht.map(t=>e.jsxs("button",{type:"button",onClick:()=>{Ee(t),G(Array.from({length:t.variable_count||0},()=>""))},className:ie("w-full rounded-xl border px-3 py-2 text-left text-sm hover:bg-gray-50 dark:hover:bg-gray-700",x?.id===t.id?"border-emerald-400 bg-emerald-50/70 text-emerald-900 dark:border-emerald-500/70 dark:bg-emerald-500/10 dark:text-emerald-100":"border-gray-200 text-gray-700 dark:border-gray-700 dark:text-gray-200"),children:[e.jsx("p",{className:"font-semibold",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.body_text||"Template message"})]},t.id))]}),x&&e.jsxs("div",{className:"mt-4 rounded-xl border border-gray-200 bg-gray-50 p-3 dark:border-gray-700 dark:bg-gray-900",children:[e.jsx("div",{className:"mb-3 text-sm font-semibold text-gray-700 dark:text-gray-200",children:"Fill template variables"}),E.length===0&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"This template has no variables."}),e.jsxs("div",{className:"grid gap-4",children:[x.header_count>0&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Header variables"}),E.slice(0,x.header_count).map((t,a)=>e.jsx(w,{value:t,onChange:s=>{const r=[...E];r[a]=s.target.value,G(r)},placeholder:`Header variable ${a+1}`,className:"rounded-xl"},`${x.id}-header-${a}`))]}),x.body_count>0&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Body variables"}),E.slice(x.header_count,x.header_count+x.body_count).map((t,a)=>e.jsx(w,{value:t,onChange:s=>{const r=[...E];r[x.header_count+a]=s.target.value,G(r)},placeholder:`Body variable ${a+1}`,className:"rounded-xl"},`${x.id}-body-${a}`))]}),x.button_count>0&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Button variables"}),E.slice(x.header_count+x.body_count,x.variable_count).map((t,a)=>e.jsx(w,{value:t,onChange:s=>{const r=[...E];r[x.header_count+x.body_count+a]=s.target.value,G(r)},placeholder:`Button variable ${a+1}`,className:"rounded-xl"},`${x.id}-button-${a}`))]})]}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx(y,{type:"button",variant:"secondary",onClick:()=>{Ee(null),G([])},children:"Clear"}),e.jsx(y,{type:"button",onClick:ia,className:"bg-[#25D366] hover:bg-[#1DAA57] text-white",children:"Send Template"})]})]})]}),qt&&e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-gray-800",children:[e.jsxs("div",{className:"grid gap-3",children:[Qe.length===0&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["No lists available."," ",e.jsx(Oe,{href:route("app.whatsapp.lists.index"),className:"font-medium text-emerald-600 hover:text-emerald-500 dark:text-emerald-400 dark:hover:text-emerald-300",children:"Create lists in the Lists section"}),"."]}),Qe.map(t=>e.jsxs("button",{type:"button",onClick:()=>Ae(t),className:ie("w-full rounded-xl border px-3 py-2 text-left text-sm hover:bg-gray-50 dark:hover:bg-gray-700",W?.id===t.id?"border-emerald-400 bg-emerald-50/70 text-emerald-900 dark:border-emerald-500/70 dark:bg-emerald-500/10 dark:text-emerald-100":"border-gray-200 text-gray-700 dark:border-gray-700 dark:text-gray-200"),children:[e.jsx("p",{className:"font-semibold",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.description||t.button_text})]},t.id))]}),W&&e.jsxs("div",{className:"mt-4 rounded-xl border border-gray-200 bg-gray-50 p-3 dark:border-gray-700 dark:bg-gray-900",children:[e.jsxs("div",{className:"mb-3 text-sm font-semibold text-gray-700 dark:text-gray-200",children:["Selected List: ",W.name]}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx(y,{type:"button",variant:"secondary",onClick:()=>{Ae(null)},children:"Clear"}),e.jsx(y,{type:"button",onClick:ta,className:"bg-[#25D366] hover:bg-[#1DAA57] text-white",children:"Send List"})]})]})]}),Vt&&e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-gray-800",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-gray-700 dark:text-gray-300 mb-2 block",children:"Body Text * (Max 1024 chars)"}),e.jsx(At,{value:Y,onChange:t=>Te(t.target.value),placeholder:"Enter message body text",maxLength:1024,rows:3,className:"rounded-xl"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[Y.length,"/1024 characters"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-gray-700 dark:text-gray-300 mb-2 block",children:"Header Text (Optional, Max 60 chars)"}),e.jsx(w,{value:xe,onChange:t=>Me(t.target.value),placeholder:"Optional header text",maxLength:60,className:"rounded-xl"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[xe.length,"/60 characters"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-gray-700 dark:text-gray-300 mb-2 block",children:"Footer Text (Optional, Max 60 chars)"}),e.jsx(w,{value:ue,onChange:t=>De(t.target.value),placeholder:"Optional footer text",maxLength:60,className:"rounded-xl"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[ue.length,"/60 characters"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-700 dark:text-gray-300",children:"Buttons (Max 3)"}),D.length<3&&e.jsxs(y,{type:"button",onClick:sa,variant:"secondary",size:"sm",children:[e.jsx(Sa,{className:"h-3 w-3 mr-1"}),"Add Button"]})]}),e.jsx("div",{className:"space-y-2",children:D.map((t,a)=>e.jsxs("div",{className:"flex items-center gap-2 border border-gray-200 dark:border-gray-700 rounded-lg p-2",children:[e.jsx(w,{value:t.id,onChange:s=>ft(a,"id",s.target.value),placeholder:"Button ID (unique)",maxLength:256,className:"flex-1 text-sm rounded-lg"}),e.jsx(w,{value:t.text,onChange:s=>ft(a,"text",s.target.value),placeholder:"Button text (max 20)",maxLength:20,className:"flex-1 text-sm rounded-lg"}),D.length>1&&e.jsx(y,{type:"button",onClick:()=>ra(a),variant:"ghost",size:"sm",children:e.jsx(fe,{className:"h-3 w-3 text-red-500"})})]},a))})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx(y,{type:"button",variant:"secondary",onClick:()=>{ge(!1),Z([{id:"",text:""}]),Te(""),Me(""),De("")},children:"Cancel"}),e.jsx(y,{type:"button",onClick:aa,className:"bg-[#25D366] hover:bg-[#1DAA57] text-white",children:"Send Buttons"})]})]})}),L.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:L.map((t,a)=>e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-white px-3 py-1 text-xs text-gray-600 shadow-sm dark:bg-gray-800 dark:text-gray-300",children:[e.jsx("span",{className:"truncate max-w-[160px]",children:t.name}),e.jsx("button",{type:"button",onClick:()=>ea(a),className:"text-gray-400 hover:text-gray-600","aria-label":`Remove ${t.name}`,children:e.jsx(fe,{className:"h-3.5 w-3.5","aria-hidden":!0})})]},`${t.name}-${a}`))}),e.jsxs("form",{onSubmit:la,className:"flex items-center gap-3",children:[e.jsx(w,{value:se.message,onChange:t=>re("message",t.target.value),placeholder:"Type a message",className:"flex-1 rounded-full bg-white dark:bg-gray-800",disabled:ne,autoFocus:!0,"aria-label":"Message input"}),Ne&&e.jsx(y,{type:"button",onClick:oa,disabled:ne||ce,"aria-label":"Get AI reply suggestion",title:"Suggest reply with AI",variant:"secondary",className:"shrink-0 rounded-full px-3 py-2.5 border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-800",children:ce?e.jsx("span",{className:"inline-block h-4 w-4 animate-spin rounded-full border-2 border-gray-400 border-t-transparent","aria-hidden":!0}):e.jsx(Ca,{className:"h-4 w-4 text-amber-500"})}),e.jsx(y,{type:"submit",disabled:ne||!se.message.trim()&&L.length===0,"aria-label":"Send message",className:"bg-[#25D366] hover:bg-[#1DAA57] text-white rounded-full px-5",children:e.jsx(Nt,{className:"h-4 w-4"})})]})]}),ut.message&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-2",role:"alert",children:ut.message})]})]})]})}export{Ga as default};
