import{r as n,j as e}from"./react-BhzSerM2.js";import{G as k,H as v,l as _}from"./vendor-DxGhd0kb.js";import{A as N}from"./AppShell-CbiYKKs1.js";import{C as w,b as S,c as C,d as D,a as $}from"./Card-BkWrHWVN.js";import{a as E,B as c}from"./app-NZCbGewm.js";import"./Topbar-a6Jf_b6K.js";import"./Badge-7KrgCsFM.js";import"./GlobalFlashHandler-xHP6pVTU.js";import"./useToast-m6H8bvjE.js";import"./BrandingWrapper-DK418oSm.js";import"./Alert-CGcVTa3U.js";import"./CookieConsentBanner-BZbYMIzh.js";/* empty css            */const A=t=>t.mime_type?t.mime_type.startsWith("image/"):/\.(png|jpe?g|gif|webp|svg)$/i.test(t.file_name),F=t=>t.mime_type?t.mime_type==="application/pdf":/\.pdf$/i.test(t.file_name);function J({account:t,thread:r,messages:i}){const{data:d,setData:m,post:o,processing:p,reset:y}=k({message:"",attachments:[]}),{subscribe:u}=E(),[b,g]=n.useState(i);n.useEffect(()=>{g(i)},[i]),n.useEffect(()=>{const s=`account.${t.id}.support.thread.${r.id}`,a=u(s,"support.message.created",x=>{g(l=>l.some(h=>h.id===x.id)?l:[...l,x])});return()=>{a()}},[u,t.id,r.id]);const f=s=>{s.preventDefault(),o(route("app.support.message",{thread:r.slug??r.id}),{forceFormData:!0,onSuccess:()=>y()})},j=()=>{o(route("app.support.close",{thread:r.slug??r.id}))};return e.jsxs(N,{children:[e.jsx(v,{title:`Support - ${r.subject}`}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(_,{href:route("app.support.hub",{}),className:"inline-flex items-center gap-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors",children:"← Back to Support Hub"}),e.jsxs(w,{className:"border-0 shadow-lg",children:[e.jsxs(S,{className:"bg-gradient-to-r from-gray-50 to-white dark:from-gray-800 dark:to-gray-900",children:[e.jsx(C,{className:"text-xl font-bold",children:r.subject}),e.jsxs(D,{children:["Status: ",r.status]})]}),e.jsxs($,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid gap-2 text-xs text-gray-500 dark:text-gray-400 md:grid-cols-2",children:[e.jsxs("div",{children:["Category: ",r.category||"—"]}),e.jsxs("div",{children:["Tags: ",r.tags&&r.tags.length>0?r.tags.join(", "):"—"]}),e.jsxs("div",{children:["First response due:"," ",r.first_response_due_at?new Date(r.first_response_due_at).toLocaleString():"—"]}),e.jsxs("div",{children:["Resolution due: ",r.due_at?new Date(r.due_at).toLocaleString():"—"]}),e.jsxs("div",{children:["Escalation level: ",r.escalation_level??0]})]}),r.status==="closed"&&e.jsx("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 text-sm text-gray-700 dark:text-gray-200 px-4 py-3",children:"This chat is closed. You can start a new request anytime."}),e.jsx("div",{className:"space-y-3",children:b.map(s=>e.jsxs("div",{className:`rounded-lg px-4 py-3 ${s.sender_type==="admin"||s.sender_type==="bot"?"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800":s.sender_type==="system"?"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800":"bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700"}`,children:[e.jsx("div",{className:"text-xs uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-1",children:s.sender_type==="admin"?"Support":s.sender_type==="bot"?"Assistant":s.sender_type==="system"?"System":"You"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-gray-100 whitespace-pre-wrap",children:s.body}),s.attachments&&s.attachments.length>0&&e.jsx("div",{className:"mt-2 space-y-2",children:s.attachments.map(a=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("a",{href:a.url,target:"_blank",rel:"noreferrer",className:"block text-xs text-blue-600 dark:text-blue-300 hover:underline",children:a.file_name}),A(a)&&e.jsx("img",{src:a.url,alt:a.file_name,className:"max-h-40 rounded-md border border-gray-200 dark:border-gray-700"}),F(a)&&e.jsxs("details",{className:"text-xs text-gray-600 dark:text-gray-300",children:[e.jsx("summary",{className:"cursor-pointer",children:"Preview PDF"}),e.jsx("iframe",{src:a.url,className:"mt-2 h-48 w-full rounded-md border border-gray-200 dark:border-gray-700"})]})]},a.id))}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:new Date(s.created_at).toLocaleString()})]},s.id))}),e.jsxs("form",{onSubmit:f,className:"space-y-3",children:[e.jsx("textarea",{value:d.message,onChange:s=>m("message",s.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100",rows:4,placeholder:"Write your reply..."}),e.jsx("input",{type:"file",multiple:!0,onChange:s=>m("attachments",Array.from(s.target.files||[])),className:"block w-full text-sm text-gray-500 file:mr-4 file:rounded-md file:border-0 file:bg-gray-100 file:px-4 file:py-2 file:text-sm file:font-semibold file:text-gray-700 hover:file:bg-gray-200 dark:file:bg-gray-800 dark:file:text-gray-200 dark:hover:file:bg-gray-700"}),e.jsxs("div",{className:"flex justify-end",children:[r.status==="open"&&e.jsx(c,{type:"button",variant:"secondary",onClick:j,className:"mr-2",children:"Close Chat"}),r.status==="closed"&&e.jsx(c,{type:"button",variant:"secondary",onClick:()=>o(route("app.support.reopen",{thread:r.slug??r.id})),className:"mr-2",children:"Reopen Chat"}),e.jsx(c,{type:"submit",disabled:p||r.status==="closed"||d.message.trim().length===0&&d.attachments.length===0,children:p?"Sending...":"Send Message"})]})]})]})]})]})]})}export{J as default};
