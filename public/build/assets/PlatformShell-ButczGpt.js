import{r as s,j as e}from"./react-BhzSerM2.js";import{u as R,M as G,X as W,a as y,ar as H,aB as q,U as X,W as Z,n as J,F as B,a2 as K,ap as Q,A as V,D as M,aa as Y,l as D}from"./vendor-DxGhd0kb.js";import{T as ee}from"./Topbar-DS5R2nuh.js";import{B as re}from"./BrandingWrapper-DK418oSm.js";import{T as ae,G as te}from"./GlobalFlashHandler-xHP6pVTU.js";import{a as se,B as _,c as I}from"./app-CUdtZvAA.js";import{u as ne}from"./useToast-m6H8bvjE.js";const ie=n=>n.mime_type?n.mime_type.startsWith("image/"):/\.(png|jpe?g|gif|webp|svg)$/i.test(n.file_name),oe=n=>n.mime_type?n.mime_type==="application/pdf":/\.pdf$/i.test(n.file_name);function le(){const{branding:n,ai:f,supportSettings:b}=R().props,{subscribe:l}=se(),{addToast:j}=ne();if(!(b?.live_chat_enabled??!0))return null;const[o,m]=s.useState(!1),[d,p]=s.useState(!1),[a,i]=s.useState(null),[v,w]=s.useState([]),[c,T]=s.useState(null),[E,S]=s.useState([]),[h,C]=s.useState(""),[A,L]=s.useState([]),[P,z]=s.useState(!1),k=async()=>{const t=(await y.get(route("platform.support.live.list"),{headers:{Accept:"application/json"}})).data;w(t.threads||[]),(!c||!t.threads?.some(g=>g.slug===c))&&t.threads?.length&&T(t.threads[0].slug)},$=async r=>{p(!0);const g=(await y.get(route("platform.support.live.thread",{thread:r}),{headers:{Accept:"application/json"}})).data;i(g.thread),S(g.messages||[]),p(!1)};s.useEffect(()=>{if(!o)return;let r=!0;return p(!0),k().then(()=>{if(c)return $(c)}).finally(()=>{r&&p(!1)}),()=>{r=!1}},[o]),s.useEffect(()=>{!o||!c||$(c)},[c]),s.useEffect(()=>{if(!o)return;const r=l("platform.support","support.message.created",()=>{k()});return()=>r()},[o,l]),s.useEffect(()=>{if(!a?.account?.id)return;const r=`account.${a.account.id}.support.thread.${a.id}`,t=l(r,"support.message.created",g=>{S(u=>u.some(x=>x.id===g.id)?u:[...u,g])});return()=>{t()}},[l,a?.id,a?.account?.id]);const F=async()=>{if(!h.trim()&&A.length===0||!a?.id)return;const r=new FormData;h.trim()&&r.append("message",h.trim()),r.append("thread_id",String(a.id)),A.forEach(x=>r.append("attachments[]",x)),C(""),L([]);const u=(await y.post(route("platform.support.live.message"),r,{headers:{Accept:"application/json"}})).data.message;u&&S(x=>x.some(U=>U.id===u.id)?x:[...x,u]),k()},O=async()=>{if(a?.id){z(!0);try{const t=(await y.post(route("platform.support.assistant",{thread:a.slug??a.id}),{action:"reply"},{headers:{Accept:"application/json"}})).data?.suggestion;t&&C(t)}catch(r){j({title:"AI Assistant",description:r?.response?.data?.error||"AI assistant is disabled.",variant:"error"})}finally{z(!1)}}};return e.jsxs("div",{className:"fixed bottom-6 right-6 z-40",children:[!o&&e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-2 rounded-full bg-gray-900 text-white px-4 py-3 shadow-lg hover:bg-gray-800 transition",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-semibold",children:"Support Live"})]}),o&&e.jsxs("div",{className:"w-[28rem] max-w-[95vw] rounded-2xl bg-white dark:bg-gray-900 shadow-xl border border-gray-200 dark:border-gray-800 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-gradient-to-r from-gray-900 to-gray-700 text-white",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:"Support Inbox"}),e.jsx("div",{className:"text-xs opacity-80",children:a?.account?.name?`Account: ${a.account.name}`:"Live conversations"})]}),e.jsx("button",{onClick:()=>m(!1),className:"p-1 hover:opacity-80",children:e.jsx(W,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"px-4 py-3 text-xs text-gray-500 dark:text-gray-400 border-b border-gray-200 dark:border-gray-800",children:n?.support_email?`Primary support email: ${n.support_email}`:"Reply to keep the thread active."}),e.jsxs("div",{className:"grid grid-cols-5 gap-0",children:[e.jsxs("div",{className:"col-span-2 border-r border-gray-200 dark:border-gray-800 max-h-[26rem] overflow-y-auto",children:[v.length===0&&e.jsx("div",{className:"p-4 text-xs text-gray-500 dark:text-gray-400",children:"No active live chats."}),v.map(r=>e.jsxs("button",{onClick:()=>T(r.slug),className:`w-full text-left px-4 py-3 border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800/40 ${c===r.slug?"bg-gray-50 dark:bg-gray-800/60":""}`,children:[e.jsx("div",{className:"text-xs font-semibold text-gray-900 dark:text-gray-100",children:r.account?.name??"Account"}),e.jsx("div",{className:"text-[11px] text-gray-500 dark:text-gray-400 truncate",children:r.subject})]},r.id))]}),e.jsxs("div",{className:"col-span-3 flex flex-col",children:[e.jsxs("div",{className:"h-64 overflow-y-auto px-4 py-3 space-y-3",children:[d&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Loading latest conversation..."}),!d&&E.length===0&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"No messages yet. Open the support inbox for more details."}),a?.status==="closed"&&e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md px-3 py-2",children:"This chat is closed."}),E.map(r=>e.jsxs("div",{className:`rounded-lg px-3 py-2 text-xs leading-relaxed ${r.sender_type==="admin"?"bg-blue-50 dark:bg-blue-900/30 text-gray-900 dark:text-gray-100":"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100"}`,children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wider opacity-60 mb-1",children:r.sender_type==="admin"?"Support":"Tenant"}),r.body,r.attachments&&r.attachments.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:r.attachments.map(t=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("a",{href:t.url,target:"_blank",rel:"noreferrer",className:"block text-[11px] text-blue-600 dark:text-blue-300 hover:underline",children:t.file_name}),ie(t)&&e.jsx("img",{src:t.url,alt:t.file_name,className:"max-h-32 rounded-md border border-gray-200 dark:border-gray-700"}),oe(t)&&e.jsxs("details",{className:"text-[11px] text-gray-600 dark:text-gray-300",children:[e.jsx("summary",{className:"cursor-pointer",children:"Preview PDF"}),e.jsx("iframe",{src:t.url,className:"mt-2 h-36 w-full rounded-md border border-gray-200 dark:border-gray-700"})]})]},t.id))})]},r.id))]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-800 p-3 space-y-2",children:[e.jsx("textarea",{value:h,onChange:r=>C(r.target.value),rows:2,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100 text-sm",placeholder:"Reply to tenant..."}),e.jsx("input",{type:"file",multiple:!0,onChange:r=>L(Array.from(r.target.files||[])),className:"block w-full text-xs text-gray-500 file:mr-4 file:rounded-md file:border-0 file:bg-gray-100 file:px-3 file:py-1.5 file:text-xs file:font-semibold file:text-gray-700 hover:file:bg-gray-200 dark:file:bg-gray-800 dark:file:text-gray-200 dark:hover:file:bg-gray-700"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[f?.enabled&&e.jsx(_,{type:"button",variant:"secondary",onClick:O,disabled:P||!a,children:P?"Generating...":"AI Suggest"}),a?.status==="open"&&e.jsx(_,{type:"button",variant:"secondary",onClick:async()=>{a&&(await y.post(route("platform.support.close",{thread:a.slug??a.id})),i({...a,status:"closed"}),k())},children:"Close Chat"}),e.jsx(_,{type:"button",onClick:F,disabled:h.trim().length===0&&A.length===0||!a||a?.status==="closed",children:"Send"})]})]})]})]})]})]})}function fe({children:n,auth:f}){const{branding:b,ziggy:l}=R().props,j=b?.platform_name||"Platform",N=b?.logo_url,o=window.location.pathname,[m,d]=s.useState(!1);s.useEffect(()=>{d(!1)},[o]),s.useEffect(()=>{l&&(window.Ziggy=l)},[l]),s.useEffect(()=>{const i=()=>{window.innerWidth>=1024&&d(!1)};return window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]);const p=[{name:"Dashboard",href:route("platform.dashboard"),icon:H},{name:"Tenants",href:route("platform.accounts.index"),icon:q},{name:"Users",href:route("platform.users.index"),icon:X},{name:"Plans",href:route("platform.plans.index"),icon:Z},{name:"Modules",href:route("platform.modules.index"),icon:J},{name:"Subscriptions",href:route("platform.subscriptions.index"),icon:B},{name:"Analytics",href:route("platform.analytics"),icon:K},{name:"Templates",href:route("platform.templates.index"),icon:B},{name:"Support",href:route("platform.support.hub"),icon:Q},{name:"Activity Logs",href:route("platform.activity-logs"),icon:V},{name:"System Health",href:route("platform.system-health"),icon:M},{name:"Settings",href:route("platform.settings"),icon:Y}],a=e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between h-16 px-6 border-b border-gray-200 dark:border-gray-800",children:[N?e.jsx("img",{src:N,alt:j,className:"h-8 w-auto"}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"}),e.jsx("h1",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:j})]}),e.jsx("button",{onClick:()=>d(!1),className:"lg:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800",children:e.jsx(W,{className:"h-5 w-5 text-gray-700 dark:text-gray-300"})})]}),e.jsx("nav",{className:"flex-1 px-4 py-4 space-y-1",children:p.map(i=>{const v=i.icon,w=o.startsWith(i.href);return e.jsxs(D,{href:i.href,className:I("flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-colors",w?"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[e.jsx(v,{className:"h-5 w-5"}),i.name]},i.name)})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-800",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 truncate",children:f?.user?.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:f?.user?.email})]})}),e.jsx(D,{href:route("profile.edit"),className:"mt-2 block text-xs text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100",children:"Profile Settings"})]})]});return e.jsxs(re,{children:[e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-950",children:[m&&e.jsx("div",{className:"lg:hidden fixed inset-0 z-40 bg-black/50 transition-opacity",onClick:()=>d(!1)}),e.jsx("aside",{className:I("lg:hidden fixed inset-y-0 left-0 z-50 w-64 bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 transform transition-transform duration-300 ease-in-out",m?"translate-x-0":"-translate-x-full"),children:a}),e.jsx("aside",{className:"hidden lg:flex lg:flex-col lg:w-64 lg:fixed lg:inset-y-0 lg:z-30 bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800",children:a}),e.jsxs("div",{className:"lg:pl-64",children:[e.jsx(ee,{user:f?.user||null,onMenuClick:()=>d(!m)}),e.jsx("main",{className:"p-4 lg:p-6",children:n})]})]}),e.jsx(ae,{}),e.jsx(te,{}),e.jsx(le,{})]})}export{fe as P};
