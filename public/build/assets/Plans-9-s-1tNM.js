import{r as A,j as e}from"./react-BhzSerM2.js";import{H as X,T as S,q as K,$ as G,a0 as O,w as V,a1 as E,X as Z,k as N,a as $}from"./vendor-YQoUUhbX.js";import{A as J}from"./AppShell-A6sQ3pxr.js";import{C as F,b as Q,c as ee,d as re,a as I}from"./Card-CRSrZ5HZ.js";import{B as M}from"./Badge-C6d-QEGL.js";import{B as _}from"./app-DjsbE74r.js";import{u as te}from"./useToast-C37H2DkG.js";import{u as ae}from"./useNotifications-9W-smJed.js";import"./Topbar-D6SeU-QE.js";import"./GlobalFlashHandler-DjMhmIiM.js";import"./BrandingWrapper-Djq-D_tN.js";import"./Alert-u60ICsin.js";import"./CookieConsentBanner-C37xsP7H.js";/* empty css            */function ke({account:f,plans:l,current_plan_key:P,current_modules:se=[],razorpay_enabled:T=!1,razorpay_key_id:B=null}){const[z,c]=A.useState(null),[b,R]=A.useState("cards"),{addToast:d}=te(),{confirm:C}=ae(),w=T&&!!B,k=(r,t)=>{if(r===null)return"Custom Pricing";if(r===0)return"Free";const a=r/100;return new Intl.NumberFormat("en-IN",{style:"currency",currency:t,minimumFractionDigits:0}).format(a)},L=async r=>{const t=!P,a=l.find(n=>n.key===r),i=a?.trial_days??0;await C({title:t?"Select Plan":"Switch Plan",message:t?`Are you sure you want to select the ${a?.name??"this"} plan?${i>0?` You'll start with a ${i}-day free trial.`:""}`:"Are you sure you want to switch to this plan?",variant:"info"})&&(c(r),N.post(route("app.billing.switch-plan",{plan:r}),{},{onSuccess:()=>{d({title:t?"Plan selected successfully":"Plan changed successfully",description:t?"You can now use all features of the platform.":void 0,variant:"success"}),N.reload({only:["plans","current_plan_key"]})},onError:n=>{const j=n?.plan||n?.error||"Failed to change plan. Please try again.";d({title:t?"Failed to select plan":"Failed to change plan",description:j,variant:"error"})},onFinish:()=>c(null)}))},D=()=>new Promise((r,t)=>{if(typeof window<"u"&&window.Razorpay){r();return}const a=document.querySelector('script[src="https://checkout.razorpay.com/v1/checkout.js"]');if(a){a.addEventListener("load",()=>r()),a.addEventListener("error",()=>t(new Error("Failed to load Razorpay script")));return}const i=document.createElement("script");i.src="https://checkout.razorpay.com/v1/checkout.js",i.async=!0,i.crossOrigin="anonymous",i.onload=()=>{setTimeout(()=>{window.Razorpay?r():t(new Error("Razorpay failed to initialize"))},100)},i.onerror=()=>t(new Error("Failed to load Razorpay script. Please check your internet connection.")),document.head.appendChild(i)}),U=async r=>{if(await C({title:"Purchase Plan",message:`Proceed to pay for ${r.name}?`,variant:"info"})){if(!w){d({title:"Razorpay is not configured",variant:"error"});return}c(r.key);try{await D();const a=route("app.billing.razorpay.order",{plan:r.key}),i=await $.post(a,{},{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}});if(!i.data)throw new Error("Invalid response from server");const{order_id:h,amount:n,currency:j,key_id:u}=i.data;if(!h||!n||!u)throw new Error("Missing required order data from server");if(!window.Razorpay)throw new Error("Razorpay script not loaded");if(!h||!n||!u)throw new Error("Invalid order data received from server");const v=typeof u=="string"?u.trim():u;if(!v)throw new Error("Invalid Razorpay Key ID received from server");if(!/^rzp_(test|live)_[A-Za-z0-9]+$/.test(v))throw new Error("Razorpay Key ID is invalid. Please verify the Key ID in platform settings.");const q=typeof n=="string"?parseInt(n,10):Number(n),Y={key:v,amount:q,currency:j||"INR",order_id:h,name:f.name||"Waify",description:r.description||r.name,handler:async s=>{try{const o=route("app.billing.razorpay.confirm");await $.post(o,{order_id:s.razorpay_order_id,payment_id:s.razorpay_payment_id,signature:s.razorpay_signature}),d({title:"Payment successful. Plan activated.",variant:"success"}),N.reload({only:["plans","current_plan_key","flash"]})}catch(o){const H=o?.response?.data?.message||o?.message||"Unknown error";d({title:"Payment captured, but activation failed.",description:H,variant:"error"})}},prefill:{name:f?.owner?.name||"",email:f?.owner?.email||""},theme:{color:"#2563eb"},modal:{ondismiss:()=>{c(null)}}},x=console.warn,y=console.error;console.warn=(...s)=>{const o=s.join(" ");o.includes("x-rtb-fingerprint-id")||o.includes("serviceworker")||o.includes("Refused to get unsafe header")||o.includes("Permissions policy violation")||o.includes("devicemotion events are blocked")||x.apply(console,s)},console.error=(...s)=>{const o=s.join(" ");o.includes("x-rtb-fingerprint-id")||o.includes("serviceworker")||o.includes("Refused to get unsafe header")||o.includes("Permissions policy violation")||o.includes("devicemotion events are blocked")||y.apply(console,s)};const p=new window.Razorpay(Y);p.on("payment.failed",s=>{console.warn=x,console.error=y,d({title:"Payment failed",description:s.error?.description||s.error?.reason||"Payment could not be processed",variant:"error"}),c(null)}),p.on("modal.close",()=>{console.warn=x,console.error=y,c(null)}),p.on("error",s=>{console.warn=x,console.error=y,console.error("Razorpay error:",s),d({title:"Payment gateway error",description:s?.description||s?.message||"An error occurred with the payment gateway. Please verify your Razorpay account configuration in the Razorpay dashboard.",variant:"error"}),c(null)});try{p.open(),setTimeout(()=>{console.warn=x,console.error=y},2e3)}catch(s){console.warn=x,console.error=y,console.error("Failed to open Razorpay:",s),d({title:"Failed to open payment gateway",description:s?.message||"Please check your Razorpay configuration in platform settings. If the issue persists, verify your Razorpay test account is properly configured.",variant:"error"}),c(null)}}catch(a){console.error("Razorpay checkout error:",a);const i=a?.response?.data?.message||a?.message||"Failed to start Razorpay checkout. Please try again.";d({title:"Failed to start Razorpay checkout",description:i,variant:"error"}),c(null)}}},W=Array.from(new Set(l.flatMap(r=>r.modules))),m=r=>r===void 0?"N/A":r===-1||r===9999||r===9999999?"Unlimited":r.toLocaleString(),g=!P;return e.jsxs(J,{children:[e.jsx(X,{title:"Available Plans"}),e.jsxs("div",{className:"space-y-8",children:[g&&e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-2 bg-blue-500 rounded-lg",children:e.jsx(S,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-gray-100 mb-2",children:"No Plan Selected"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-4",children:"Your account doesn't have an active plan. Please select a plan below to continue using the platform. You can start with our free plan or choose a paid plan with a trial."})]})]})}),e.jsxs("div",{children:[!g&&e.jsx(K,{href:route("app.billing.index",{}),className:"inline-flex items-center gap-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors mb-4",children:"â† Back to Billing"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent",children:g?"Select Your Plan":"Available Plans"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:g?"Choose a plan to get started with the platform":"Choose the plan that fits your needs"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(_,{variant:b==="cards"?"primary":"secondary",size:"sm",onClick:()=>R("cards"),className:"rounded-xl",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Cards"]}),e.jsxs(_,{variant:b==="table"?"primary":"secondary",size:"sm",onClick:()=>R("table"),className:"rounded-xl",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Compare"]})]})]})]}),b==="cards"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:l.map(r=>e.jsxs(F,{className:`border-0 shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden ${r.is_current?"ring-2 ring-blue-500 dark:ring-blue-400 shadow-blue-500/20":""}`,children:[e.jsx(Q,{className:`pb-4 ${r.is_current?"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20":"bg-gradient-to-r from-gray-50 to-white dark:from-gray-800 dark:to-gray-900"}`,children:e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(ee,{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:r.name}),r.description&&e.jsx(re,{className:"mt-1 text-xs",children:r.description})]}),r.is_current&&e.jsxs(M,{variant:"success",className:"px-3 py-1 flex items-center gap-1",children:[e.jsx(V,{className:"h-3.5 w-3.5"}),"Current"]})]})}),e.jsxs(I,{className:"p-6 space-y-5",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100 mb-1",children:k(r.price_monthly,r.currency)}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"per month"}),r.price_yearly&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["or ",k(r.price_yearly,r.currency),"/year"]})]}),r.warnings.length>0&&e.jsx("div",{className:"p-3 bg-gradient-to-r from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-800/20 rounded-xl border border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(S,{className:"h-4 w-4 text-yellow-600 dark:text-yellow-400 mt-0.5 flex-shrink-0"}),e.jsx("div",{className:"text-xs text-yellow-800 dark:text-yellow-200",children:r.warnings.map((t,a)=>e.jsx("p",{children:t},a))})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Limits"}),e.jsxs("div",{className:"space-y-2",children:[r.limits.messages_monthly!==void 0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Messages:"}),e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[m(r.limits.messages_monthly),"/mo"]})]}),r.limits.template_sends_monthly!==void 0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Templates:"}),e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[m(r.limits.template_sends_monthly),"/mo"]})]}),r.limits.whatsapp_connections!==void 0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Connections:"}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:m(r.limits.whatsapp_connections)})]}),r.limits.agents!==void 0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Agents:"}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:m(r.limits.agents)})]})]})]}),e.jsxs("div",{className:"space-y-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Modules"}),r.modules.length>0?e.jsx("div",{className:"space-y-1.5",children:r.modules.map(t=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx(E,{className:"h-4 w-4 text-green-600 dark:text-green-400 flex-shrink-0"}),e.jsx("span",{className:"text-xs",children:t.replace("automation.","").replace(/\./g," ").split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" ")})]},t))}):e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No modules"})]}),r.trial_days>0&&e.jsxs("div",{className:"p-2 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-xs text-blue-600 dark:text-blue-400 font-medium text-center",children:[r.trial_days,"-day free trial"]}),e.jsx(_,{variant:r.is_current?"secondary":"primary",className:`w-full rounded-xl ${r.is_current?"":"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 shadow-lg shadow-blue-500/50"}`,disabled:r.is_current||z===r.key||r.price_monthly===null,onClick:()=>{if(r.price_monthly&&r.price_monthly>0&&w){U(r);return}L(r.key)},children:r.is_current?"Current Plan":z===r.key?"Switching...":r.price_monthly===null?"Contact Sales":r.price_monthly>0&&w?"Pay & Switch":"Switch to this Plan"})]})]},r.key))}):e.jsx(F,{className:"border-0 shadow-lg",children:e.jsx(I,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Feature"}),l.map(r=>e.jsxs("th",{className:`px-6 py-4 text-center ${r.is_current?"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20":""}`,children:[e.jsx("div",{className:"font-bold text-gray-900 dark:text-gray-100",children:r.name}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-2",children:k(r.price_monthly,r.currency)}),r.is_current&&e.jsx(M,{variant:"success",className:"mt-2 px-3 py-1",children:"Current"})]},r.key))]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-800 bg-white dark:bg-gray-900",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 font-semibold text-gray-900 dark:text-gray-100",children:"Messages/month"}),l.map(r=>e.jsx("td",{className:`px-6 py-4 text-center text-sm font-medium ${r.is_current?"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20":""}`,children:m(r.limits.messages_monthly)},r.key))]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 font-semibold text-gray-900 dark:text-gray-100",children:"Template sends/month"}),l.map(r=>e.jsx("td",{className:`px-6 py-4 text-center text-sm font-medium ${r.is_current?"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20":""}`,children:m(r.limits.template_sends_monthly)},r.key))]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 font-semibold text-gray-900 dark:text-gray-100",children:"WhatsApp Connections"}),l.map(r=>e.jsx("td",{className:`px-6 py-4 text-center text-sm font-medium ${r.is_current?"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20":""}`,children:m(r.limits.whatsapp_connections)},r.key))]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 font-semibold text-gray-900 dark:text-gray-100",children:"Agents"}),l.map(r=>e.jsx("td",{className:`px-6 py-4 text-center text-sm font-medium ${r.is_current?"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20":""}`,children:m(r.limits.agents)},r.key))]}),W.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 font-semibold text-gray-900 dark:text-gray-100",children:r.replace("automation.","").replace(/\./g," ").split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}),l.map(t=>e.jsx("td",{className:`px-6 py-4 text-center ${t.is_current?"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20":""}`,children:t.modules.includes(r)?e.jsx(E,{className:"h-5 w-5 text-green-600 dark:text-green-400 mx-auto"}):e.jsx(Z,{className:"h-5 w-5 text-gray-300 dark:text-gray-700 mx-auto"})},t.key))]},r))]})]})})})})]})]})}export{ke as default};
