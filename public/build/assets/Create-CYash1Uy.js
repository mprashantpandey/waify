import{r as i,j as e}from"./react-BhzSerM2.js";import{G as L,H as J,l as h,N as K,L as M,g as P,p as G,a7 as y,aJ as Y,a5 as $,a as Q}from"./vendor-DxGhd0kb.js";import{A as X}from"./AppShell-CkAdHkwF.js";import{C as v,b as k,c as C,d as E,a as I}from"./Card-2LWG2Pxg.js";import{B as x}from"./app-LxBsIpMW.js";import{T as c}from"./TextInput-DRXLElIV.js";import{I as l}from"./InputLabel-qVeuR0hO.js";import{I as b}from"./InputError-6mWSc7R2.js";import{u as Z}from"./useToast-m6H8bvjE.js";import"./Topbar-C479R05n.js";import"./Badge-DpSbAfCU.js";import"./GlobalFlashHandler-xHP6pVTU.js";import"./BrandingWrapper-DK418oSm.js";import"./Alert-u745Uvig.js";import"./CookieConsentBanner-RgCHAFaX.js";/* empty css            */function ge({account:ee,embeddedSignup:r,defaultApiVersion:te}){const[f,W]=i.useState(!1),[S,O]=i.useState(!1),[D,p]=i.useState(null),[F,A]=i.useState(!1),[g,j]=i.useState(null),[_,B]=i.useState("later"),{addToast:N}=Z(),{data:d,setData:u,post:H,processing:T,errors:w}=L({name:"",waba_id:"",phone_number_id:"",business_phone:"",access_token:""}),z=t=>{t.preventDefault(),H(route("app.whatsapp.connections.store",{}))},U=async()=>{A(!0),j(null);try{const n=(await Q.post(route("app.whatsapp.connections.test",{}),{phone_number_id:d.phone_number_id,access_token:d.access_token,waba_id:d.waba_id||null})).data,a=n.display_phone_number||n.verified_name||"Connection looks valid";u("business_phone",n.display_phone_number||d.business_phone),j({ok:!0,message:`Success: ${a}`}),N({title:"Connection verified",variant:"success"})}catch(t){const n=t?.response?.data?.error||"Unable to verify connection";j({ok:!1,message:n}),N({title:"Connection test failed",variant:"error"})}finally{A(!1)}},m=!!(r?.enabled&&r?.appId&&r?.configId),s=L({name:"",waba_id:"",phone_number_id:"",business_phone:"",access_token:"",code:"",pin:"",redirect_uri:""});i.useEffect(()=>{if(!m)return;const t=()=>{window.FB&&(window.FB.init({appId:r.appId,cookie:!0,xfbml:!0,version:r.apiVersion||"v21.0"}),O(!0))};if(window.FB){t();return}window.fbAsyncInit=t;const n="facebook-jssdk";if(!document.getElementById(n)){const a=document.createElement("script");a.id=n,a.src="https://connect.facebook.net/en_US/sdk.js",document.body.appendChild(a)}},[m,r?.appId,r?.apiVersion]),i.useEffect(()=>{if(!m)return;const t=n=>{if(!n.origin.includes("facebook.com"))return;let a=n.data;if(typeof a=="string")try{a=JSON.parse(a)}catch{return}const R=a?.event||a?.type||a?.action,o=a?.data||a?.payload||a;(R==="FINISH"||R==="COMPLETE"||o?.waba_id||o?.phone_number_id)&&(o?.waba_id&&s.setData("waba_id",o.waba_id),o?.phone_number_id&&s.setData("phone_number_id",o.phone_number_id),(o?.business_phone||o?.display_phone_number)&&s.setData("business_phone",o.business_phone||o.display_phone_number),p("Embedded signup finished. Ready to create connection."))};return window.addEventListener("message",t),()=>window.removeEventListener("message",t)},[m]);const q=()=>{!m||!window.FB||(p("Starting Meta Embedded Signup..."),s.setData("redirect_uri",window.location.href),window.FB.login(t=>{t?.authResponse?(t.authResponse.code&&s.setData("code",t.authResponse.code),t.authResponse.accessToken&&s.setData("access_token",t.authResponse.accessToken),p("Authorization complete. Finish setup to create the connection.")):p("Login was cancelled or did not fully authorize.")},{config_id:r.configId,response_type:"code",override_default_response_type:!0,scope:"whatsapp_business_management,whatsapp_business_messaging,business_management"}))},V=t=>{t.preventDefault(),s.post(route("app.whatsapp.connections.store-embedded",{}))};return e.jsxs(X,{children:[e.jsx(J,{title:"Create WhatsApp Connection"}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs(h,{href:route("app.whatsapp.connections.index",{}),className:"inline-flex items-center gap-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors mb-4",children:[e.jsx(K,{className:"h-4 w-4"}),"Back to Connections"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent",children:"Create WhatsApp Connection"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Connect your WhatsApp Business Account to start messaging"})]})]}),m?e.jsxs(v,{className:"border-0 shadow-xl",children:[e.jsx(k,{className:"bg-gradient-to-r from-emerald-50 to-emerald-100 dark:from-emerald-900/20 dark:to-emerald-800/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-emerald-600 rounded-xl",children:e.jsx(M,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx(C,{className:"text-xl font-bold",children:"Embedded Signup (Recommended)"}),e.jsx(E,{children:"Connect directly via Meta for a verified, production-ready setup"})]})]}),e.jsx(h,{href:route("app.whatsapp.connections.wizard",{}),children:e.jsxs(x,{variant:"secondary",size:"sm",className:"rounded-xl",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Use Wizard"]})})]})}),e.jsxs(I,{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(x,{type:"button",onClick:q,disabled:!S,className:"bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl",children:"Connect with Meta"}),!S&&e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Loading Meta SDK..."})]}),D&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-emerald-50 dark:bg-emerald-900/20 rounded-lg border border-emerald-200 dark:border-emerald-800",children:[e.jsx(G,{className:"h-4 w-4 text-emerald-600 dark:text-emerald-400 mt-0.5"}),e.jsx("p",{className:"text-xs text-emerald-700 dark:text-emerald-300",children:D})]}),e.jsxs("form",{onSubmit:V,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"embedded_name",value:"Connection Name (Optional)",className:"text-sm font-semibold mb-2"}),e.jsx(c,{id:"embedded_name",type:"text",value:s.data.name,className:"mt-1 block w-full rounded-xl",onChange:t=>s.setData("name",t.target.value),placeholder:"My Meta WhatsApp"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"embedded_waba",value:"WABA ID",className:"text-sm font-semibold mb-2"}),e.jsx(c,{id:"embedded_waba",type:"text",value:s.data.waba_id,className:"mt-1 block w-full rounded-xl font-mono",onChange:t=>s.setData("waba_id",t.target.value),placeholder:"Auto-filled after signup"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"embedded_phone_id",value:"Phone Number ID",className:"text-sm font-semibold mb-2"}),e.jsx(c,{id:"embedded_phone_id",type:"text",value:s.data.phone_number_id,className:"mt-1 block w-full rounded-xl font-mono",onChange:t=>s.setData("phone_number_id",t.target.value),placeholder:"Auto-filled after signup"})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"embedded_business_phone",value:"Business Phone (Optional)",className:"text-sm font-semibold mb-2"}),e.jsx(c,{id:"embedded_business_phone",type:"text",value:s.data.business_phone,className:"mt-1 block w-full rounded-xl",onChange:t=>s.setData("business_phone",t.target.value),placeholder:"+1234567890"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"embedded_pin",value:"Registration PIN (Optional)",className:"text-sm font-semibold mb-2"}),e.jsx(c,{id:"embedded_pin",type:"text",value:s.data.pin,className:"mt-1 block w-full rounded-xl font-mono",onChange:t=>s.setData("pin",t.target.value),placeholder:"6-digit PIN",maxLength:6}),e.jsx("p",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:"Provide PIN to register the phone number immediately after signup."})]}),e.jsx(b,{message:s.errors?.embedded,className:"mt-2"}),e.jsx("div",{className:"flex items-center justify-end gap-4 pt-2",children:e.jsx(x,{type:"submit",disabled:s.processing,className:"bg-gradient-to-r from-emerald-600 to-emerald-700 hover:from-emerald-700 hover:to-emerald-800 shadow-lg shadow-emerald-500/40 rounded-xl",children:s.processing?"Connecting...":"Create Connection"})})]})]})]}):e.jsxs(v,{className:"border-0 shadow-xl",children:[e.jsx(k,{className:"bg-gradient-to-r from-amber-50 to-amber-100 dark:from-amber-900/20 dark:to-amber-800/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-500 rounded-xl",children:e.jsx(y,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx(C,{className:"text-xl font-bold",children:"Embedded Signup"}),e.jsx(E,{children:r?.enabled===!1?"Disabled by your platform administrator":"Not configured by your platform administrator"})]})]})}),e.jsxs(I,{className:"p-6",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r?.enabled===!1?"Embedded Signup is currently disabled. Please contact support or use the manual setup below.":"Embedded Signup is not fully configured yet. Please contact support or use the manual setup below."}),e.jsx("div",{className:"mt-4",children:e.jsx(h,{href:route("app.support.hub",{}),className:"inline-flex items-center text-sm font-semibold text-amber-700 hover:text-amber-800 dark:text-amber-300 dark:hover:text-amber-200",children:"Contact support"})})]})]}),e.jsxs(v,{className:"border-0 shadow-xl",children:[e.jsx(k,{className:"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500 rounded-xl",children:e.jsx(M,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx(C,{className:"text-xl font-bold",children:"Connection Details"}),e.jsx(E,{children:"Enter only the required Meta details"})]})]})}),e.jsx(I,{className:"p-6",children:e.jsxs("form",{onSubmit:z,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"phone_number_id",value:"Phone Number ID *",className:"text-sm font-semibold mb-2"}),e.jsx(c,{id:"phone_number_id",type:"text",value:d.phone_number_id,className:"mt-1 block w-full rounded-xl font-mono",onChange:t=>u("phone_number_id",t.target.value),placeholder:"123456789012345",required:!0,autoFocus:!0}),e.jsx(b,{message:w.phone_number_id,className:"mt-2"}),e.jsxs("div",{className:"mt-2 flex items-start gap-2 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx(y,{className:"h-4 w-4 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:"Found in Meta Business Manager → WhatsApp → API Setup"})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"waba_id",value:"WhatsApp Business Account ID (Optional)",className:"text-sm font-semibold mb-2"}),e.jsx(c,{id:"waba_id",type:"text",value:d.waba_id,className:"mt-1 block w-full rounded-xl font-mono",onChange:t=>u("waba_id",t.target.value),placeholder:"123456789012345"}),e.jsx(b,{message:w.waba_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(l,{htmlFor:"access_token",value:"Access Token *",className:"text-sm font-semibold"}),e.jsx("button",{type:"button",onClick:()=>W(!f),className:"text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors flex items-center gap-1",children:f?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4"}),"Hide"]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-4 w-4"}),"Show"]})})]}),e.jsx(c,{id:"access_token",type:f?"text":"password",value:d.access_token,className:"mt-1 block w-full rounded-xl font-mono text-sm",onChange:t=>u("access_token",t.target.value),placeholder:"Enter your permanent access token",required:!0}),e.jsx(b,{message:w.access_token,className:"mt-2"}),e.jsxs("div",{className:"mt-2 flex items-start gap-2 p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:[e.jsx(y,{className:"h-4 w-4 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-amber-700 dark:text-amber-300",children:"Permanent token from Meta Business Manager. Keep this secure."})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 pt-2",children:[e.jsx(x,{type:"button",variant:"secondary",className:"rounded-xl",onClick:U,disabled:F||!d.phone_number_id||!d.access_token,children:F?"Testing...":"Test Connection"}),g&&e.jsx("span",{className:g.ok?"text-xs text-green-600":"text-xs text-red-600",children:g.message})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700 space-y-3",children:[e.jsx(l,{value:"Webhook Setup",className:"text-sm font-semibold"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("input",{type:"radio",name:"webhook_setup",value:"now",checked:_==="now",onChange:()=>B("now")}),"Set up webhook now"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("input",{type:"radio",name:"webhook_setup",value:"later",checked:_==="later",onChange:()=>B("later")}),"I’ll do it later"]})]}),_==="now"?e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"After creation, we’ll show the webhook URL and verify token."}):e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"You can set it up anytime from the connection page."}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Need assistance? Contact support from the Help menu."})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{type:"button",className:"inline-flex items-center gap-2 text-xs font-medium text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300",onClick:()=>N({title:"Live chat coming soon",variant:"info"}),children:"Open live chat (coming soon)"})}),e.jsxs("div",{className:"flex items-center justify-end gap-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(h,{href:route("app.whatsapp.connections.index",{}),children:e.jsx(x,{type:"button",variant:"secondary",className:"rounded-xl",children:"Cancel"})}),e.jsx(x,{type:"submit",disabled:T,className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 shadow-lg shadow-blue-500/50 rounded-xl",children:T?"Creating...":e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Create Connection"]})})]})]})})]})]})]})}export{ge as default};
