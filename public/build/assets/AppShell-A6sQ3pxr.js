import{j as e,r as i}from"./react-BhzSerM2.js";import{o as z,X as L,a2 as X,A as U,U as G,ad as Z,ar as K,_ as Y,g as J,Z as Q,d as V,a9 as ee,I as re,F as te,a6 as se,v as ae,as as D,q as W,M as ne,C as ie,N as oe,s as le}from"./vendor-YQoUUhbX.js";import{c as T,a as de,B as q}from"./app-DjsbE74r.js";import{T as ce}from"./Topbar-D6SeU-QE.js";import{T as ge,G as ue}from"./GlobalFlashHandler-DjMhmIiM.js";import{B as me}from"./BrandingWrapper-Djq-D_tN.js";import{A as xe}from"./Alert-u60ICsin.js";import{C as pe,A as fe}from"./CookieConsentBanner-C37xsP7H.js";const he={LayoutDashboard:D,Puzzle:ae,MessageCircle:se,FileText:te,Inbox:re,Bot:ee,Sparkles:V,Zap:Q,BarChart3:J,CreditCard:Y,LifeBuoy:K,Settings:Z,Users:G,Activity:U,Megaphone:X};function be({navigation:r,currentRoute:d,account:x,isOpen:o=!1,onClose:c}){const{branding:s}=z().props,g=s?.platform_name||"WACP",u=s?.logo_url,f=r.reduce((a,p)=>{const b=p.group||"other";return a[b]||(a[b]=[]),a[b].push(p),a},{}),n={core:"Core",messaging:"Messaging",automation:"Automation",ai:"AI",growth:"Growth",billing:"Billing"},j=a=>{try{return route(a,{})}catch{return null}},A=a=>{const p=j(a);return p||(a.endsWith(".index")?j(a.slice(0,-6)):j(`${a}.index`))},w=(a,p)=>{const b=he[a.icon]||D;let k="#";if(x){const C=A(a.href);if(!C)return null;k=C}else return null;const N=d.includes(a.href.replace("app.",""));return e.jsxs(W,{href:k,className:T("flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all duration-200 group",N?"bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg shadow-blue-500/50":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 hover:translate-x-1"),children:[e.jsx(b,{className:T("h-5 w-5 transition-transform duration-200",N?"text-white":"text-gray-500 dark:text-gray-400 group-hover:text-blue-600 dark:group-hover:text-blue-400",!N&&"group-hover:scale-110")}),e.jsx("span",{className:T(N?"font-semibold":"font-medium"),children:a.label})]},`${a.href}-${a.label}-${p}`)},v=e.jsx("nav",{className:"flex-1 overflow-y-auto p-6 space-y-8",children:Object.entries(f).map(([a,p])=>{const b=p.map(w).filter(k=>k!==null);return b.length===0?null:e.jsxs("div",{children:[n[a]&&e.jsx("h3",{className:"px-4 text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3",children:n[a]}),e.jsx("div",{className:"space-y-1.5",children:b})]},a)}).filter(Boolean)});return e.jsxs(e.Fragment,{children:[o&&e.jsx("div",{className:"lg:hidden fixed inset-0 z-40 bg-black/60 backdrop-blur-sm transition-opacity",onClick:c}),e.jsxs("aside",{className:T("lg:hidden fixed inset-y-0 left-0 z-50 w-72 bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 transform transition-transform duration-300 ease-in-out shadow-2xl",o?"translate-x-0":"-translate-x-full"),children:[e.jsxs("div",{className:"flex items-center justify-between h-16 px-6 border-b border-gray-200 dark:border-gray-800 bg-gradient-to-r from-gray-50 to-white dark:from-gray-900 dark:to-gray-800",children:[u?e.jsx("img",{src:u,alt:g,className:"h-8 w-auto"}):e.jsx("h2",{className:"text-lg font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent",children:g}),e.jsx("button",{onClick:c,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"Close sidebar",children:e.jsx(L,{className:"h-5 w-5 text-gray-700 dark:text-gray-300","aria-hidden":!0})})]}),v]}),e.jsxs("aside",{className:"hidden lg:flex lg:flex-col lg:w-72 lg:fixed lg:inset-y-0 lg:z-30 bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 shadow-lg",children:[e.jsx("div",{className:"flex items-center h-16 px-6 border-b border-gray-200 dark:border-gray-800 bg-gradient-to-r from-gray-50 to-white dark:from-gray-900 dark:to-gray-800",children:u?e.jsx("img",{src:u,alt:g,className:"h-8 w-auto"}):e.jsx("h2",{className:"text-lg font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent",children:g})}),v]})]})}const ye=r=>r.mime_type?r.mime_type.startsWith("image/"):/\.(png|jpe?g|gif|webp|svg)$/i.test(r.file_name),je=r=>r.mime_type?r.mime_type==="application/pdf":/\.pdf$/i.test(r.file_name),M=r=>{if(!r||r.id==null||!r.created_at)return null;const d=Number(r.id);return!Number.isInteger(d)||d<1?null:{id:d,sender_type:String(r.sender_type??"user"),sender_id:r.sender_id==null?null:Number(r.sender_id),body:String(r.body??""),created_at:String(r.created_at),attachments:Array.isArray(r.attachments)?r.attachments:[]}},R=(r,d)=>{const x=new Map;for(const o of r)x.set(o.id,o);for(const o of d){const c=x.get(o.id);x.set(o.id,c?{...c,...o}:o)}return Array.from(x.values()).sort((o,c)=>new Date(o.created_at).getTime()-new Date(c.created_at).getTime())};function we(){const{account:r,branding:d,supportSettings:x}=z().props,{subscribe:o}=de();if(!(x?.live_chat_enabled??!0))return null;const[s,g]=i.useState(!1),[u,f]=i.useState(!1),[n,j]=i.useState(null),[A,w]=i.useState([]),[v,a]=i.useState(""),[p,b]=i.useState([]),[k,N]=i.useState(!1),C=i.useRef(null),S=i.useMemo(()=>({email:d?.support_email,phone:d?.support_phone}),[d?.support_email,d?.support_phone]);i.useEffect(()=>{C.current=n?.id??null},[n?.id]);const P=i.useCallback(t=>{const l=Array.isArray(t)?t.map(M).filter(y=>y!==null):[];l.length!==0&&w(y=>R(y,l))},[]),I=i.useCallback(async(t=!1)=>{if(r?.slug){t&&f(!0);try{const y=(await window.axios.get(route("app.support.live",{}),{headers:{Accept:"application/json"}})).data,m=y.thread??null,_=C.current,E=!!m&&_!==m.id;j(h=>m?h&&h.id===m.id?{...h,...m}:m:h??null),E&&w([]),P(y.messages)}finally{t&&f(!1)}}},[r?.slug,P]);i.useEffect(()=>{if(!s||!r?.slug)return;let t=!1;return f(!0),I(!1).finally(()=>{t||f(!1)}),()=>{t=!0}},[s,r?.slug,I]),i.useEffect(()=>{if(!s||!r?.slug)return;const t=window.setInterval(()=>{I(!1)},5e3);return()=>window.clearInterval(t)},[s,r?.slug,I]),i.useEffect(()=>{if(!s||!n||!r?.id)return;const t=`account.${r.id}.support.thread.${n.id}`;try{const l=o(t,"support.message.created",y=>{if(y?.thread_id&&Number(y.thread_id)!==n.id)return;const m=M(y);m&&w(_=>R(_,[m]))});return()=>{try{l()}catch{}}}catch{return()=>{}}},[s,o,n?.id,r?.id]);const B=async()=>{if(!v.trim()&&p.length===0||!r?.slug)return;const t=new FormData;v.trim()&&t.append("message",v.trim()),t.append("subject",n?.subject??"Live chat"),n?.id&&n.status!=="closed"&&t.append("thread_id",String(n.id)),p.forEach(h=>t.append("attachments[]",h)),a(""),b([]);const l=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),m=(await window.axios.post(route("app.support.live.message",{}),t,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":l||window.axios.defaults.headers.common["X-CSRF-TOKEN"]||""},withCredentials:!0})).data;m.thread&&(C.current!==m.thread.id&&w([]),j(m.thread));const _=m.message;if(_){const h=M(_);h&&w($=>R($,[h]))}const E=m.bot;if(E){const h=M(E);h&&w($=>R($,[h]))}},F=async()=>{r?.slug&&(await window.axios.post(route("app.support.live.close",{}),{},{headers:{Accept:"application/json"}}),j(t=>t&&{...t,status:"closed"}))},O=()=>{j(null),w([]),a(""),b([])},H=async()=>{if(r?.slug){N(!0);try{const l=(await window.axios.post(route("app.support.live.request-human",{}),{},{headers:{Accept:"application/json"}})).data;l.thread&&j(l.thread)}finally{N(!1)}}};return e.jsxs("div",{className:"fixed bottom-6 right-6 z-40",children:[!s&&e.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-2 rounded-full bg-blue-600 text-white px-4 py-3 shadow-lg hover:bg-blue-700 transition",children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-semibold",children:"Live Chat"})]}),s&&e.jsxs("div",{className:"w-80 max-w-[90vw] rounded-2xl bg-white dark:bg-gray-900 shadow-xl border border-gray-200 dark:border-gray-800 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:"Support Live Chat"}),e.jsx("div",{className:"text-xs opacity-90",children:"We typically reply in a few minutes"})]}),e.jsx("button",{onClick:()=>g(!1),className:"p-1 hover:opacity-80",children:e.jsx(L,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"px-4 py-3 text-xs text-gray-500 dark:text-gray-400 border-b border-gray-200 dark:border-gray-800",children:S.email||S.phone?`Email ${S.email??"—"}${S.phone?` · ${S.phone}`:""}`:"Share details and we will assist you."}),e.jsxs("div",{className:"h-64 overflow-y-auto px-4 py-3 space-y-3",children:[u&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Loading chat..."}),!u&&A.length===0&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Start a conversation with our support team."}),n?.mode==="human"&&e.jsx("div",{className:"text-xs text-amber-700 dark:text-amber-300 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-md px-3 py-2",children:"A live agent has been requested. We will join shortly."}),n?.status==="closed"&&e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md px-3 py-2",children:"This chat is closed. Start a new conversation anytime."}),A.map(t=>e.jsxs("div",{className:`rounded-lg px-3 py-2 text-xs leading-relaxed ${t.sender_type==="admin"||t.sender_type==="bot"?"bg-blue-50 dark:bg-blue-900/30 text-gray-900 dark:text-gray-100":t.sender_type==="system"?"bg-amber-50 dark:bg-amber-900/30 text-gray-900 dark:text-gray-100":"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100"}`,children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wider opacity-60 mb-1",children:t.sender_type==="admin"?"Support":t.sender_type==="bot"?"Assistant":t.sender_type==="system"?"System":"You"}),t.body,t.attachments&&t.attachments.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:t.attachments.map(l=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("a",{href:l.url,target:"_blank",rel:"noreferrer",className:"block text-[11px] text-blue-600 dark:text-blue-300 hover:underline",children:l.file_name}),ye(l)&&e.jsx("img",{src:l.url,alt:l.file_name,className:"max-h-32 rounded-md border border-gray-200 dark:border-gray-700"}),je(l)&&e.jsxs("details",{className:"text-[11px] text-gray-600 dark:text-gray-300",children:[e.jsx("summary",{className:"cursor-pointer",children:"Preview PDF"}),e.jsx("iframe",{src:l.url,className:"mt-2 h-36 w-full rounded-md border border-gray-200 dark:border-gray-700"})]})]},l.id))})]},t.id))]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-800 p-3 space-y-2",children:[n?.status!=="closed"&&n?.mode!=="human"&&e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"button",onClick:H,disabled:k,className:"text-xs font-semibold text-blue-600 dark:text-blue-400 hover:underline",children:k?"Requesting live agent...":"Talk to a live agent"})}),e.jsx("textarea",{value:v,onChange:t=>a(t.target.value),rows:2,disabled:n?.status==="closed",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100 text-sm disabled:opacity-60",placeholder:n?.status==="closed"?"Start a new chat to send messages.":"Type your message..."}),e.jsx("input",{type:"file",multiple:!0,disabled:n?.status==="closed",onChange:t=>b(Array.from(t.target.files||[])),className:"block w-full text-xs text-gray-500 file:mr-4 file:rounded-md file:border-0 file:bg-gray-100 file:px-3 file:py-1.5 file:text-xs file:font-semibold file:text-gray-700 hover:file:bg-gray-200 dark:file:bg-gray-800 dark:file:text-gray-200 dark:hover:file:bg-gray-700 disabled:opacity-60"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[n?.status==="closed"&&e.jsx(q,{type:"button",variant:"secondary",onClick:O,children:"New Chat"}),n?.status==="open"&&e.jsx(q,{type:"button",variant:"secondary",onClick:F,children:"End Chat"}),e.jsx(q,{type:"button",onClick:B,disabled:v.trim().length===0&&p.length===0||n?.status==="closed",children:"Send"})]})]})]})]})}function ve(){const{auth:r}=z().props,[d,x]=i.useState(!1),[o,c]=i.useState(!1),s=r?.user,g=r?.profile_complete??!0;i.useEffect(()=>{sessionStorage.getItem("profile_incomplete_dismissed")==="true"&&c(!0)},[]),i.useEffect(()=>{g&&(c(!1),sessionStorage.removeItem("profile_incomplete_dismissed")),x(!!(!g&&!o&&s))},[g,o,s]);const u=()=>{c(!0),x(!1),sessionStorage.setItem("profile_incomplete_dismissed","true")},f=typeof window<"u"?window.location.pathname:"";return f==="/profile"||f.startsWith("/profile/")||f.startsWith("/platform")||!d||g?null:e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl shadow-2xl max-w-md w-full border border-gray-200 dark:border-gray-800 overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-amber-500 to-orange-500 px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(ie,{className:"h-6 w-6 text-white"})}),e.jsx("h3",{className:"text-lg font-bold text-white",children:"Complete Your Profile"})]}),e.jsx("button",{onClick:u,className:"p-1.5 rounded-lg hover:bg-white/20 transition-colors text-white","aria-label":"Dismiss",children:e.jsx(L,{className:"h-5 w-5","aria-hidden":!0})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs(xe,{variant:"warning",children:[e.jsx(oe,{className:"h-5 w-5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-sm mb-1",children:"Profile Incomplete"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Please complete your profile to access all features. The following information is required:"})]})]}),e.jsxs("div",{className:"space-y-2 pl-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${s?.name?"bg-green-500":"bg-red-500"}`}),e.jsxs("span",{className:s?.name?"text-gray-600 dark:text-gray-400":"font-semibold text-gray-900 dark:text-gray-100",children:["Full Name ",s?.name?"✓":"(Required)"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${s?.email?"bg-green-500":"bg-red-500"}`}),e.jsxs("span",{className:s?.email?"text-gray-600 dark:text-gray-400":"font-semibold text-gray-900 dark:text-gray-100",children:["Email Address ",s?.email?"✓":"(Required)"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${s?.phone?"bg-green-500":"bg-red-500"}`}),e.jsxs("span",{className:s?.phone?"text-gray-600 dark:text-gray-400":"font-semibold text-gray-900 dark:text-gray-100",children:["Phone Number ",s?.phone?"✓":"(Required)"]})]})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between gap-3",children:[e.jsx("button",{onClick:u,className:"text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors",children:"I'll do it later"}),e.jsx(W,{href:route("profile.edit"),className:"flex items-center gap-2",children:e.jsxs(q,{className:"bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white shadow-lg",children:["Complete Profile",e.jsx(le,{className:"h-4 w-4 ml-1"})]})})]})]})})}function Te({children:r}){const{account:d,navigation:x,auth:o,ziggy:c}=z().props,s=window.location.pathname,[g,u]=i.useState(!1);return i.useEffect(()=>{u(!1)},[s]),i.useEffect(()=>{c&&(window.Ziggy=c)},[c]),i.useEffect(()=>{const f=()=>{window.innerWidth>=1024&&u(!1)};return window.addEventListener("resize",f),()=>window.removeEventListener("resize",f)},[]),e.jsx(me,{children:e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-50 dark:from-gray-950 dark:via-gray-900 dark:to-gray-950",children:[e.jsx(be,{navigation:x||[],currentRoute:s,account:d,isOpen:g,onClose:()=>u(!1)}),e.jsxs("div",{className:"lg:pl-72",children:[e.jsx(ce,{user:o?.user,onMenuClick:()=>u(!g)}),e.jsx("main",{className:"p-4 lg:p-6",children:r})]}),e.jsx(ge,{}),e.jsx(ue,{}),e.jsx(we,{}),e.jsx(ve,{}),e.jsx(pe,{}),e.jsx(fe,{})]})})}export{Te as A};
