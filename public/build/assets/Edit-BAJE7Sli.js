import{r as j,j as e}from"./react-BhzSerM2.js";import{G as J,H as W,l as B,N as q,C as Z,a7 as ee,F as ae,b8 as te,b4 as re,aX as se,b9 as de,X as le,a0 as ne,B as oe,a as ie}from"./vendor-DxGhd0kb.js";import{A as ce}from"./AppShell-hblPOeic.js";import{C as m,b as y,c as b,d as N,a as h}from"./Card-Cf3anJdB.js";import{B as xe}from"./Badge-DOejrt-x.js";import{B as p}from"./app-CHptu5EX.js";import{T as c}from"./TextInput-DRXLElIV.js";import{L as l}from"./Label-BWRo5zp1.js";import{S as k,a as E,b as w,c as C,d as i}from"./Select-DeOd6VFF.js";import{T as me}from"./Textarea-WuXup_o6.js";import{A as P}from"./Alert-B2z6wKx8.js";import{u as he}from"./useToast-m6H8bvjE.js";import"./Topbar-DAizFNof.js";import"./GlobalFlashHandler-xHP6pVTU.js";import"./BrandingWrapper-DK418oSm.js";import"./CookieConsentBanner-BIdbL3YD.js";/* empty css            */const R=[{code:"en_US",name:"English (US)"},{code:"en_GB",name:"English (UK)"},{code:"es_ES",name:"Spanish (Spain)"},{code:"es_MX",name:"Spanish (Mexico)"},{code:"pt_BR",name:"Portuguese (Brazil)"},{code:"fr_FR",name:"French"},{code:"de_DE",name:"German"},{code:"it_IT",name:"Italian"},{code:"hi_IN",name:"Hindi"},{code:"ja_JP",name:"Japanese"},{code:"ko_KR",name:"Korean"},{code:"zh_CN",name:"Chinese (Simplified)"},{code:"ar_SA",name:"Arabic"},{code:"tr_TR",name:"Turkish"},{code:"ru_RU",name:"Russian"}];function Oe({account:pe,template:n}){const{toast:u}=he(),[T,D]=j.useState(!1),[M,U]=j.useState(!1),[_,I]=j.useState(null),v=j.useRef(null),S=t=>{const r=t.match(/\{\{(\d+)\}\}/g),s=r?r.map(x=>parseInt(x.match(/\d+/)?.[0]||"0")):[];return s.length>0?Math.max(...s):0},[g,F]=j.useState(()=>S(n.body_text||"")),L=async t=>{if(t){U(!0);try{const r=new FormData;r.append("file",t),r.append("type",a.header_type);const s=await ie.post(route("app.whatsapp.templates.upload-media",{}),r);o("header_media_url",s.data.url),I(s.data.url),u.success("File uploaded","Media file uploaded successfully.")}catch(r){u.error("Upload failed",r.response?.data?.error||r.message||"Failed to upload file.")}finally{U(!1)}}},V=t=>{const r=t.target.files?.[0];r&&L(r),v.current&&(v.current.value="")},{data:a,setData:o,put:G,processing:O,errors:d}=J({whatsapp_connection_id:n.connection.id.toString(),name:n.name,language:n.language,category:n.category,header_type:n.header_type||"NONE",header_text:n.header_text||"",header_media_url:n.header_media_url||"",body_text:n.body_text||"",body_examples:[],footer_text:n.footer_text||"",buttons:n.buttons||[]}),A=t=>{const r=t.match(/\{\{(\d+)\}\}/g),s=r?r.map(z=>parseInt(z.match(/\d+/)?.[0]||"0")):[],x=s.length>0?Math.max(...s):0;F(x)};j.useEffect(()=>{A(a.body_text)},[]);const H=t=>{o("body_text",t),A(t)},X=()=>{if((a.buttons?.length||0)>=3){u.error("Maximum 3 buttons allowed");return}o("buttons",[...a.buttons||[],{type:"QUICK_REPLY",text:""}])},$=t=>{const r=[...a.buttons||[]];r.splice(t,1),o("buttons",r)},f=(t,r,s)=>{const x=[...a.buttons||[]];x[t]={...x[t],[r]:s},o("buttons",x)},K=(t,r)=>{const s=[...a.body_examples||[]];s[t]=r,o("body_examples",s)},Y=t=>{t.preventDefault(),a.buttons?.filter(r=>r.text.trim()!==""),a.body_examples?.filter(r=>r.trim()!==""),G(route("app.whatsapp.templates.update",{template:n.slug}),{onSuccess:()=>{u.success("Template updated successfully! A new version has been submitted to Meta for approval.")},onError:r=>{r.update?u.error(r.update):u.error("Failed to update template. Please check the form for errors.")}})},Q=()=>{let t=a.body_text||"";for(let r=1;r<=g;r++){const s=a.body_examples?.[r-1]||`Example ${r}`;t=t.replace(new RegExp(`\\{\\{${r}\\}\\}`,"g"),s)}return e.jsxs("div",{className:"space-y-4 p-6 bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-xl border-2 border-gray-200 dark:border-gray-700",children:[a.header_type!=="NONE"&&e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2",children:"HEADER"}),a.header_type==="TEXT"&&a.header_text&&e.jsx("div",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:a.header_text}),["IMAGE","VIDEO","DOCUMENT"].includes(a.header_type)&&a.header_media_url&&e.jsx("div",{className:"text-sm text-blue-600 dark:text-blue-400 break-all",children:a.header_media_url})]}),e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2",children:"BODY"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-gray-100 whitespace-pre-wrap",children:t||"Body text will appear here..."})]}),a.footer_text&&e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2",children:"FOOTER"}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:a.footer_text})]}),a.buttons&&a.buttons.length>0&&e.jsx("div",{className:"space-y-2",children:a.buttons.map((r,s)=>r.text&&e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800 text-center",children:e.jsx("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:r.text})},s))})]})};return e.jsxs(ce,{children:[e.jsx(W,{title:"Create Template"}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs(B,{href:route("app.whatsapp.templates.index",{}),className:"inline-flex items-center gap-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors mb-4",children:[e.jsx(q,{className:"h-4 w-4"}),"Back to Templates"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent",children:"Edit Template"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Update your WhatsApp message template. A new version will be submitted to Meta for approval."})]}),e.jsx(p,{variant:"secondary",onClick:()=>D(!T),children:T?"Edit Mode":"Preview Mode"})]})]}),n.rejection_reason&&e.jsxs(P,{variant:"error",className:"border-red-200 dark:border-red-800",children:[e.jsx(Z,{className:"h-5 w-5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-red-800 dark:text-red-200 mb-1",children:"Previous Rejection Reason"}),e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:n.rejection_reason})]})]}),e.jsxs(P,{variant:"info",className:"border-blue-200 dark:border-blue-800",children:[e.jsx(ee,{className:"h-5 w-5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-800 dark:text-blue-200 mb-1",children:"Template Guidelines"}),e.jsxs("ul",{className:"text-sm text-blue-600 dark:text-blue-400 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Template name: Alphanumeric and underscores only, max 512 characters"}),e.jsxs("li",{children:["Body text: Max 1024 characters, use ","{{1}}",", ","{{2}}"," for variables"]}),e.jsx("li",{children:"Header: Max 60 characters (TEXT) or media URL (IMAGE/VIDEO/DOCUMENT)"}),e.jsx("li",{children:"Footer: Max 60 characters"}),e.jsx("li",{children:"Buttons: Maximum 3 buttons (QUICK_REPLY, URL, or PHONE_NUMBER)"}),e.jsx("li",{children:"Editing creates a new version that requires Meta approval"})]})]})]}),e.jsxs("form",{onSubmit:Y,className:"space-y-6",children:[T?e.jsxs(m,{className:"border-0 shadow-lg",children:[e.jsxs(y,{children:[e.jsx(b,{children:"Template Preview"}),e.jsx(N,{children:"How your template will appear to recipients"})]}),e.jsx(h,{children:Q()})]}):e.jsxs(e.Fragment,{children:[e.jsxs(m,{className:"border-0 shadow-lg",children:[e.jsx(y,{className:"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20",children:e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"}),"Basic Information"]})}),e.jsxs(h,{className:"space-y-4 pt-6",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"connection",children:"WhatsApp Connection"}),e.jsx(c,{id:"connection",value:n.connection.name,disabled:!0,className:"bg-gray-100 dark:bg-gray-800"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Connection cannot be changed when editing"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"name",children:"Template Name *"}),e.jsx(c,{id:"name",value:a.name,onChange:t=>o("name",t.target.value),placeholder:"my_template_name",className:"font-mono",maxLength:512}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Alphanumeric and underscores only"}),d.name&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:d.name})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"language",children:"Language *"}),e.jsxs(k,{value:a.language,onValueChange:t=>o("language",t),children:[e.jsx(E,{children:e.jsx(w,{children:R.find(t=>t.code===a.language)?.name||"Select language"})}),e.jsx(C,{children:R.map(t=>e.jsx(i,{value:t.code,children:t.name},t.code))})]}),d.language&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:d.language})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"category",children:"Category *"}),e.jsxs(k,{value:a.category,onValueChange:t=>o("category",t),children:[e.jsx(E,{children:e.jsx(w,{})}),e.jsxs(C,{children:[e.jsx(i,{value:"MARKETING",children:"Marketing"}),e.jsx(i,{value:"UTILITY",children:"Utility"}),e.jsx(i,{value:"AUTHENTICATION",children:"Authentication"})]})]}),d.category&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:d.category})]})]})]}),e.jsxs(m,{className:"border-0 shadow-lg",children:[e.jsxs(y,{className:"bg-gradient-to-r from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20",children:[e.jsx(b,{children:"Header (Optional)"}),e.jsx(N,{children:"Add a header to your template"})]}),e.jsxs(h,{className:"space-y-4 pt-6",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"header_type",children:"Header Type"}),e.jsxs(k,{value:a.header_type,onValueChange:t=>o("header_type",t),children:[e.jsx(E,{children:e.jsx(w,{children:a.header_type==="NONE"?"None":a.header_type==="TEXT"?"Text":a.header_type==="IMAGE"?"Image":a.header_type==="VIDEO"?"Video":a.header_type==="DOCUMENT"?"Document":"Select header type"})}),e.jsxs(C,{children:[e.jsx(i,{value:"NONE",children:"None"}),e.jsx(i,{value:"TEXT",children:"Text"}),e.jsx(i,{value:"IMAGE",children:"Image"}),e.jsx(i,{value:"VIDEO",children:"Video"}),e.jsx(i,{value:"DOCUMENT",children:"Document"})]})]})]}),a.header_type==="TEXT"&&e.jsxs("div",{children:[e.jsx(l,{htmlFor:"header_text",children:"Header Text *"}),e.jsx(c,{id:"header_text",value:a.header_text||"",onChange:t=>o("header_text",t.target.value),placeholder:"Header text (max 60 characters)",maxLength:60}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[(a.header_text||"").length,"/60 characters"]}),d.header_text&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:d.header_text})]}),["IMAGE","VIDEO","DOCUMENT"].includes(a.header_type)&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"header_media_file",children:"Upload Media *"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("input",{ref:v,type:"file",id:"header_media_file",accept:a.header_type==="IMAGE"?"image/jpeg,image/jpg,image/png,image/gif":a.header_type==="VIDEO"?"video/mp4,video/mov,video/avi":"application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation",onChange:V,className:"hidden",disabled:M}),e.jsxs(p,{type:"button",variant:"secondary",onClick:()=>v.current?.click(),disabled:M,className:"w-full",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),M?"Uploading...":"Choose File"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:[a.header_type==="IMAGE"&&"Supported: JPEG, PNG, GIF (max 10MB)",a.header_type==="VIDEO"&&"Supported: MP4, MOV, AVI (max 10MB)",a.header_type==="DOCUMENT"&&"Supported: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX (max 10MB)"]}),d.header_media_url&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:d.header_media_url})]}),(_||a.header_media_url)&&e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-gray-50 dark:bg-gray-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[a.header_type==="IMAGE"&&e.jsx(re,{className:"h-5 w-5 text-blue-600"}),a.header_type==="VIDEO"&&e.jsx(se,{className:"h-5 w-5 text-blue-600"}),a.header_type==="DOCUMENT"&&e.jsx(de,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Media uploaded"})]}),e.jsx(p,{type:"button",variant:"ghost",size:"sm",onClick:()=>{o("header_media_url",""),I(null)},children:e.jsx(le,{className:"h-4 w-4"})})]}),a.header_type==="IMAGE"&&(_||a.header_media_url)&&e.jsx("img",{src:_||a.header_media_url,alt:"Preview",className:"max-w-full h-auto max-h-48 rounded-lg"}),(a.header_type==="VIDEO"||a.header_type==="DOCUMENT")&&e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 break-all",children:_||a.header_media_url})]})]})]})]}),e.jsxs(m,{className:"border-0 shadow-lg",children:[e.jsxs(y,{className:"bg-gradient-to-r from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20",children:[e.jsx(b,{children:"Body *"}),e.jsx(N,{children:"Main message content with optional variables"})]}),e.jsxs(h,{className:"space-y-4 pt-6",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"body_text",children:"Body Text *"}),e.jsx(me,{id:"body_text",value:a.body_text,onChange:t=>H(t.target.value),placeholder:"Hello! Your order {{1}} is ready. Pickup time: {{2}}",rows:6,maxLength:1024,className:"font-mono"}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[a.body_text.length,"/1024 characters"]}),g>0&&e.jsxs(xe,{variant:"info",className:"text-xs",children:[g," variable",g>1?"s":""," detected"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Use ","{{1}}",", ","{{2}}",", etc. for variables"]}),d.body_text&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:d.body_text})]}),g>0&&e.jsxs("div",{children:[e.jsx(l,{children:"Variable Examples (Optional)"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:"Provide example values for preview and testing"}),e.jsx("div",{className:"space-y-2",children:Array.from({length:g},(t,r)=>r+1).map(t=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(c,{value:a.body_examples?.[t-1]||"",onChange:r=>K(t-1,r.target.value),placeholder:`Example for variable {{${t}}}`,className:"flex-1"})},t))})]})]})]}),e.jsxs(m,{className:"border-0 shadow-lg",children:[e.jsxs(y,{className:"bg-gradient-to-r from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20",children:[e.jsx(b,{children:"Footer (Optional)"}),e.jsx(N,{children:"Add a footer to your template"})]}),e.jsx(h,{className:"pt-6",children:e.jsxs("div",{children:[e.jsx(l,{htmlFor:"footer_text",children:"Footer Text"}),e.jsx(c,{id:"footer_text",value:a.footer_text||"",onChange:t=>o("footer_text",t.target.value),placeholder:"Footer text (max 60 characters)",maxLength:60}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[(a.footer_text||"").length,"/60 characters"]}),d.footer_text&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:d.footer_text})]})})]}),e.jsxs(m,{className:"border-0 shadow-lg",children:[e.jsx(y,{className:"bg-gradient-to-r from-pink-50 to-pink-100 dark:from-pink-900/20 dark:to-pink-800/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(b,{children:"Buttons (Optional)"}),e.jsx(N,{children:"Add up to 3 buttons to your template"})]}),(a.buttons?.length||0)<3&&e.jsxs(p,{type:"button",variant:"secondary",size:"sm",onClick:X,children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Add Button"]})]})}),e.jsx(h,{className:"space-y-4 pt-6",children:a.buttons&&a.buttons.length>0?a.buttons.map((t,r)=>e.jsx(m,{className:"border border-gray-200 dark:border-gray-700",children:e.jsxs(h,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(l,{children:["Button ",r+1]}),e.jsx(p,{type:"button",variant:"ghost",size:"sm",onClick:()=>$(r),children:e.jsx(oe,{className:"h-4 w-4 text-red-600"})})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Button Type *"}),e.jsxs(k,{value:t.type,onValueChange:s=>f(r,"type",s),children:[e.jsx(E,{children:e.jsx(w,{children:t.type==="QUICK_REPLY"?"Quick Reply":t.type==="URL"?"URL":t.type==="PHONE_NUMBER"?"Phone Number":"Select button type"})}),e.jsxs(C,{children:[e.jsx(i,{value:"QUICK_REPLY",children:"Quick Reply"}),e.jsx(i,{value:"URL",children:"URL"}),e.jsx(i,{value:"PHONE_NUMBER",children:"Phone Number"})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Button Text *"}),e.jsx(c,{value:t.text,onChange:s=>f(r,"text",s.target.value),placeholder:"Button text (max 20 characters)",maxLength:20}),d[`buttons.${r}.text`]&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:d[`buttons.${r}.text`]})]}),t.type==="URL"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(l,{children:"URL *"}),e.jsx(c,{type:"url",value:t.url||"",onChange:s=>f(r,"url",s.target.value),placeholder:"https://example.com"}),d[`buttons.${r}.url`]&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:d[`buttons.${r}.url`]})]}),e.jsxs("div",{children:[e.jsx(l,{children:"URL Example (Optional)"}),e.jsx(c,{value:t.url_example||"",onChange:s=>f(r,"url_example",s.target.value),placeholder:"https://example.com/{{1}}"})]})]}),t.type==="PHONE_NUMBER"&&e.jsxs("div",{children:[e.jsx(l,{children:"Phone Number *"}),e.jsx(c,{value:t.phone_number||"",onChange:s=>f(r,"phone_number",s.target.value),placeholder:"+1234567890"}),d[`buttons.${r}.phone_number`]&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:d[`buttons.${r}.phone_number`]})]})]})},r)):e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:e.jsx("p",{children:'No buttons added. Click "Add Button" to add one.'})})})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-6",children:[e.jsx(B,{href:route("app.whatsapp.templates.index",{}),children:e.jsx(p,{variant:"secondary",children:"Cancel"})}),e.jsx(p,{type:"submit",disabled:O,className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 shadow-lg shadow-blue-500/50",children:O?"Updating...":"Update Template"})]})]})]})]})}export{Oe as default};
