import{r as b,j as e}from"./react-B_HteL0F.js";import{G as Q,H as z,l as S,N as W,a7 as J,F as q,aW as Z,aU as ee,aI as ae,aX as te,X as re,a0 as se,B as le,a as de}from"./vendor-GYTC5Pip.js";import{A as ne}from"./AppShell-HrBHfcoG.js";import{C as c,a as u,b as g,d as _,c as x}from"./Card-CUbeq4wI.js";import{B as ie}from"./Topbar-CPirX8py.js";import{B as m}from"./app-C0WBMkkY.js";import{T as o}from"./TextInput-79R2a16S.js";import{L as d}from"./Label-Drek3p_W.js";import{S as N,a as f,b as v,c as k,d as i,T as oe}from"./Textarea-B7BdsC2C.js";import{A as ce}from"./Alert-BvOoLVKy.js";import{u as xe}from"./useToast-Rch7lQVh.js";import"./GlobalFlashHandler-DpywDQft.js";import"./BrandingWrapper-DIBfDp2T.js";/* empty css            */const me=[{code:"en_US",name:"English (US)"},{code:"en_GB",name:"English (UK)"},{code:"es_ES",name:"Spanish (Spain)"},{code:"es_MX",name:"Spanish (Mexico)"},{code:"pt_BR",name:"Portuguese (Brazil)"},{code:"fr_FR",name:"French"},{code:"de_DE",name:"German"},{code:"it_IT",name:"Italian"},{code:"hi_IN",name:"Hindi"},{code:"ja_JP",name:"Japanese"},{code:"ko_KR",name:"Korean"},{code:"zh_CN",name:"Chinese (Simplified)"},{code:"ar_SA",name:"Arabic"},{code:"tr_TR",name:"Turkish"},{code:"ru_RU",name:"Russian"}];function Ce({workspace:E,connections:C}){const{toast:h}=xe(),[p,B]=b.useState(0),[M,R]=b.useState(!1),[I,A]=b.useState(!1),[w,U]=b.useState(null),T=b.useRef(null),{data:t,setData:n,post:P,processing:O,errors:l,reset:he}=Q({whatsapp_connection_id:C[0]?.id?.toString()||"",name:"",language:"en_US",category:"UTILITY",header_type:"NONE",header_text:"",header_media_url:"",body_text:"",body_examples:[],footer_text:"",buttons:[]}),D=a=>{const r=a.match(/\{\{(\d+)\}\}/g),s=r?r.map($=>parseInt($.match(/\d+/)?.[0]||"0")):[],y=s.length>0?Math.max(...s):0;B(y)},F=a=>{n("body_text",a),D(a)},L=()=>{if((t.buttons?.length||0)>=3){h.error("Maximum 3 buttons allowed");return}n("buttons",[...t.buttons||[],{type:"QUICK_REPLY",text:""}])},V=a=>{const r=[...t.buttons||[]];r.splice(a,1),n("buttons",r)},j=(a,r,s)=>{const y=[...t.buttons||[]];y[a]={...y[a],[r]:s},n("buttons",y)},G=async a=>{if(a){A(!0);try{const r=new FormData;r.append("file",a),r.append("type",t.header_type);const s=await de.post(route("app.whatsapp.templates.upload-media",{workspace:E.slug}),r,{headers:{"Content-Type":"multipart/form-data","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}});n("header_media_url",s.data.url),U(s.data.url),h.success("File uploaded","Media file uploaded successfully.")}catch(r){h.error("Upload failed",r.response?.data?.error||r.message||"Failed to upload file.")}finally{A(!1)}}},H=a=>{const r=a.target.files?.[0];r&&G(r),T.current&&(T.current.value="")},X=(a,r)=>{const s=[...t.body_examples||[]];s[a]=r,n("body_examples",s)},K=a=>{a.preventDefault(),t.buttons?.filter(r=>r.text.trim()!==""),t.body_examples?.filter(r=>r.trim()!==""),P(route("app.whatsapp.templates.store",{workspace:E.slug}),{onSuccess:()=>{h.success("Template created successfully! It will be reviewed by Meta.")},onError:r=>{r.create?h.error(r.create):h.error("Failed to create template. Please check the form for errors.")}})},Y=()=>{let a=t.body_text||"";for(let r=1;r<=p;r++){const s=t.body_examples?.[r-1]||`Example ${r}`;a=a.replace(new RegExp(`\\{\\{${r}\\}\\}`,"g"),s)}return e.jsxs("div",{className:"space-y-4 p-6 bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-xl border-2 border-gray-200 dark:border-gray-700",children:[t.header_type!=="NONE"&&e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2",children:"HEADER"}),t.header_type==="TEXT"&&t.header_text&&e.jsx("div",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:t.header_text}),["IMAGE","VIDEO","DOCUMENT"].includes(t.header_type)&&t.header_media_url&&e.jsx("div",{className:"text-sm text-blue-600 dark:text-blue-400 break-all",children:t.header_media_url})]}),e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2",children:"BODY"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-gray-100 whitespace-pre-wrap",children:a||"Body text will appear here..."})]}),t.footer_text&&e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2",children:"FOOTER"}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:t.footer_text})]}),t.buttons&&t.buttons.length>0&&e.jsx("div",{className:"space-y-2",children:t.buttons.map((r,s)=>r.text&&e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800 text-center",children:e.jsx("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:r.text})},s))})]})};return e.jsxs(ne,{children:[e.jsx(z,{title:"Create Template"}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs(S,{href:route("app.whatsapp.templates.index",{workspace:E.slug}),className:"inline-flex items-center gap-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors mb-4",children:[e.jsx(W,{className:"h-4 w-4"}),"Back to Templates"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent",children:"Create Template"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Create a new WhatsApp message template following Meta's latest guidelines"})]}),e.jsx(m,{variant:"secondary",onClick:()=>R(!M),children:M?"Edit Mode":"Preview Mode"})]})]}),e.jsxs(ce,{variant:"info",className:"border-blue-200 dark:border-blue-800",children:[e.jsx(J,{className:"h-5 w-5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-800 dark:text-blue-200 mb-1",children:"Template Guidelines"}),e.jsxs("ul",{className:"text-sm text-blue-600 dark:text-blue-400 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Template name: Alphanumeric and underscores only, max 512 characters"}),e.jsxs("li",{children:["Body text: Max 1024 characters, use ","{{1}}",", ","{{2}}"," for variables"]}),e.jsx("li",{children:"Header: Max 60 characters (TEXT) or media URL (IMAGE/VIDEO/DOCUMENT)"}),e.jsx("li",{children:"Footer: Max 60 characters"}),e.jsx("li",{children:"Buttons: Maximum 3 buttons (QUICK_REPLY, URL, or PHONE_NUMBER)"}),e.jsx("li",{children:"Templates require Meta approval before use"})]})]})]}),e.jsxs("form",{onSubmit:K,className:"space-y-6",children:[M?e.jsxs(c,{className:"border-0 shadow-lg",children:[e.jsxs(u,{children:[e.jsx(g,{children:"Template Preview"}),e.jsx(_,{children:"How your template will appear to recipients"})]}),e.jsx(x,{children:Y()})]}):e.jsxs(e.Fragment,{children:[e.jsxs(c,{className:"border-0 shadow-lg",children:[e.jsx(u,{className:"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20",children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"}),"Basic Information"]})}),e.jsxs(x,{className:"space-y-4 pt-6",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"connection",children:"WhatsApp Connection *"}),e.jsxs(N,{value:t.whatsapp_connection_id,onValueChange:a=>n("whatsapp_connection_id",a),children:[e.jsx(f,{className:"w-full",children:e.jsx(v,{children:C.find(a=>a.id.toString()===t.whatsapp_connection_id)?.name||"Select connection"})}),e.jsx(k,{children:C.map(a=>e.jsxs(i,{value:a.id.toString(),children:[a.name," ",!a.waba_id&&"(No WABA ID)"]},a.id))})]}),l.whatsapp_connection_id&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:l.whatsapp_connection_id})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"name",children:"Template Name *"}),e.jsx(o,{id:"name",value:t.name,onChange:a=>n("name",a.target.value),placeholder:"my_template_name",className:"font-mono",maxLength:512}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Alphanumeric and underscores only"}),l.name&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:l.name})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"language",children:"Language *"}),e.jsxs(N,{value:t.language,onValueChange:a=>n("language",a),children:[e.jsx(f,{children:e.jsx(v,{})}),e.jsx(k,{children:me.map(a=>e.jsx(i,{value:a.code,children:a.name},a.code))})]}),l.language&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:l.language})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"category",children:"Category *"}),e.jsxs(N,{value:t.category,onValueChange:a=>n("category",a),children:[e.jsx(f,{children:e.jsx(v,{children:t.category==="MARKETING"?"Marketing":t.category==="UTILITY"?"Utility":t.category==="AUTHENTICATION"?"Authentication":"Select category"})}),e.jsxs(k,{children:[e.jsx(i,{value:"MARKETING",children:"Marketing"}),e.jsx(i,{value:"UTILITY",children:"Utility"}),e.jsx(i,{value:"AUTHENTICATION",children:"Authentication"})]})]}),l.category&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:l.category})]})]})]}),e.jsxs(c,{className:"border-0 shadow-lg",children:[e.jsxs(u,{className:"bg-gradient-to-r from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20",children:[e.jsx(g,{children:"Header (Optional)"}),e.jsx(_,{children:"Add a header to your template"})]}),e.jsxs(x,{className:"space-y-4 pt-6",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"header_type",children:"Header Type"}),e.jsxs(N,{value:t.header_type,onValueChange:a=>{n("header_type",a),(a==="NONE"||a==="TEXT")&&(n("header_media_url",""),U(null))},children:[e.jsx(f,{children:e.jsx(v,{children:t.header_type==="NONE"?"None":t.header_type==="TEXT"?"Text":t.header_type==="IMAGE"?"Image":t.header_type==="VIDEO"?"Video":t.header_type==="DOCUMENT"?"Document":"Select header type"})}),e.jsxs(k,{children:[e.jsx(i,{value:"NONE",children:"None"}),e.jsx(i,{value:"TEXT",children:"Text"}),e.jsx(i,{value:"IMAGE",children:"Image"}),e.jsx(i,{value:"VIDEO",children:"Video"}),e.jsx(i,{value:"DOCUMENT",children:"Document"})]})]})]}),t.header_type==="TEXT"&&e.jsxs("div",{children:[e.jsx(d,{htmlFor:"header_text",children:"Header Text *"}),e.jsx(o,{id:"header_text",value:t.header_text||"",onChange:a=>n("header_text",a.target.value),placeholder:"Header text (max 60 characters)",maxLength:60}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[(t.header_text||"").length,"/60 characters"]}),l.header_text&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:l.header_text})]}),["IMAGE","VIDEO","DOCUMENT"].includes(t.header_type)&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"header_media_file",children:"Upload Media *"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("input",{ref:T,type:"file",id:"header_media_file",accept:t.header_type==="IMAGE"?"image/jpeg,image/jpg,image/png,image/gif":t.header_type==="VIDEO"?"video/mp4,video/mov,video/avi":"application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation",onChange:H,className:"hidden",disabled:I}),e.jsxs(m,{type:"button",variant:"secondary",onClick:()=>T.current?.click(),disabled:I,className:"w-full",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),I?"Uploading...":"Choose File"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:[t.header_type==="IMAGE"&&"Supported: JPEG, PNG, GIF (max 10MB)",t.header_type==="VIDEO"&&"Supported: MP4, MOV, AVI (max 10MB)",t.header_type==="DOCUMENT"&&"Supported: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX (max 10MB)"]}),l.header_media_url&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:l.header_media_url})]}),(w||t.header_media_url)&&e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-gray-50 dark:bg-gray-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.header_type==="IMAGE"&&e.jsx(ee,{className:"h-5 w-5 text-blue-600"}),t.header_type==="VIDEO"&&e.jsx(ae,{className:"h-5 w-5 text-blue-600"}),t.header_type==="DOCUMENT"&&e.jsx(te,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Media uploaded"})]}),e.jsx(m,{type:"button",variant:"ghost",size:"sm",onClick:()=>{n("header_media_url",""),U(null)},children:e.jsx(re,{className:"h-4 w-4"})})]}),t.header_type==="IMAGE"&&(w||t.header_media_url)&&e.jsx("img",{src:w||t.header_media_url,alt:"Preview",className:"max-w-full h-auto max-h-48 rounded-lg"}),(t.header_type==="VIDEO"||t.header_type==="DOCUMENT")&&e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 break-all",children:w||t.header_media_url})]})]})]})]}),e.jsxs(c,{className:"border-0 shadow-lg",children:[e.jsxs(u,{className:"bg-gradient-to-r from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20",children:[e.jsx(g,{children:"Body *"}),e.jsx(_,{children:"Main message content with optional variables"})]}),e.jsxs(x,{className:"space-y-4 pt-6",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"body_text",children:"Body Text *"}),e.jsx(oe,{id:"body_text",value:t.body_text,onChange:a=>F(a.target.value),placeholder:"Hello! Your order {{1}} is ready. Pickup time: {{2}}",rows:6,maxLength:1024,className:"font-mono"}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[t.body_text.length,"/1024 characters"]}),p>0&&e.jsxs(ie,{variant:"info",className:"text-xs",children:[p," variable",p>1?"s":""," detected"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Use ","{{1}}",", ","{{2}}",", etc. for variables"]}),l.body_text&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:l.body_text})]}),p>0&&e.jsxs("div",{children:[e.jsx(d,{children:"Variable Examples (Optional)"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:"Provide example values for preview and testing"}),e.jsx("div",{className:"space-y-2",children:Array.from({length:p},(a,r)=>r+1).map(a=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(o,{value:t.body_examples?.[a-1]||"",onChange:r=>X(a-1,r.target.value),placeholder:`Example for variable {{${a}}}`,className:"flex-1"})},a))})]})]})]}),e.jsxs(c,{className:"border-0 shadow-lg",children:[e.jsxs(u,{className:"bg-gradient-to-r from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20",children:[e.jsx(g,{children:"Footer (Optional)"}),e.jsx(_,{children:"Add a footer to your template"})]}),e.jsx(x,{className:"pt-6",children:e.jsxs("div",{children:[e.jsx(d,{htmlFor:"footer_text",children:"Footer Text"}),e.jsx(o,{id:"footer_text",value:t.footer_text||"",onChange:a=>n("footer_text",a.target.value),placeholder:"Footer text (max 60 characters)",maxLength:60}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[(t.footer_text||"").length,"/60 characters"]}),l.footer_text&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:l.footer_text})]})})]}),e.jsxs(c,{className:"border-0 shadow-lg",children:[e.jsx(u,{className:"bg-gradient-to-r from-pink-50 to-pink-100 dark:from-pink-900/20 dark:to-pink-800/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(g,{children:"Buttons (Optional)"}),e.jsx(_,{children:"Add up to 3 buttons to your template"})]}),(t.buttons?.length||0)<3&&e.jsxs(m,{type:"button",variant:"secondary",size:"sm",onClick:L,children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Add Button"]})]})}),e.jsx(x,{className:"space-y-4 pt-6",children:t.buttons&&t.buttons.length>0?t.buttons.map((a,r)=>e.jsx(c,{className:"border border-gray-200 dark:border-gray-700",children:e.jsxs(x,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(d,{children:["Button ",r+1]}),e.jsx(m,{type:"button",variant:"ghost",size:"sm",onClick:()=>V(r),children:e.jsx(le,{className:"h-4 w-4 text-red-600"})})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Button Type *"}),e.jsxs(N,{value:a.type,onValueChange:s=>j(r,"type",s),children:[e.jsx(f,{children:e.jsx(v,{children:a.type==="QUICK_REPLY"?"Quick Reply":a.type==="URL"?"URL":a.type==="PHONE_NUMBER"?"Phone Number":"Select button type"})}),e.jsxs(k,{children:[e.jsx(i,{value:"QUICK_REPLY",children:"Quick Reply"}),e.jsx(i,{value:"URL",children:"URL"}),e.jsx(i,{value:"PHONE_NUMBER",children:"Phone Number"})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Button Text *"}),e.jsx(o,{value:a.text,onChange:s=>j(r,"text",s.target.value),placeholder:"Button text (max 20 characters)",maxLength:20}),l[`buttons.${r}.text`]&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:l[`buttons.${r}.text`]})]}),a.type==="URL"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(d,{children:"URL *"}),e.jsx(o,{type:"url",value:a.url||"",onChange:s=>j(r,"url",s.target.value),placeholder:"https://example.com"}),l[`buttons.${r}.url`]&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:l[`buttons.${r}.url`]})]}),e.jsxs("div",{children:[e.jsx(d,{children:"URL Example (Optional)"}),e.jsx(o,{value:a.url_example||"",onChange:s=>j(r,"url_example",s.target.value),placeholder:"https://example.com/{{1}}"})]})]}),a.type==="PHONE_NUMBER"&&e.jsxs("div",{children:[e.jsx(d,{children:"Phone Number *"}),e.jsx(o,{value:a.phone_number||"",onChange:s=>j(r,"phone_number",s.target.value),placeholder:"+1234567890"}),l[`buttons.${r}.phone_number`]&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:l[`buttons.${r}.phone_number`]})]})]})},r)):e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:e.jsx("p",{children:'No buttons added. Click "Add Button" to add one.'})})})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-6",children:[e.jsx(S,{href:route("app.whatsapp.templates.index",{workspace:E.slug}),children:e.jsx(m,{variant:"secondary",children:"Cancel"})}),e.jsx(m,{type:"submit",disabled:O,className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 shadow-lg shadow-blue-500/50",children:O?"Creating...":"Create Template"})]})]})]})]})}export{Ce as default};
